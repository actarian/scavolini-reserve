{"version":3,"sources":["docs/js/artisan.js"],"names":["angular","module","app","factory","Color","r","g","b","a","arguments","length","this","uint","parseInt","componentToHex","c","hex","toString","luma","color","dot","contrast","darker","pow","min","Math","max","floor","lighter","prototype","toUint","toHex","toRgba","toFixed","alpha","makeSet","foreground","border","light","Shape","shapeCircle","p","cx","cy","sa","ea","PI","ctx","arc","shapeStar","or","ir","steps","x","y","angle","step","moveTo","i","cos","sin","lineTo","shapeRoundRect","rect","w","h","undefined","tl","tr","br","bl","defaultRadius","key","quadraticCurveTo","circle","params","Array","slice","call","beginPath","apply","closePath","star","roundRect","constant","black","white","blue","red","lightBlue","lightYellow","greyLighter","greyLight","greyMedium","grey","map","$q","Painter","Rect","Palette","painter","setSize","buffer","size","pool","rows","getRect","row","canvas","width","height","setCanvas","document","createElement","drawImage","add","path","palette","isString","deferred","defer","img","Image","onload","addShape","resolve","onerror","reject","src","promise","callback","save","clip","translate","clone","setPos","restore","draw","target","pre","drawRect","tint","setFill","fillRect","globalCompositeOperation","console","log","pattern","drawPattern","fillStyle","createPattern","toDataURL","PainterColors","drawingRect","setColors","colors","forEach","value","offsetWidth","offsetHeight","getContext","lineCap","copy","clear","resize","setText","font","align","verticalAlign","textAlign","textBaseline","setStroke","strokeStyle","lineWidth","fillText","text","point","post","maxLength","substr","trim","strokeRect","fill","stroke","begin","close","rotate","xy","image","t","s","flip","scale","directive","$parse","State","Dom","restrict","link","scope","element","attributes","model","relative","absolute","targetElement","from","to","current","boundingClientRect","styleObj","originalCssText","state","expanded","placeholder","setStyle","node","style","cssText","window","getComputedStyle","display","getPropertyValue","position","top","right","bottom","left","margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","background-color","parentNode","insertBefore","addClass","getParents","each","setRects","hasClass","getBoundingClientRect","absoluteRight","innerWidth","absoluteLeft","absoluteBottom","innerHeight","absoluteTop","expand","idle","dynamics","animate","type","easeInOut","duration","complete","change","update","contract","removeClass","removeChild","set","expandableRelative","expandableAbsolute","querySelector","expandable","onDown","e","onUp","getClosestNode","onResize","isBusy","onKeyDown","toLowerCase","tagName","trigger","expandableTrigger","$on","off","on","templateUrl","transclude","message","uniqueId","template","control","ngModel","required","form","title","source","label","require","controller","filter","optionLabel","string","prepend","expression","splitted","split","formatted","shift","index","join","formatLabel","getOptions","number","field","replace","format","precision","validate","minLength","Number","POSITIVE_INFINITY","options","focus","visible","onChange","$parent","onFilter","getType","getClasses","control-focus","control-success","$valid","control-error","$invalid","$submitted","$touched","control-empty","$viewValue","getMessages","$error","toggleVisibility","$http","$templateCache","$compile","compile","$timeout","nodeRemove","querySelectorAll","nodeAdd","onRemove","getter","numberPicker","setter","assign","onAdd","$filter","$formatters","push","$parsers","unshift","valid","String","indexOf","$setValidity","onFocus","$modelValue","$setViewValue","onBlur","doBlur","$templateRequest","$controller","priority","modal","modalView","then","html","data","contents","$scope","$new","extend","controllerAs","children","compileController","provider","tp","modals","routes","when","$get","closeModal","m","active","cancel","splice","addModal","back","Nav","items","$watch","isArray","onPath","onNav","nav","setItems","item","Events","output","navItem","itemClose","immediate","$nav","opened","opening","closing","closed","o","itemToggle","parent","preventDefault","stop","down","resolved","rejected","click","navTo","Silent","setNav","statics","silent","publics","addItem","addItems","itemOrItems","getPath","setNavs","level","open","opacity","spring","frequency","friction","popuppable","ondragstart","Scrollable","Animate","Style","Utils","onLeft","onRight","scrollableWhen","showIndicatorFor","attr","scrollable","containerNode","contentNode","content","contentStyle","render","scrollableX","time","setContainer","setContent","setEnabled","isEnabled","renderX","getCurrent","transform","onMove","event","dragMove","drag","getDrag","abs","dragEnd","dragOff","getItems","scrollableItem","prev","scrollPrev","play","next","scrollNext","reset","doReset","onScrollX","dir","interval","wheelX","enabled","newValue","oldValue","dragStart","windowEvents","move","up","wheel","wheelXCheck","remove","pause","onTop","onBottom","scrollableY","renderY","onScrollY","wheelY","wheelYCheck","Point","snappable","busy","dragging","wheeling","padding","currentIndex","start","end","indicator","offset","speed","container","overflow","flag","getIndicator","getIndex","scrollToIndex","doLeft","doRight","animating","extendX","snapToNearestX","round","scrollToX","doTop","doBottom","extendY","snapToNearestY","scrollToY","getItemAtIndex","offsetLeft","offsetTop","finally","extending","distance","setTimeout","methods","$promise","native","video","infos","canplay","_onCanPlay","preload","onPlaying","playing","onPause","onEnded","onProgress","buffered","onTimeUpdate","currentTime","progressTime","toggle","videoElement","ticks","cancelAnimationFrame","loop","requestAnimationFrame","lastTime","vendors","currTime","Date","getTime","timeToCall","id","clearTimeout","Hash","DateTime","Range","CalendarFactory","Api","user","onMonthDidChange","date","month","calendar","monthExpanded","DAY","all","gantt","absencesAndOvertimes","getParams","response","sources","unworkings","records","monthRecords","record","error","resource","resourceId","setAbsencesAndOvertimes","days","day","availableHours","working","baseHours","ao","hours","has","recordedHours","holiday","weekend","vacation","wasVacation","past","wasWorkable","workable","get","green","currentDay","isBefore","orange","updateCalendar","firstWorkingDate","setFirstDay","forward","isOutside","getKey","getFirstWorkingDate","onWeekDidSelect","week","onDayDidSelect","Day","resources","actives","ready","url","put","Month","Week","doNavMonth","setMonth","getDate","onWeekSelect","calendarMonth","onDaySelect","setDate","selected","isCurrent","getDayClasses","classes","today","$today","available","full","status-green","status-orange","getMonthByDate","d","getDay","dirty","service","months","clearMonth","tasks","getWeekByDate","ceil","weeks","find","getMonths","num","removeAll","setFullYear","getFullYear","getMonth","setHours","setMinutes","setSeconds","yyyy","MM","mKey","fromDay","monthDays","diff","Calendar","getWeeks","getWeek","weekDate","isoWeek","dKey","wKey","dayDate","MINUTE","QUARTER","HOUR","WEEK","FIRSTDAYOFWEEK","getFullDate","getIndexLeft","getIndexRight","getDayLeft","components","dd","dayLeft","HH","mm","ss","sss","getDayRight","dayRight","getMonthLeft","monthLeft","getMonthRight","monthRight","getWeekLeft","weekLeft","getWeekRight","weekRight","getYearLeft","getYearRight","yearRight","dateToKey","dayDiff","getFullDay","getDayByKey","keyToDate","getDayByDate","hourToTime","hour","monthDiff","weekDiff","yearDiff","yearLeft","timeToHour","timeToQuarterHour","SECOND","datetime","ee","getHours","getMinutes","getSeconds","getMilliseconds","getTimezoneOffset","valueOf","ww","setTime","getWeekDay","offsetDays","now","first","formats","long","RANGE","YEAR","SEMESTER","TRIMESTER","MONTH","short","RangeTypes","setDiff","setYear","setSemester","setTrimester","setQuarter","setWeek","setDay","setKey","getDiff","dateFrom","dateTo","range","filters","setDates","is","isInside","isAfter","equals","eachDay","fromKey","toKey","totalDays","getName","RangeExtract","RangeFormat","getShortName","RangeCopy","addYear","years","types","Year","Semester","Trimester","Quarter","$range","name","replaced","token","j","f","pop","obj","Object","keys","values","defineProperty","vals","isEnumerable","just_now","seconds_ago","a_minute_ago","minutes_ago","an_hour_ago","hours_ago","a_day_ago","days_ago","a_week_ago","weeks_ago","a_month_ago","months_ago","a_year_ago","years_ago","over_a_year_ago","seconds_from_now","a_minute_from_now","minutes_from_now","an_hour_from_now","hours_from_now","a_day_from_now","days_from_now","a_week_from_now","weeks_from_now","a_month_from_now","months_from_now","a_year_from_now","years_from_now","over_a_year_from_now","$rootScope","$interval","$injector","$formats","$format","instant","getDelta","delta","suffix","minute","dateRelative","innerHTML","setInterval","cancelInterval","agent","safari","msie","chrome","mobile","mac","ua","getBoundRect","getNode","getDocumentNode","getClosest","selector","matchesFn","some","fn","body","parentElement","original","originalEvent","deltaX","wheelDeltaX","deltaY","wheelDeltaY","getElement","getNodeOffset","nodeType","getPageScroll","scroll","documentNode","pageXOffset","scrollLeft","pageYOffset","scrollTop","topParentNode","parents","getView","view","clientWidth","clientHeight","getPointInView","TOUCH_EVENTS","touch","touches","changedTouches","pageX","pageY","MOUSE_EVENTS","downloadFile","base64","blob","Blob","reader","FileReader","readAsDataURL","onloadend","result","createEvent","anchor","href","download","downloadName","substring","lastIndexOf","initEvent","dispatchEvent","navigator","userAgent","getElementsByTagName","documentElement","EventsService","Event","timestamp","stopPropagation","events","listeners","standardEvents","setTimestamp","removeTouchEvents","touchEvents","removeStandardEvents","wheelEvents","removeScrollEvents","scrollEvents","removeWheelEvents","getTouch","previous","difference","getRelativeTouch","standard","windowElement","listener","mouseEvents","hasPassiveEvents","addEventListener","defaults","passive","capture","modified","getModifiedAddEventListener","EventTarget","getAddEventListener","supported","firefox","scrollWidth","preventHistoryNavigation","array","Autolinker","className","firstName","lastName","toUpperCase","txt","charAt","legacyFilter","cost","currency","ratio","formatting","APP","inches","unit","units","IMPERIAL","feet","meters","cm","pounds","oz","kg","weight","grams","minutes","second","seconds","timezone","parseTime","parseHour","val","filterWatcher","collection","property","isObject","isUndefined","isMemoized","memoize","dict","toText","n","TEXT_NODE","nodeValue","ELEMENT_NODE","childNodes","currentStyle","match","div","PointDifference","multiply","PointMultiply","mult","setX","setY","RectMultiply","bottomLeft","bottomRight","center","expandRect","intersect","reduce","reduceRect","offsetRect","setH","setW","topLeft","topRight","Vector","cross","VectorCross","VectorDifference","VectorDistance","incidence","VectorIncidence","make","normalize","VectorNormalize","power","VectorSize","towards","sqrt","atan2","l","pools","HashGet","defineProperties","enumerable","writable","getItem","newItem","once","oldItem","addMany","removeMany","hash","reverse","sort","backward","differs","updatePool","promises","isError","isErroring","isSuccess","isSuccessing","errors","addons","isReady","successing","success","errorring","errorMessage","button","labels","$broadcast","submitClass","transformProperty","every","prefix","detectTransformProperty","props","hoverScale","currentScale","styles","transformOrigin","extract","object","reducer","reducerAdder","reducerSetter","removeValue","reverseSortOn","throttle","func","wait","context","args","timeout","later","leading","getNow","remaining","trailing","toMd5","where","query","found","TypeError","len","k","$locationProvider","$httpProvider","config","merge","environment","paths","location","EnvironmentGet","global","EnvironmentSetHttp","EnvironmentSetLocation","EnvironmentSet","use","plugins","facebook","fields","version","google","googlemaps","clusterer","lat","lng","disableDefaultUI","mapTypeId","scrollwheel","zoom","mapbox","bearing","curve","pitch","http","interceptors","withCredentials","language","code","culture","iso","html5","headers","common","html5Mode","hashPrefix","Doc","$location","$route","$routeParams","Router","Route","route","$$route","pathParams","originalPath","loadedTemplateUrl","View","doc","docs","LocalStorage","isAuthorizedOrGoTo","redirect","auth","created_at","expires_in","status","isAuthorized","request","Authorization","access_token","responseError","Message","ModelState","httpError","delete","signOut","SessionStorage","accessToken","remember","exist","BearerSet","header","HttpPromise","HttpPath","patch","static","fake","msec","api","method","Preload","loaded","total","progress","preloads","percent","clearInterval","xhr","XMLHttpRequest","responseType","onloadstart","onprogress","send","URL","createObjectURL","load","OnceScript","OnceLink","script","uid","getElementById","scripts","nextSibling","links","rel","$previous","$current","$next","$currentController","isController","msecs","RouterRedirectTo","RouterRetryLastRequestedPath","RouterSetControllers","$$lastRequestedPath","loading","rejection","$path","$$listeners","$locationChangeSuccess","TIMEOUT","CookieSetter","cookie","CookieGet","elapsed","Cookie","checkCookie","cache","json","JSON","stringify","btoa","encodeURIComponent","cookieName","ca","parse","decodeURIComponent","atob","expires","toGMTString","localStorage","removeItem","setItem","LocalSupported","sessionStorage","SessionSupported","$sce","TrustGetOrSet","trustAsHtml","trustAsResourceUrl","trustedValues","trustedValue","$once","storage","Facebook","login","FacebookLogin","logout","FacebookStatus","getMe","FB","getMyPicture","trhow","authResponse","init","appId","xfbml","Auth2Init","GoogleLogin","Auth2Instance","instance","isSignedIn","signed","profile","currentUser","getBasicProfile","getId","getGivenName","getFamilyName","picture","getImageUrl","email","getEmail","auth2","Google","gapi","onLoaded","client_id","clientId","cookiepolicy","fetch_basic_profile","ux_mode","getAuthInstance","readAccessToken","getAuthResponse","signIn","Http","GoogleMaps","connector","info","bounds","markers","setMarkers","Googlemaps","marker","setMap","maps","LatLngBounds","category","categories","latLng","LatLng","latitude","longitude","Marker","icon","scaledSize","Size","origin","contentString","onClick","selectedBlog","addListener","MarkerClusterer","cssClass","imagePath","setType","typeId","setMapTypeId","Map","InfoWindow","maxWidth","pixelOffset","outer","$","background","css","z-index","cursor","mouseout","geocoder","Geocoder","results","formatted_address","street","GoogleMapsType","locality","postalCode","city","province","region","country","geometry","apiKey","address_components","long_name","MapBox","fly","MapboxFly","flyPosition","jump","jumpTo","jumpPosition","MapboxJump","mapboxgl","interactive","logoPosition","getCanvasContainer","features","properties","coordinates","altitude","MapboxCoordinatesGet","crs","MapboxFeaturesGet","addSource","cluster","clusterMaxZoom","clusterRadius","addLayer","paint","circle-color","stops","circle-radius","layout","text-field","text-font","text-size","circle-stroke-width","circle-stroke-color","area","setAttribute","setLngLat","addTo","markerElement","$emit","MapboxMarkerAdd","fitBounds","flyTo"],"mappings":"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","file":"artisan.min.js","sourcesContent":["/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan', ['ng', 'ngRoute', 'ngMessages']);\r\n\r\n}());\r\n\n/* global angular, firebase */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Color', [function() {\n\t\tfunction Color(r, g, b, a) {\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tthis.r = (r || r === 0) ? r : 0;\n\t\t\t\tthis.g = (g || g === 0) ? g : 0;\n\t\t\t\tthis.b = (b || b === 0) ? b : 0;\n\t\t\t\tthis.a = (a || a === 0) ? a : 255;\n\t\t\t} else {\n\t\t\t\tvar uint = r || '0xffffff';\n\t\t\t\tuint = parseInt(uint);\n\t\t\t\tif (r.length > 8) {\n\t\t\t\t\tthis.r = uint >> 24 & 0xff;\n\t\t\t\t\tthis.g = uint >> 16 & 0xff;\n\t\t\t\t\tthis.b = uint >> 8 & 0xff;\n\t\t\t\t\tthis.a = uint >> 0 & 0xff;\n\t\t\t\t} else {\n\t\t\t\t\tthis.r = uint >> 16 & 0xff;\n\t\t\t\t\tthis.g = uint >> 8 & 0xff;\n\t\t\t\t\tthis.b = uint >> 0 & 0xff;\n\t\t\t\t\tthis.a = 255;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tColor.componentToHex = function(c) {\n\t\t\tvar hex = c.toString(16);\n\t\t\treturn hex.length == 1 ? '0' + hex : hex;\n\t\t};\n\t\tColor.luma = function(color) {\n\t\t\t// var luma = color.dot({ r: 54.213, g: 182.376, b: 18.411 });\n\t\t\tvar luma = color.dot({\n\t\t\t\tr: 95,\n\t\t\t\tg: 100,\n\t\t\t\tb: 60\n\t\t\t});\n\t\t\treturn luma;\n\t\t};\n\t\tColor.contrast = function(color) {\n\t\t\tvar luma = Color.luma(color);\n\t\t\tif (luma > 0.6) {\n\t\t\t\treturn new Color('0x000000');\n\t\t\t} else {\n\t\t\t\treturn new Color('0xffffff');\n\t\t\t}\n\t\t};\n\t\tColor.darker = function(color, pow, min) {\n\t\t\tmin = min || 0;\n\t\t\tvar r = Math.max(Math.floor(color.r * min), Math.floor(color.r - 255 * pow));\n\t\t\tvar g = Math.max(Math.floor(color.g * min), Math.floor(color.g - 255 * pow));\n\t\t\tvar b = Math.max(Math.floor(color.b * min), Math.floor(color.b - 255 * pow));\n\t\t\treturn new Color(r, g, b, color.a);\n\t\t};\n\t\tColor.lighter = function(color, pow, max) {\n\t\t\tmax = max || 1;\n\t\t\tvar r = Math.min(color.r + Math.floor((255 - color.r) * max), Math.floor(color.r + 255 * pow));\n\t\t\tvar g = Math.min(color.g + Math.floor((255 - color.g) * max), Math.floor(color.g + 255 * pow));\n\t\t\tvar b = Math.min(color.b + Math.floor((255 - color.b) * max), Math.floor(color.b + 255 * pow));\n\t\t\treturn new Color(r, g, b, color.a);\n\t\t};\n\t\t/*\n\t\tColor.rgbaToHex = function (rgba) {\n\t\t    rgba = rgba.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\t\t    return (rgba && rgba.length === 4) ? \"#\" +\n\t\t        (\"0\" + parseInt(rgba[1], 10).toString(16)).slice(-2) +\n\t\t        (\"0\" + parseInt(rgba[2], 10).toString(16)).slice(-2) +\n\t\t        (\"0\" + parseInt(rgba[3], 10).toString(16)).slice(-2) : '';\n\t\t}\n\t\t*/\n\t\tColor.prototype = {\n\t\t\ttoUint: function() {\n\t\t\t\treturn (this.r << 24) + (this.g << 16) + (this.b << 8) + (this.a);\n\t\t\t},\n\t\t\ttoHex: function() {\n\t\t\t\treturn '#' + Color.componentToHex(this.r) + Color.componentToHex(this.g) + Color.componentToHex(this.b) + Color.componentToHex(this.a);\n\t\t\t},\n\t\t\ttoRgba: function() {\n\t\t\t\treturn 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + (this.a / 255).toFixed(3) + ')';\n\t\t\t},\n\t\t\tdot: function(color) {\n\t\t\t\treturn ((this.r / 255) * (color.r / 255) + (this.g / 255) * (color.g / 255) + (this.b / 255) * (color.b / 255));\n\t\t\t},\n\t\t\talpha: function(pow, min, max) {\n\t\t\t\tmin = min || 0;\n\t\t\t\tmax = max || 1;\n\t\t\t\tthis.a = Math.floor((min + (pow * (max - min))) * 255);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tmakeSet: function() {\n\t\t\t\tthis.foreground = Color.contrast(this);\n\t\t\t\tthis.border = Color.darker(this, 0.3);\n\t\t\t\tthis.light = Color.lighter(this, 0.3);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t};\n\t\treturn Color;\n    }]);\n\n\tapp.factory('Shape', [function() {\n\t\tfunction Shape() {}\n\t\tShape.shapeCircle = function(p, cx, cy, r, sa, ea) {\n\t\t\tsa = sa || 0;\n\t\t\tea = ea || 2 * Math.PI;\n\t\t\tp.ctx.arc(cx, cy, r, sa, ea, false);\n\t\t};\n\t\tShape.shapeStar = function(p, cx, cy, or, ir, steps) {\n\t\t\tvar x, y;\n\t\t\tvar angle = Math.PI / 2 * 3;\n\t\t\tvar step = Math.PI / steps;\n\t\t\tvar ctx = p.ctx;\n\t\t\tctx.moveTo(cx, cy - or);\n\t\t\tfor (i = 0; i < steps; i++) {\n\t\t\t\tx = cx + Math.cos(angle) * or;\n\t\t\t\ty = cy + Math.sin(angle) * or;\n\t\t\t\tctx.lineTo(x, y);\n\t\t\t\tangle += step;\n\t\t\t\tx = cx + Math.cos(angle) * ir;\n\t\t\t\ty = cy + Math.sin(angle) * ir;\n\t\t\t\tctx.lineTo(x, y);\n\t\t\t\tangle += step;\n\t\t\t}\n\t\t\tctx.lineTo(cx, cy - or);\n\t\t};\n\t\tShape.shapeRoundRect = function(p, rect, r) {\n\t\t\tvar ctx = p.ctx,\n\t\t\t\tx = rect.x,\n\t\t\t\ty = rect.y,\n\t\t\t\tw = rect.w,\n\t\t\t\th = rect.h;\n\t\t\tif (typeof r === undefined) {\n\t\t\t\tr = 4;\n\t\t\t}\n\t\t\tif (typeof r === 'number') {\n\t\t\t\tr = {\n\t\t\t\t\ttl: r,\n\t\t\t\t\ttr: r,\n\t\t\t\t\tbr: r,\n\t\t\t\t\tbl: r\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tvar defaultRadius = {\n\t\t\t\t\ttl: 0,\n\t\t\t\t\ttr: 0,\n\t\t\t\t\tbr: 0,\n\t\t\t\t\tbl: 0\n\t\t\t\t};\n\t\t\t\tfor (var key in defaultRadius) {\n\t\t\t\t\tr[key] = r[key] || defaultRadius[key];\n\t\t\t\t}\n\t\t\t}\n\t\t\tctx.moveTo(x + r.tl, y);\n\t\t\tctx.lineTo(x + w - r.tr, y);\n\t\t\tctx.quadraticCurveTo(x + w, y, x + w, y + r.tr);\n\t\t\tctx.lineTo(x + w, y + h - r.br);\n\t\t\tctx.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);\n\t\t\tctx.lineTo(x + r.bl, y + h);\n\t\t\tctx.quadraticCurveTo(x, y + h, x, y + h - r.bl);\n\t\t\tctx.lineTo(x, y + r.tl);\n\t\t\tctx.quadraticCurveTo(x, y, x + r.tl, y);\n\t\t};\n\t\tShape.circle = function() {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeCircle.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\tShape.star = function() {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeStar.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\tShape.roundRect = function() {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeRoundRect.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\treturn Shape;\n    }]);\n\n\tapp.constant('PainterColors', {\n\t\t/*\n\t\tblack: new Color('0x111111'),\n\t\twhite: new Color('0xffffff'),\n\t\tred: new Color('0xff0000'),\n\t\tgreen: new Color('0x00ff00'),\n\t\tblue: new Color('0x0000ff'),\n\t\tyellow: new Color('0xffff00'),\n\t\tcyan: new Color('0x00ffff'),\n\t\tpurple: new Color('0xff00ff'),\n\t\t*/\n\t\tblack: '0x14191e',\n\t\twhite: '0xffffff',\n\t\tblue: '0x0023FF',\n\t\tred: '0xF21500',\n\t\tlightBlue: '0x79ccf2',\n\t\tlightYellow: '0xfff79a',\n\t\tgreyLighter: '0xf8f8f8',\n\t\tgreyLight: '0xeeeeee',\n\t\tgreyMedium: '0xcccccc',\n\t\tgrey: '0x90939b',\n\t\tmap: '0x24292e',\n\t});\n\n\tapp.factory('Palette', ['$q', 'Painter', 'Rect', function($q, Painter, Rect) {\n\t\tfunction Palette() {\n\t\t\tthis.painter = new Painter().setSize(0, 0);\n\t\t\tthis.buffer = new Painter().setSize(0, 0);\n\t\t\tthis.size = {\n\t\t\t\tw: 0,\n\t\t\t\th: 0\n\t\t\t};\n\t\t\tthis.pool = {};\n\t\t\tthis.rows = {};\n\t\t}\n\t\tPalette.prototype = {\n\t\t\tgetRect: function(w, h) {\n\t\t\t\tvar p = this.painter,\n\t\t\t\t\tsize = this.size,\n\t\t\t\t\trows = this.rows,\n\t\t\t\t\tr = new Rect(0, 0, w, h),\n\t\t\t\t\trow = rows[h] || {\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: size.h\n\t\t\t\t\t};\n\t\t\t\tsize.w = Math.max(size.w, row.x + w);\n\t\t\t\tsize.h = Math.max(size.h, row.y + h);\n\t\t\t\tif (!p.canvas.width && !p.canvas.height) {\n\t\t\t\t\tp.setSize(size.w, size.h);\n\t\t\t\t} else if (size.w > p.canvas.width || size.h > p.canvas.height) {\n\t\t\t\t\t// var img = new Image();\n\t\t\t\t\t// img.src = p.toDataURL();\n\t\t\t\t\t// document.body.appendChild(canvas);\n\t\t\t\t\t// console.log(p.canvas.width, p.canvas.height);\n\t\t\t\t\t// var data = p.ctx.getImageData(0, 0, p.canvas.width, p.canvas.height);\n\t\t\t\t\tvar canvas = p.canvas;\n\t\t\t\t\tp.setCanvas(document.createElement('canvas'));\n\t\t\t\t\tp.setSize(size.w, size.h);\n\t\t\t\t\tp.ctx.drawImage(canvas, 0, 0);\n\t\t\t\t\t// p.ctx.putImageData(data, 0, 0);\n\t\t\t\t\t// p.ctx.drawImage(img, 0, 0);\n\t\t\t\t\t// document.body.removeChild(canvas);\n\t\t\t\t}\n\t\t\t\tr.x = row.x;\n\t\t\t\tr.y = row.y;\n\t\t\t\trow.x += w;\n\t\t\t\trows[h] = row;\n\t\t\t\treturn r;\n\t\t\t},\n\t\t\tadd: function(key, path) {\n\t\t\t\tvar palette = this;\n\t\t\t\tif (angular.isString(path)) {\n\t\t\t\t\tvar deferred = $q.defer();\n\t\t\t\t\tvar img = new Image();\n\t\t\t\t\timg.onload = function() {\n\t\t\t\t\t\tpalette.addShape(key, img.width, img.height, function(p, rect) {\n\t\t\t\t\t\t\tp.ctx.drawImage(img, 0, 0);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdeferred.resolve(img);\n\t\t\t\t\t};\n\t\t\t\t\timg.onerror = function() {\n\t\t\t\t\t\tdeferred.reject('connot load ' + path);\n\t\t\t\t\t};\n\t\t\t\t\timg.src = path;\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t} else {\n\t\t\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\t\t\treturn palette.addShape.apply(palette, params);\n\t\t\t\t}\n\t\t\t},\n\t\t\taddShape: function(key, w, h, callback) {\n\t\t\t\tvar p = this.painter,\n\t\t\t\t\tr = this.getRect(w, h);\n\t\t\t\tp.ctx.save();\n\t\t\t\tp.ctx.rect(r.x, r.y, r.w, r.h);\n\t\t\t\t// p.ctx.stroke();\n\t\t\t\tp.ctx.clip();\n\t\t\t\tp.ctx.translate(r.x, r.y);\n\t\t\t\tcallback.call(p, p, r.clone().setPos(0, 0));\n\t\t\t\tp.ctx.restore();\n\t\t\t\tthis.pool[key] = r;\n\t\t\t\t// console.log('Painter.add', r);\n\t\t\t},\n\t\t\tdraw: function(target, key, x, y, pre) {\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\t// var ctx = target.ctx;\n\t\t\t\t\t// ctx.save();\n\t\t\t\t\ttarget.drawRect(this.painter.canvas, r, {\n\t\t\t\t\t\tx: x,\n\t\t\t\t\t\ty: y,\n\t\t\t\t\t\tw: r.w,\n\t\t\t\t\t\th: r.h\n\t\t\t\t\t}, pre);\n\t\t\t\t\t// target.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, x - r.w / 2, y - r.h / 2, r.w, r.h);\n\t\t\t\t\t// ctx.restore();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttint: function(target, key, x, y, color, pre) {\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\tvar p = this.painter,\n\t\t\t\t\t\tb = this.buffer.setSize(r.w, r.h);\n\t\t\t\t\tb.save();\n\t\t\t\t\tb.setFill(color);\n\t\t\t\t\tb.fillRect();\n\t\t\t\t\tb.ctx.globalCompositeOperation = \"destination-atop\";\n\t\t\t\t\tb.ctx.drawImage(p.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\tb.restore();\n\t\t\t\t\tconsole.log(x, y, b.canvas, target.canvas);\n\t\t\t\t\ttarget.draw(b.canvas, {\n\t\t\t\t\t\tx: x,\n\t\t\t\t\t\ty: y\n\t\t\t\t\t}, pre);\n\t\t\t\t}\n\t\t\t},\n\t\t\tpattern: function(target, key, x, y, w, h, color) {\n\t\t\t\tfunction drawPattern(pattern) {\n\t\t\t\t\tvar ctx = target.ctx;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\t// draw\n\t\t\t\t\t// ctx.beginPath();\n\t\t\t\t\t// ctx.rect(-x, -y, w, h);\n\t\t\t\t\tctx.fillStyle = pattern;\n\t\t\t\t\tctx.fillRect(-x, -y, w, h);\n\t\t\t\t\tctx.translate(-x, -y);\n\t\t\t\t\t// ctx.fill();\n\t\t\t\t\tctx.restore();\n\t\t\t\t}\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\tvar img = r.img,\n\t\t\t\t\t\tpattern;\n\t\t\t\t\tif (!img || r.color != color) {\n\t\t\t\t\t\tvar b = this.buffer.setSize(r.w, r.h);\n\t\t\t\t\t\tif (color) {\n\t\t\t\t\t\t\tr.color = color;\n\t\t\t\t\t\t\tb.save();\n\t\t\t\t\t\t\tb.setFill(color);\n\t\t\t\t\t\t\tb.fillRect();\n\t\t\t\t\t\t\tb.ctx.globalCompositeOperation = \"destination-atop\";\n\t\t\t\t\t\t\tb.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\t\t\tb.restore();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tb.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\t\t}\n\t\t\t\t\t\timg = new Image();\n\t\t\t\t\t\timg.onload = function() {\n\t\t\t\t\t\t\tr.img = img;\n\t\t\t\t\t\t\tpattern = target.ctx.createPattern(img, \"repeat\");\n\t\t\t\t\t\t\tdrawPattern(pattern);\n\t\t\t\t\t\t};\n\t\t\t\t\t\timg.src = b.toDataURL();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpattern = target.ctx.createPattern(img, \"repeat\");\n\t\t\t\t\t\tdrawPattern(pattern);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t\treturn Palette;\n    }]);\n\n\tapp.factory('Painter', ['Shape', 'Rect', 'Color', 'PainterColors', function(Shape, Rect, Color, PainterColors) {\n\t\tfunction Painter(canvas) {\n\t\t\tcanvas = canvas || document.createElement('canvas');\n\t\t\tthis.rect = new Rect();\n\t\t\tthis.drawingRect = new Rect();\n\t\t\tthis.setColors();\n\t\t\tthis.setCanvas(canvas);\n\t\t}\n\t\tPainter.colors = {};\n\t\tangular.forEach(PainterColors, function(value, key) {\n\t\t\tPainter.colors[key] = new Color(value).makeSet();\n\t\t});\n\t\tvar colors = Painter.colors;\n\t\tPainter.prototype = {\n\t\t\tcolors: Painter.colors,\n\t\t\tsetColors: function() {\n\t\t\t\tvar colors = this.colors;\n\t\t\t\tangular.forEach(PainterColors, function(value, key) {\n\t\t\t\t\tcolors[key] = new Color(value).makeSet();\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetCanvas: function(canvas) {\n\t\t\t\tthis.canvas = canvas;\n\t\t\t\tthis.setSize(canvas.offsetWidth, canvas.offsetHeight);\n\t\t\t\tvar ctx = canvas.getContext('2d');\n\t\t\t\tctx.lineCap = 'square';\n\t\t\t\tthis.ctx = ctx;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetSize: function(w, h) {\n\t\t\t\tthis.canvas.width = w;\n\t\t\t\tthis.canvas.height = h;\n\t\t\t\tthis.rect.w = w;\n\t\t\t\tthis.rect.h = h;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tcopy: function(canvas) {\n\t\t\t\tthis.ctx.drawImage(canvas, 0, 0);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tclear: function() {\n\t\t\t\tthis.resize();\n\t\t\t\t// this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tresize: function() {\n\t\t\t\tthis.setSize(this.canvas.offsetWidth, this.canvas.offsetHeight);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetText: function(font, align, verticalAlign, color) {\n\t\t\t\tfont = font || '11px monospace';\n\t\t\t\talign = align || 'center';\n\t\t\t\tverticalAlign = verticalAlign || 'middle';\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\tctx.font = font;\n\t\t\t\tctx.textAlign = align;\n\t\t\t\tctx.textBaseline = verticalAlign;\n\t\t\t\tctx.fillStyle = color.toRgba();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetFill: function(color) {\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\t/*\n\t\t\t\tvar my_gradient = ctx.createLinearGradient(0, 0, 0, 170);\n\t\t\t\tmy_gradient.addColorStop(0, \"black\");\n\t\t\t\tmy_gradient.addColorStop(1, \"white\");\n\t\t\t\tctx.fillStyle = my_gradient;\n\t\t\t\t*/\n\t\t\t\tctx.fillStyle = color.toRgba();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetStroke: function(color, size) {\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\tsize = size || 1;\n\t\t\t\t/*\n\t\t\t\tvar gradient=ctx.createLinearGradient(0,0,170,0);\n\t\t\t\tgradient.addColorStop(\"0\",\"magenta\");\n\t\t\t\tgradient.addColorStop(\"0.5\",\"blue\");\n\t\t\t\tgradient.addColorStop(\"1.0\",\"red\");\n\t\t\t\tctx.strokeStyle = gradient;\n\t\t\t\t*/\n\t\t\t\t// Fill with gradient\n\t\t\t\tctx.strokeStyle = color.toRgba();\n\t\t\t\tctx.lineWidth = size;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\t/*\n\t\t\tdrawRoundRect: function (rect, r) {\n\t\t\t    rect = rect || this.rect;\n\t\t\t    Shape.roundRect(this, rect, r);\n\t\t\t    return this;\n\t\t\t},\n\t\t\t*/\n\t\t\tfillText: function(text, point, width, post, maxLength) {\n\t\t\t\tif (width) {\n\t\t\t\t\tpost = post || '';\n\t\t\t\t\tmaxLength = maxLength || Math.floor(width / 8);\n\t\t\t\t\tif (text.length > maxLength) {\n\t\t\t\t\t\ttext = text.substr(0, Math.min(text.length, maxLength)).trim() + post;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.ctx.fillText(text, point.x, point.y);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tfillRect: function(rect) {\n\t\t\t\trect = rect || this.rect;\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\tx = rect.x,\n\t\t\t\t\ty = rect.y,\n\t\t\t\t\tw = rect.w,\n\t\t\t\t\th = rect.h;\n\t\t\t\tctx.fillRect(x, y, w, h);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tstrokeRect: function(rect) {\n\t\t\t\trect = rect || this.rect;\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\tx = rect.x,\n\t\t\t\t\ty = rect.y,\n\t\t\t\t\tw = rect.w,\n\t\t\t\t\th = rect.h;\n\t\t\t\tctx.strokeRect(x, y, w, h);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tfill: function() {\n\t\t\t\tthis.ctx.fill();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tstroke: function() {\n\t\t\t\tthis.ctx.stroke();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tbegin: function() {\n\t\t\t\tthis.ctx.beginPath();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tclose: function() {\n\t\t\t\tthis.ctx.closePath();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsave: function() {\n\t\t\t\tthis.ctx.save();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\trestore: function() {\n\t\t\t\tthis.ctx.restore();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\trotate: function(angle) {\n\t\t\t\tthis.ctx.rotate(angle * Math.PI / 180);\n\t\t\t},\n\t\t\ttranslate: function(xy) {\n\t\t\t\tthis.ctx.translate(xy.x, xy.y);\n\t\t\t},\n\t\t\ttoDataURL: function() {\n\t\t\t\treturn this.canvas.toDataURL();\n\t\t\t},\n\t\t\tdraw: function(image, t, pre) {\n\t\t\t\tif (image) {\n\t\t\t\t\tt.w = t.w || image.width;\n\t\t\t\t\tt.h = t.h || image.height;\n\t\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\t\trect = this.drawingRect,\n\t\t\t\t\t\tx = rect.x = t.x - t.w / 2,\n\t\t\t\t\t\ty = rect.y = t.y - t.h / 2,\n\t\t\t\t\t\tw = rect.w = t.w,\n\t\t\t\t\t\th = rect.h = t.h;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\tif (pre) {\n\t\t\t\t\t\tpre.call(this);\n\t\t\t\t\t}\n\t\t\t\t\tctx.drawImage(image, 0, 0);\n\t\t\t\t\tctx.restore();\n\t\t\t\t\t// console.log('painter.draw', x, y, w, h);\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tdrawRect: function(image, s, t, pre) {\n\t\t\t\tif (image) {\n\t\t\t\t\ts.w = s.w || image.width;\n\t\t\t\t\ts.h = s.h || image.height;\n\t\t\t\t\tt.w = t.w || image.width;\n\t\t\t\t\tt.h = t.h || image.height;\n\t\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\t\trect = this.drawingRect,\n\t\t\t\t\t\tx = rect.x = t.x - s.w / 2,\n\t\t\t\t\t\ty = rect.y = t.y - s.h / 2,\n\t\t\t\t\t\tw = rect.w = t.w,\n\t\t\t\t\t\th = rect.h = t.h;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\tif (pre) {\n\t\t\t\t\t\tpre.call(this);\n\t\t\t\t\t}\n\t\t\t\t\tctx.drawImage(image, s.x, s.y, s.w, s.h, 0, 0, t.w, t.h);\n\t\t\t\t\tctx.restore();\n\t\t\t\t\t// console.log('painter.drawRect', x, y, w, h);\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tflip: function(scale) {\n\t\t\t\tscale = scale || {\n\t\t\t\t\tx: 1,\n\t\t\t\t\ty: -1\n\t\t\t\t};\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\trect = this.drawingRect;\n\t\t\t\tctx.translate(scale.x === -1 ? rect.w : 0, scale.y === -1 ? rect.h : 0);\n\t\t\t\tctx.scale(scale.x, scale.y);\n\t\t\t},\n\t\t};\n\t\treturn Painter;\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('expandable', ['$parse', 'State', 'Dom', function($parse, State, Dom) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\t// template: '<div ng-transclude></div>',\n\t\t\t// transclude: true,\n\t\t\t// replace: true,\n\t\t\t/*\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/nav/partial/nav';\n            },\n            */\n\t\t\tlink: ExpandableLink,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction ExpandableLink(scope, element, attributes, model) {\n\n\t\t\tvar state = new State();\n\t\t\tstate.pow = 0;\n\n\t\t\tvar relative, absolute;\n\n\t\t\tvar target, targetElement;\n\n\t\t\tvar from, to, current,\n\t\t\t\tboundingClientRect, styleObj, originalCssText;\n\n\t\t\tvar expanded = false;\n\n\t\t\tvar placeholder = document.createElement('div'),\n\t\t\t\tplaceholderElement = angular.element(placeholder);\n\t\t\tplaceholderElement.addClass('expandable-placeholder');\n\n\t\t\tfunction getStyle(node) {\n\t\t\t\tvar style = window.getComputedStyle(node, null);\n\t\t\t\tvar styleObj = {\n\t\t\t\t\t'display': style.getPropertyValue('display'),\n\t\t\t\t\t'position': style.getPropertyValue('position'),\n\t\t\t\t\t'width': style.getPropertyValue('width'),\n\t\t\t\t\t'height': style.getPropertyValue('height'),\n\t\t\t\t\t'top': style.getPropertyValue('top'),\n\t\t\t\t\t'right': style.getPropertyValue('right'),\n\t\t\t\t\t'bottom': style.getPropertyValue('bottom'),\n\t\t\t\t\t'left': style.getPropertyValue('left'),\n\t\t\t\t\t'margin-top': style.getPropertyValue('margin-top'),\n\t\t\t\t\t'margin-right': style.getPropertyValue('margin-right'),\n\t\t\t\t\t'margin-bottom': style.getPropertyValue('margin-bottom'),\n\t\t\t\t\t'margin-left': style.getPropertyValue('margin-left'),\n\t\t\t\t\t'padding-top': style.getPropertyValue('padding-top'),\n\t\t\t\t\t'padding-right': style.getPropertyValue('padding-right'),\n\t\t\t\t\t'padding-bottom': style.getPropertyValue('padding-bottom'),\n\t\t\t\t\t'padding-left': style.getPropertyValue('padding-left'),\n\t\t\t\t\t'background-color': style.getPropertyValue('background-color'),\n\t\t\t\t};\n\t\t\t\treturn styleObj;\n\t\t\t}\n\n\t\t\tfunction getTextStyle(style) {\n\t\t\t\tvar text = '';\n\t\t\t\tangular.forEach(style, function(value, key) {\n\t\t\t\t\ttext += key + ': ' + value + '; ';\n\t\t\t\t});\n\t\t\t\treturn text;\n\t\t\t}\n\n\t\t\tfunction setStyle(node, style) {\n\t\t\t\tnode.style.cssText = getTextStyle(style);\n\t\t\t}\n\n\t\t\tfunction add() {\n\t\t\t\tstyleObj = getStyle(target);\n\t\t\t\tsetStyle(placeholder, styleObj);\n\t\t\t\ttarget.parentNode.insertBefore(placeholder, target);\n\t\t\t\toriginalCssText = target.style.cssText;\n\t\t\t\ttargetElement.addClass('expandable-expanding');\n\t\t\t\tDom.getParents(target).each(function(element, node) {\n\t\t\t\t\telement.addClass('expandable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction remove() {\n\t\t\t\ttarget.style.cssText = originalCssText;\n\t\t\t\ttargetElement.removeClass('expandable-expanding');\n\t\t\t\tplaceholder.parentNode.removeChild(placeholder);\n\t\t\t\tDom.getParents(target).each(function(element, node) {\n\t\t\t\t\telement.removeClass('expandable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction setRects() {\n\t\t\t\tif (targetElement && targetElement.hasClass('expandable-expanding')) {\n\t\t\t\t\tboundingClientRect = placeholder.getBoundingClientRect();\n\t\t\t\t} else {\n\t\t\t\t\tboundingClientRect = target.getBoundingClientRect();\n\t\t\t\t}\n\t\t\t\tfrom = {\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tleft: 0,\n\t\t\t\t\twidth: boundingClientRect.width, // parseInt(styleObj.width), // boundingClientRect.width,\n\t\t\t\t\theight: boundingClientRect.height, // parseInt(styleObj.height), // boundingClientRect.height,\n\t\t\t\t};\n\t\t\t\tto = {\n\t\t\t\t\ttop: 0 + (relative.top || 0),\n\t\t\t\t\tleft: 0 + (relative.left || 0),\n\t\t\t\t\twidth: from.width + (relative.right || 0),\n\t\t\t\t\theight: from.height + (relative.bottom || 0),\n\t\t\t\t};\n\t\t\t\tif (absolute.top) {\n\t\t\t\t\tto.top = absolute.top - boundingClientRect.top;\n\t\t\t\t}\n\t\t\t\tif (absolute.left) {\n\t\t\t\t\tto.left = absolute.left - boundingClientRect.left;\n\t\t\t\t}\n\t\t\t\tif (absolute.right) {\n\t\t\t\t\tvar absoluteRight = (window.innerWidth - absolute.right);\n\t\t\t\t\tvar absoluteLeft = boundingClientRect.left + to.left;\n\t\t\t\t\tto.width = absoluteRight - absoluteLeft;\n\t\t\t\t}\n\t\t\t\tif (absolute.bottom) {\n\t\t\t\t\tvar absoluteBottom = (window.innerHeight - absolute.bottom);\n\t\t\t\t\tvar absoluteTop = boundingClientRect.top + to.top;\n\t\t\t\t\tto.height = absoluteBottom - absoluteTop;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction expand() {\n\t\t\t\tif (!expanded) {\n\t\t\t\t\tsetRects();\n\t\t\t\t\tadd();\n\t\t\t\t\tcurrent = angular.copy(from);\n\t\t\t\t\tsetStyle(target, from);\n\t\t\t\t\tdynamics.animate(state, {\n\t\t\t\t\t\tpow: 1\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype: dynamics.easeInOut,\n\t\t\t\t\t\tduration: 350,\n\t\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\t\texpanded = true;\n\t\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchange: function() {\n\t\t\t\t\t\t\tupdate();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction contract() {\n\t\t\t\tif (expanded) {\n\t\t\t\t\tdynamics.animate(state, {\n\t\t\t\t\t\tpow: 0\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype: dynamics.easeInOut,\n\t\t\t\t\t\tduration: 350,\n\t\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\t\texpanded = false;\n\t\t\t\t\t\t\tremove();\n\t\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchange: function() {\n\t\t\t\t\t\t\tupdate();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction update() {\n\t\t\t\tcurrent.left = (from.left + (to.left - from.left) * state.pow) + 'px';\n\t\t\t\tcurrent.top = (from.top + (to.top - from.top) * state.pow) + 'px';\n\t\t\t\tcurrent.width = (from.width + (to.width - from.width) * state.pow) + 'px';\n\t\t\t\tcurrent.height = (from.height + (to.height - from.height) * state.pow) + 'px';\n\t\t\t\tsetStyle(target, current);\n\t\t\t}\n\n\t\t\tfunction toggle() {\n\t\t\t\tif (state.busy()) {\n\t\t\t\t\tif (expanded) {\n\t\t\t\t\t\tcontract();\n\t\t\t\t\t} else {\n\t\t\t\t\t\texpand();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction set() {\n\t\t\t\trelative = attributes.expandableRelative ? $parse(attributes.expandableRelative)(scope) : {};\n\t\t\t\tabsolute = attributes.expandableAbsolute ? $parse(attributes.expandableAbsolute)(scope) : {};\n\t\t\t\ttarget = element[0].querySelector(attributes.expandable);\n\t\t\t\tif (target) {\n\t\t\t\t\ttargetElement = angular.element(target);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDown(e) {\n\t\t\t\tset();\n\t\t\t\tif (target) {\n\t\t\t\t\texpand();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onUp(e) {\n\t\t\t\tif (Dom.getClosestNode(e.target, element[0])) {\n\t\t\t\t\t// nope\n\t\t\t\t} else {\n\t\t\t\t\tset();\n\t\t\t\t\tif (target) {\n\t\t\t\t\t\tcontract();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\tif (expanded || state.isBusy) {\n\t\t\t\t\tsetRects();\n\t\t\t\t\tupdate();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onKeyDown(e) {\n\t\t\t\tvar key = e.key.toLowerCase();\n\t\t\t\tswitch (key) {\n\t\t\t\t\tcase 'escape':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target) {\n\t\t\t\t\t\t\tcontract();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'enter':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target && target.tagName && target.tagName.toLowerCase() === 'input') {\n\t\t\t\t\t\t\tcontract();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar trigger = attributes.expandableTrigger ? element[0].querySelector(attributes.expandableTrigger) : null;\n\t\t\ttrigger = trigger ? angular.element(trigger) : element;\n\n\t\t\tfunction addListeners() {\n\t\t\t\ttrigger.on('mousedown touchstart', onDown);\n\t\t\t\telement.on('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.on('click', onUp)\n\t\t\t\t\t.on('resize', onResize);\n\t\t\t}\n\n\t\t\tfunction removeListeners() {\n\t\t\t\ttrigger.off('mousedown touchstart', onDown);\n\t\t\t\telement.off('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.off('click', onUp)\n\t\t\t\t\t.off('resize', onResize);\n\t\t\t}\n\n\t\t\tscope.$on('$destroy', function() {\n\t\t\t\tremoveListeners();\n\t\t\t});\n\n\t\t\taddListeners();\n\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('controlMessages', [function() {\n\t\treturn {\n\t\t\trestrict: 'E',\n\t\t\ttemplateUrl: 'artisan/components/forms/partial/messages',\n\t\t\ttransclude: {\n\t\t\t\t'message': '?messageItems',\n\t\t\t},\n\t\t\tlink: function(scope, element, attributes, model) {}\n\t\t};\n    }]);\n\n\tapp.directive('control', ['$parse', function($parse) {\n\t\tfunction formatLabel(string, prepend, expression) {\n\t\t\tstring = string || '';\n\t\t\tprepend = prepend || '';\n\t\t\tvar splitted = string.split(',');\n\t\t\tif (splitted.length > 1) {\n\t\t\t\tvar formatted = splitted.shift();\n\t\t\t\tangular.forEach(splitted, function(value, index) {\n\t\t\t\t\tif (expression) {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join(prepend + value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (expression) {\n\t\t\t\t\treturn '\\'' + formatted + '\\'';\n\t\t\t\t} else {\n\t\t\t\t\treturn formatted;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn prepend + string;\n\t\t\t}\n\t\t}\n\t\tvar uniqueId = 0;\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function(element, attributes) {\n\t\t\t\tvar template = 'artisan/components/forms/partial/text';\n\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\tcase 'select':\n\t\t\t\t\t\ttemplate = 'artisan/components/forms/partial/select';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\treturn template;\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\tngModel: '=',\n\t\t\t\trequired: '=',\n\t\t\t\tform: '@',\n\t\t\t\ttitle: '@',\n\t\t\t\tplaceholder: '@',\n\t\t\t\tsource: '=?',\n\t\t\t\tkey: '@?',\n\t\t\t\tlabel: '@?',\n\t\t\t},\n\t\t\trequire: 'ngModel',\n\t\t\ttransclude: true,\n\t\t\tlink: {\n\t\t\t\tpre: function preLink(scope, element, attributes, controller, transclude) {\n\t\t\t\t\tvar label = scope.label = (scope.label ? scope.label : 'name');\n\t\t\t\t\tvar key = scope.key = (scope.key ? scope.key : 'id');\n\t\t\t\t\tif (attributes.control === 'select') {\n\t\t\t\t\t\tvar filter = (attributes.filter ? '| ' + attributes.filter : '');\n\t\t\t\t\t\tvar optionLabel = formatLabel(label, 'item.', true);\n\t\t\t\t\t\tscope.getOptions = function() {\n\t\t\t\t\t\t\treturn attributes.number ?\n\t\t\t\t\t\t\t\t'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in source ' + filter :\n\t\t\t\t\t\t\t\toptionLabel + ' disable when item.disabled for item in source ' + filter + ' track by item.' + key;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tvar type = scope.type = attributes.control;\n\t\t\t\t\tvar form = scope.form = scope.form || 'form';\n\t\t\t\t\tvar title = scope.title = scope.title || 'untitled';\n\t\t\t\t\tvar placeholder = scope.placeholder = scope.placeholder || title;\n\t\t\t\t\tvar field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n\t\t\t\t\tscope.format = attributes.format || null;\n\t\t\t\t\tscope.precision = attributes.precision || null;\n\t\t\t\t\tscope.validate = attributes.validate || attributes.control;\n\t\t\t\t\tscope.minLength = attributes.minLength || 0;\n\t\t\t\t\tscope.maxLength = attributes.maxLength || Number.POSITIVE_INFINITY;\n\t\t\t\t\tscope.min = attributes.min || null;\n\t\t\t\t\tscope.max = attributes.max || null;\n\t\t\t\t\tscope.options = $parse(attributes.options)(scope) || {};\n\t\t\t\t\tscope.focus = false;\n\t\t\t\t\tscope.visible = false;\n\t\t\t\t\tscope.onChange = function(model) {\n\t\t\t\t\t\t$parse(attributes.onChange)(scope.$parent);\n\t\t\t\t\t};\n\t\t\t\t\tscope.onFilter = function(model) {\n\t\t\t\t\t\t$parse(attributes.onFilter)(scope.$parent);\n\t\t\t\t\t};\n\t\t\t\t\tscope.getType = function() {\n\t\t\t\t\t\tvar type = 'text';\n\t\t\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\t\t\tcase 'password':\n\t\t\t\t\t\t\t\ttype = scope.visible ? 'text' : 'password';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\ttype = attributes.control;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn type;\n\t\t\t\t\t};\n\t\t\t\t\tscope.getClasses = function() {\n\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t'control-focus': scope.focus,\n\t\t\t\t\t\t\t'control-success': field.$valid,\n\t\t\t\t\t\t\t'control-error': field.$invalid && (form.$submitted || field.$touched),\n\t\t\t\t\t\t\t'control-empty': !field.$viewValue\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t\tscope.getMessages = function() {\n\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\treturn (form.$submitted || field.$touched) && field.$error;\n\t\t\t\t\t};\n\t\t\t\t\tscope.toggleVisibility = function() {\n\t\t\t\t\t\tscope.visible = !scope.visible;\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t};\n    }]);\n\n\tapp.directive('_control', ['$http', '$templateCache', '$compile', '$parse', function($http, $templateCache, $compile, $parse) {\n\t\tfunction formatLabel(string, prepend, expression) {\n\t\t\tstring = string || '';\n\t\t\tprepend = prepend || '';\n\t\t\tvar splitted = string.split(',');\n\t\t\tif (splitted.length > 1) {\n\t\t\t\tvar formatted = splitted.shift();\n\t\t\t\tangular.forEach(splitted, function(value, index) {\n\t\t\t\t\tif (expression) {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join(prepend + value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (expression) {\n\t\t\t\t\treturn '\\'' + formatted + '\\'';\n\t\t\t\t} else {\n\t\t\t\t\treturn formatted;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn prepend + string;\n\t\t\t}\n\t\t}\n\t\tvar uniqueId = 0;\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function(element, attributes) {\n\t\t\t\tvar template = 'artisan/components/forms/partial/text';\n\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\tcase 'select':\n\t\t\t\t\t\ttemplate = 'artisan/components/forms/partial/select';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\treturn template;\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\tngModel: '=',\n\t\t\t\trequired: '=',\n\t\t\t\tform: '@',\n\t\t\t\ttitle: '@',\n\t\t\t\tplaceholder: '@',\n\t\t\t},\n\t\t\trequire: 'ngModel',\n\t\t\t/*\n\t\t\tlink: function(scope, element, attributes, model) {\n\t\t\t},\n\t\t\t*/\n\t\t\tcompile: function(element, attributes) {\n\t\t\t\treturn {\n\t\t\t\t\tpre: function(scope, element, attributes) {\n\t\t\t\t\t\tif (attributes.control === 'select') {\n\t\t\t\t\t\t\tvar label = (attributes.label ? attributes.label : 'name');\n\t\t\t\t\t\t\tvar key = (attributes.key ? attributes.key : 'id');\n\t\t\t\t\t\t\tvar filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\n\t\t\t\t\t\t\tvar optionLabel = formatLabel(label, 'item.', true);\n\t\t\t\t\t\t\tscope.options = attributes.number ?\n\t\t\t\t\t\t\t\t'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\n\t\t\t\t\t\t\t\toptionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\n\t\t\t\t\t\t\tconsole.log('control.compile.pre', scope.options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar type = scope.type = attributes.control;\n\t\t\t\t\t\tvar form = scope.form = scope.form || 'form';\n\t\t\t\t\t\tvar title = scope.title = scope.title || 'untitled';\n\t\t\t\t\t\tvar placeholder = scope.placeholder = scope.placeholder || title;\n\t\t\t\t\t\tvar field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n\t\t\t\t\t\tscope.validate = attributes.validate || attributes.control;\n\t\t\t\t\t\tscope.format = attributes.format || null;\n\t\t\t\t\t\tscope.precision = attributes.precision || null;\n\t\t\t\t\t\tscope.validate = attributes.validate || attributes.control;\n\t\t\t\t\t\tscope.minLength = attributes.min || 0;\n\t\t\t\t\t\tscope.maxLength = attributes.max || Number.POSITIVE_INFINITY;\n\t\t\t\t\t\tscope.options = $parse(attributes.options)(scope) || {};\n\t\t\t\t\t\tscope.focus = false;\n\t\t\t\t\t\tscope.visible = false;\n\t\t\t\t\t\tscope.getType = function() {\n\t\t\t\t\t\t\tvar type = 'text';\n\t\t\t\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\t\t\t\tcase 'password':\n\t\t\t\t\t\t\t\t\t// var form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\t\t\t\t// var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\t\t\t\ttype = scope.visible ? 'text' : 'password';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\ttype = attributes.control;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// console.log('control.getType', type);\n\t\t\t\t\t\t\treturn type;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.getClasses = function() {\n\t\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t'control-focus': scope.focus,\n\t\t\t\t\t\t\t\t'control-success': field.$valid,\n\t\t\t\t\t\t\t\t'control-error': field.$invalid && (form.$submitted || field.$touched),\n\t\t\t\t\t\t\t\t'control-empty': !field.$viewValue\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.getMessages = function() {\n\t\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\t\treturn (form.$submitted || field.$touched) && field.$error;\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\t// post: function (scope, element, attributes) { }\n\t\t\t\t};\n\t\t\t}\n\t\t\t/*\n\t\t\tcompile: function(element, attributes) {\n\t\t\t    element.removeAttr('my-dir');\n\t\t\t    element.attr('ng-hide', 'true');\n\t\t\t    return function(scope) {\n\t\t\t        $compile(element)(scope);\n\t\t\t    };\n\t\t\t},\n\t\t\t*/\n\t\t};\n    }]);\n\n\tapp.directive('numberPicker', ['$parse', '$timeout', function($parse, $timeout) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: '<div class=\"input-group\">' +\n\t\t\t\t'   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">-</button></span>' +\n\t\t\t\t'   <div ng-transclude></div>' +\n\t\t\t\t'   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">+</button></span>' +\n\t\t\t\t'</div>',\n\t\t\treplace: true,\n\t\t\ttransclude: true,\n\t\t\tlink: function(scope, element, attributes, model) {\n\t\t\t\tvar node = element[0];\n\t\t\t\tvar nodeRemove = node.querySelectorAll('.input-group-btn > .btn')[0];\n\t\t\t\tvar nodeAdd = node.querySelectorAll('.input-group-btn > .btn')[1];\n\n\t\t\t\tfunction onRemove(e) {\n\t\t\t\t\tvar min = $parse(attributes.min)(scope);\n\t\t\t\t\tvar getter = $parse(attributes.numberPicker);\n\t\t\t\t\tvar setter = getter.assign;\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tsetter(scope, Math.max(min, getter(scope) - 1));\n\t\t\t\t\t});\n\t\t\t\t\t// console.log('numberPicker.onRemove', min);\n\t\t\t\t}\n\n\t\t\t\tfunction onAdd(e) {\n\t\t\t\t\tvar max = $parse(attributes.max)(scope);\n\t\t\t\t\tvar getter = $parse(attributes.numberPicker);\n\t\t\t\t\tvar setter = getter.assign;\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tsetter(scope, Math.min(max, getter(scope) + 1));\n\t\t\t\t\t});\n\t\t\t\t\t// console.log('numberPicker.onAdd', max);\n\t\t\t\t}\n\n\t\t\t\tfunction addListeners() {\n\t\t\t\t\tangular.element(nodeRemove).on('touchstart mousedown', onRemove);\n\t\t\t\t\tangular.element(nodeAdd).on('touchstart mousedown', onAdd);\n\t\t\t\t}\n\n\t\t\t\tfunction removeListeners() {\n\t\t\t\t\tangular.element(nodeRemove).off('touchstart mousedown', onRemove);\n\t\t\t\t\tangular.element(nodeAdd).off('touchstart mousedown', onAdd);\n\t\t\t\t}\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tremoveListeners();\n\t\t\t\t});\n\t\t\t\taddListeners();\n\t\t\t}\n\t\t};\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('validate', ['$filter', function($filter) {\n\t\treturn {\n\t\t\trequire: 'ngModel',\n\t\t\tlink: function(scope, element, attributes, model) {\n\t\t\t\tvar type = attributes.validate;\n\t\t\t\tvar format = attributes.format || '';\n\t\t\t\tvar precision = attributes.precision || 2;\n\t\t\t\tvar focus = false;\n\t\t\t\t// console.log('validate', type);\n\t\t\t\tswitch (type) {\n\t\t\t\t\tcase 'date':\n\t\t\t\t\tcase 'datetime':\n\t\t\t\t\tcase 'datetime-local':\n\t\t\t\t\t\tmodel.$formatters.push(function(value) {\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\treturn $filter('date')(value, format);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'number':\n\t\t\t\t\t\tmodel.$parsers.unshift(function(value) {\n\t\t\t\t\t\t\tvar valid = false;\n\t\t\t\t\t\t\tif (value !== undefined && value !== \"\") {\n\t\t\t\t\t\t\t\tvalid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); //\n\t\t\t\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\t\t\t\tmodel.$setValidity('number', valid);\n\t\t\t\t\t\t\t\tif (valid) {\n\t\t\t\t\t\t\t\t\tmodel.$setValidity('positive', value >= 0.01);\n\t\t\t\t\t\t\t\t\tif (attributes.min !== undefined) {\n\t\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', value >= Number(attributes.min));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (attributes.max !== undefined) {\n\t\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', value <= Number(attributes.max));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalid = true;\n\t\t\t\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\t\t\t\tmodel.$setValidity('number', true);\n\t\t\t\t\t\t\t\tmodel.$setValidity('positive', true);\n\t\t\t\t\t\t\t\tif (attributes.min !== undefined) {\n\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (attributes.max !== undefined) {\n\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn value;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tmodel.$formatters.push(function(value) {\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\treturn $filter('number')(value, precision) + ' ' + format;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'anynumber':\n\t\t\t\t\t\tmodel.$parsers.unshift(function(value) {\n\t\t\t\t\t\t\tvar valid = false;\n\t\t\t\t\t\t\tif (value !== undefined && value !== \"\") {\n\t\t\t\t\t\t\t\tvalid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); //\n\t\t\t\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\t\t\t\tmodel.$setValidity('number', valid);\n\t\t\t\t\t\t\t\tif (valid) {\n\t\t\t\t\t\t\t\t\tif (attributes.min !== undefined) {\n\t\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', value >= Number(attributes.min));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (attributes.max !== undefined) {\n\t\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', value <= Number(attributes.max));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalid = true;\n\t\t\t\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\t\t\t\tmodel.$setValidity('number', true);\n\t\t\t\t\t\t\t\tif (attributes.min !== undefined) {\n\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (attributes.max !== undefined) {\n\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn value;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tmodel.$formatters.push(function(value) {\n\t\t\t\t\t\t\tif (value || value === 0) {\n\t\t\t\t\t\t\t\treturn $filter('number')(value, precision) + ' ' + format;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tfunction onFocus() {\n\t\t\t\t\tfocus = true;\n\t\t\t\t\tif (format) {\n\t\t\t\t\t\telement[0].value = model.$modelValue || null;\n\t\t\t\t\t\tif (!model.$modelValue) {\n\t\t\t\t\t\t\tmodel.$setViewValue(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction doBlur() {\n\t\t\t\t\tif (format && !model.$invalid) {\n\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\tcase 'date':\n\t\t\t\t\t\t\tcase 'datetime':\n\t\t\t\t\t\t\tcase 'datetime-local':\n\t\t\t\t\t\t\t\telement[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\telement[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onBlur() {\n\t\t\t\t\tfocus = false;\n\t\t\t\t\tdoBlur();\n\t\t\t\t}\n\n\t\t\t\tfunction addListeners() {\n\t\t\t\t\telement.on('focus', onFocus);\n\t\t\t\t\telement.on('blur', onBlur);\n\t\t\t\t}\n\n\t\t\t\tfunction removeListeners() {\n\t\t\t\t\telement.off('focus', onFocus);\n\t\t\t\t\telement.off('blur', onBlur);\n\t\t\t\t}\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tremoveListeners();\n\t\t\t\t});\n\t\t\t\taddListeners();\n\t\t\t}\n\t\t};\n    }]);\n\n}());\n\n/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.directive('modalView', ['$parse', '$templateRequest', '$compile', '$controller', 'Dom', function($parse, $templateRequest, $compile, $controller, Dom) {\r\n\r\n\t\tfunction compileController(scope, element, html, data) {\r\n\t\t\telement.html(html);\r\n\t\t\tvar link = $compile(element.contents());\r\n\t\t\tif (data.controller) {\r\n\t\t\t\tvar $scope = scope.$new();\r\n\t\t\t\tangular.extend($scope, data);\r\n\t\t\t\tvar controller = $controller(data.controller, {\r\n\t\t\t\t\t$scope: $scope\r\n\t\t\t\t});\r\n\t\t\t\tif (data.controllerAs) {\r\n\t\t\t\t\tscope[data.controllerAs] = controller;\r\n\t\t\t\t}\r\n\t\t\t\telement.data('$ngControllerController', controller);\r\n\t\t\t\telement.children().data('$ngControllerController', controller);\r\n\t\t\t\tscope = $scope;\r\n\t\t\t}\r\n\t\t\tlink(scope);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\trestrict: 'A',\r\n\t\t\tpriority: -400,\r\n\t\t\tlink: function(scope, element, attributes, model) {\r\n\t\t\t\tvar modal = $parse(attributes.modalView);\r\n\t\t\t\tmodal = modal(scope);\r\n\t\t\t\tmodal.templateUrl = modal.templateUrl || 'artisan/components/modals/partial/modal';\r\n\t\t\t\t$templateRequest(modal.templateUrl).then(function(html) {\r\n\t\t\t\t\tcompileController(scope, element, html, modal);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.provider('$modal', [function $modalProvider() {\r\n\r\n\t\tvar modals = [];\r\n\t\tvar routes = {};\r\n\r\n\t\tthis.modals = modals;\r\n\t\tthis.routes = routes;\r\n\t\tthis.when = when;\r\n\r\n\t\tfunction when(path, modal) {\r\n\t\t\troutes[path] = modal;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar tp;\r\n\r\n\t\tthis.$get = ['$q', '$timeout', function modalFactory($q, $timeout) {\r\n\r\n\t\t\tfunction popModal(modal) {\r\n\t\t\t\t// console.log('modalProvider.popModal', modal);\r\n\t\t\t\tvar index = -1;\r\n\t\t\t\tangular.forEach(modals, function(m, i) {\r\n\t\t\t\t\tif (m === modal) {\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tif (tp) {\r\n\t\t\t\t\t\t$timeout.cancel(tp);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttp = $timeout(function() {\r\n\t\t\t\t\t\tmodal.active = false;\r\n\t\t\t\t\t\tmodals.splice(index, 1);\r\n\t\t\t\t\t\tif (modals.length) {\r\n\t\t\t\t\t\t\tmodals[modals.length - 1].active = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction closeModal(modal) {\r\n\t\t\t\t// console.log('modalProvider.closeModal', modal);\r\n\t\t\t\tvar index = -1;\r\n\t\t\t\tangular.forEach(modals, function(m, i) {\r\n\t\t\t\t\tif (m === modal) {\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tmodal.active = false;\r\n\t\t\t\t\tif (tp) {\r\n\t\t\t\t\t\t$timeout.cancel(tp);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttp = $timeout(function() {\r\n\t\t\t\t\t\twhile (modals.length) {\r\n\t\t\t\t\t\t\tmodals.splice(modals.length - 1, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction addModal(path, params) {\r\n\t\t\t\t// console.log('modalProvider.addModal', path, params);\r\n\t\t\t\tvar deferred = $q.defer();\r\n\t\t\t\tparams = params || null;\r\n\t\t\t\tvar modal = {\r\n\t\t\t\t\ttitle: 'Untitled',\r\n\t\t\t\t\tcontroller: null,\r\n\t\t\t\t\ttemplateUrl: null,\r\n\t\t\t\t\tparams: params,\r\n\t\t\t\t};\r\n\t\t\t\tvar current = routes[path];\r\n\t\t\t\tif (current) {\r\n\t\t\t\t\tangular.extend(modal, current);\r\n\t\t\t\t}\r\n\t\t\t\tmodal.deferred = deferred;\r\n\t\t\t\tmodal.back = function(data) {\r\n\t\t\t\t\tpopModal(this);\r\n\t\t\t\t\tmodal.deferred.resolve(data, modal);\r\n\t\t\t\t};\r\n\t\t\t\tmodal.resolve = function(data) {\r\n\t\t\t\t\tcloseModal(this);\r\n\t\t\t\t\tmodal.deferred.resolve(data, modal);\r\n\t\t\t\t};\r\n\t\t\t\tmodal.reject = function() {\r\n\t\t\t\t\tcloseModal(this);\r\n\t\t\t\t\tmodal.deferred.reject(modal);\r\n\t\t\t\t};\r\n\t\t\t\tangular.forEach(modals, function(m, i) {\r\n\t\t\t\t\tm.active = false;\r\n\t\t\t\t});\r\n\t\t\t\tif (modals.length) {\r\n\t\t\t\t\tmodals.push(modal);\r\n\t\t\t\t\tmodal.active = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmodals.push(modal);\r\n\t\t\t\t\tif (tp) {\r\n\t\t\t\t\t\t$timeout.cancel(tp);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttp = $timeout(function() {\r\n\t\t\t\t\t\tmodal.active = true;\r\n\t\t\t\t\t}, 50);\r\n\t\t\t\t}\r\n\t\t\t\treturn deferred.promise;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tmodals: modals,\r\n\t\t\t\taddModal: addModal,\r\n\t\t\t};\r\n        }];\r\n\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('nav', ['$parse', 'Nav', function($parse, Nav) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function(element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/nav/partial/nav';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titems: '=nav',\n\t\t\t},\n\t\t\tlink: NavLink,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavLink(scope, element, attributes, model) {\n\t\t\tscope.$watch('items', function(value) {\n\t\t\t\t// console.log(value instanceof Nav, value);\n\t\t\t\tif (value) {\n\t\t\t\t\tif (angular.isArray(value)) {\n\t\t\t\t\t\tvar onPath = $parse(attributes.onPath)(scope.$parent);\n\t\t\t\t\t\tvar onNav = $parse(attributes.onNav)(scope.$parent);\n\t\t\t\t\t\tvar nav = new Nav({\n\t\t\t\t\t\t\tonPath: onPath,\n\t\t\t\t\t\t\tonNav: onNav\n\t\t\t\t\t\t});\n\t\t\t\t\t\tnav.setItems(value);\n\t\t\t\t\t\tscope.item = nav;\n\n\t\t\t\t\t} else if (value instanceof Nav) {\n\t\t\t\t\t\tscope.item = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.directive('navItem', ['$timeout', 'Events', function($timeout, Events) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function(element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/nav/partial/nav-item';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titem: '=navItem',\n\t\t\t},\n\t\t\tlink: NavItemLink,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavItemLink(scope, element, attributes, model) {\n\t\t\tvar navItem = angular.element(element[0].querySelector('.nav-link'));\n\n\t\t\tvar output;\n\n\t\t\tfunction itemOpen(item, immediate) {\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = true;\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\tstate.closed = state.closing = false;\n\t\t\t\t\tstate.opening = true;\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tstate.opening = false;\n\t\t\t\t\t\tstate.opened = true;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction itemClose(item, immediate) {\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = false;\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\tstate.opened = state.opening = false;\n\t\t\t\t\tstate.closing = true;\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tstate.closing = false;\n\t\t\t\t\t\tstate.closed = true;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tif (item.items) {\n\t\t\t\t\tangular.forEach(item.items, function(o) {\n\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction itemToggle(item) {\n\t\t\t\t// console.log('itemToggle', item);\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = item.items ? !state.active : true;\n\t\t\t\tif (state.active) {\n\t\t\t\t\tif (item.$nav.parent) {\n\t\t\t\t\t\tangular.forEach(item.$nav.parent.items, function(o) {\n\t\t\t\t\t\t\tif (o !== item) {\n\t\t\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\titemOpen(item);\n\t\t\t\t} else {\n\t\t\t\t\titemClose(item);\n\t\t\t\t}\n\t\t\t\t// console.log(state);\n\t\t\t}\n\n\t\t\tfunction onDown(e) {\n\t\t\t\tvar item = scope.item;\n\t\t\t\t// console.log('Item.onDown', item);\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tif (state.active) {\n\t\t\t\t\toutput = false;\n\t\t\t\t\ttrigger();\n\t\t\t\t} else if (item.$nav.onNav) {\n\t\t\t\t\tvar promise = item.$nav.onNav(item, item.$nav);\n\t\t\t\t\tif (promise && typeof promise.then === 'function') {\n\t\t\t\t\t\tpromise.then(function(resolved) {\n\t\t\t\t\t\t\t// go on\n\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t}, function(rejected) {\n\t\t\t\t\t\t\t// do nothing\n\t\t\t\t\t\t});\n\t\t\t\t\t\toutput = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput = promise;\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction trigger() {\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\titemToggle(item);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// preventDefault(e);\n\t\t\t}\n\n\t\t\tfunction onClick(e) {\n\t\t\t\t// console.log('Item.onClick', e);\n\t\t\t\treturn preventDefault(e);\n\t\t\t}\n\n\t\t\tfunction preventDefault(e) {\n\t\t\t\tif (output === false) {\n\t\t\t\t\t// console.log('Item.preventDefault', e);\n\t\t\t\t\te.stop();\n\t\t\t\t\t// e.preventDefault();\n\t\t\t\t\t// e.stopPropagation();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar events = new Events(navItem).add({\n\t\t\t\tdown: onDown,\n\t\t\t\tclick: onClick,\n\t\t\t}, scope);\n\t\t}\n\n    }]);\n\n\tapp.directive('navTo', ['$parse', '$timeout', 'Events', function($parse, $timeout, Events) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tlink: NavToLink\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavToLink(scope, element, attributes) {\n\t\t\tfunction onDown(e) {\n\t\t\t\tconsole.log('navTo.onDown', attributes.navTo);\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tvar callback = $parse(attributes.navTo);\n\t\t\t\t\tcallback(scope);\n\t\t\t\t});\n\t\t\t\te.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar events = new Events(element).add({\n\t\t\t\tdown: onDown,\n\t\t\t}, scope);\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Nav', ['Silent', function(Silent) {\n\n\t\tfunction Nav(options) {\n\t\t\tvar nav = this;\n\t\t\tvar defaults = {\n\t\t\t\titems: [],\n\t\t\t}\n\t\t\tangular.extend(nav, defaults);\n\t\t\tif (options) {\n\t\t\t\tangular.extend(nav, options);\n\t\t\t}\n\t\t\tnav.setNav(nav, null);\n\t\t}\n\n\t\tvar statics = {\n\t\t\tsilent: NavSilent,\n\t\t\tpath: NavPath,\n\t\t};\n\n\t\tvar publics = {\n\t\t\taddItem: addItem,\n\t\t\taddItems: addItems,\n\t\t\tgetPath: getPath,\n\t\t\tsetItems: setItems,\n\t\t\tsetNav: setNav,\n\t\t\tsetNavs: setNavs,\n\t\t};\n\n\t\tangular.extend(Nav, statics);\n\t\tangular.extend(Nav.prototype, publics);\n\n\t\treturn Nav;\n\n\t\t// static methods\n\n\t\tfunction NavSilent(path) {\n\t\t\tSilent.silent(path);\n\t\t}\n\n\t\tfunction NavPath(path) {\n\t\t\tSilent.path(path);\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction setItems(items) {\n\t\t\tvar nav = this;\n\t\t\tnav.path = Silent.path();\n\t\t\tnav.items = items;\n\t\t\tnav.setNavs(items, nav);\n\t\t}\n\n\t\tfunction setNavs(items, parent) {\n\t\t\tvar nav = this;\n\t\t\tif (items) {\n\t\t\t\tangular.forEach(items, function(item) {\n\t\t\t\t\tnav.setNav(item, parent);\n\t\t\t\t\tnav.setNavs(item.items, item);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setNav(item, parent) {\n\t\t\tvar nav = this;\n\t\t\tvar $nav = {\n\t\t\t\tparent: parent || null,\n\t\t\t\tlevel: parent ? parent.$nav.level + 1 : 0,\n\t\t\t\tstate: {},\n\t\t\t\taddItems: function(x) {\n\t\t\t\t\tnav.addItems(x, item);\n\t\t\t\t},\n\t\t\t\tonNav: nav.onNav,\n\t\t\t};\n\t\t\titem.$nav = $nav;\n\t\t\t$nav.path = nav.getPath(item);\n\t\t\tif ($nav.path === nav.path) {\n\t\t\t\t$nav.state.active = true;\n\t\t\t\t$nav.state.opened = true;\n\t\t\t\twhile ($nav.parent) {\n\t\t\t\t\t$nav = $nav.parent.$nav;\n\t\t\t\t\t$nav.state.active = true;\n\t\t\t\t\t$nav.state.opened = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction addItems(itemOrItems, parent) {\n\t\t\tvar nav = this;\n\t\t\tif (angular.isArray(itemOrItems)) {\n\t\t\t\tangular.forEach(itemOrItems, function(item) {\n\t\t\t\t\tnav.addItem(item, parent);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tnav.addItem(itemOrItems, parent);\n\t\t\t}\n\t\t}\n\n\t\tfunction addItem(item, parent) {\n\t\t\tvar nav = this,\n\t\t\t\tonPath = nav.onPath,\n\t\t\t\tonNav = nav.onNav;\n\t\t\tnav.setNav(item, parent);\n\t\t\tif (parent) {\n\t\t\t\tparent.items = parent.items || [];\n\t\t\t\tparent.items.push(item);\n\t\t\t}\n\t\t}\n\n\t\tfunction getPath(item) {\n\t\t\tvar path = null;\n\t\t\tif (this.onPath) {\n\t\t\t\tpath = this.onPath(item, item.$nav);\n\t\t\t} else {\n\t\t\t\tpath = item.path;\n\t\t\t}\n\t\t\treturn path;\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('popuppable', ['$parse', 'State', 'Dom', function($parse, State, Dom) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tlink: link,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction link(scope, element, attributes, model) {\n\n\t\t\tvar state = new State();\n\t\t\tstate.pow = 0;\n\n\t\t\tvar relative, absolute;\n\n\t\t\tvar target, targetElement;\n\n\t\t\tvar from, to, current,\n\t\t\t\tboundingClientRect, styleObj, originalCssText;\n\n\t\t\tvar opened = false;\n\n\t\t\tfunction getStyle(node) {\n\t\t\t\tvar style = window.getComputedStyle(node, null);\n\t\t\t\tvar styleObj = {\n\t\t\t\t\t'display': style.getPropertyValue('display'),\n\t\t\t\t\t'position': style.getPropertyValue('position'),\n\t\t\t\t\t'width': style.getPropertyValue('width'),\n\t\t\t\t\t'height': style.getPropertyValue('height'),\n\t\t\t\t\t'top': style.getPropertyValue('top'),\n\t\t\t\t\t'right': style.getPropertyValue('right'),\n\t\t\t\t\t'bottom': style.getPropertyValue('bottom'),\n\t\t\t\t\t'left': style.getPropertyValue('left'),\n\t\t\t\t\t'margin-top': style.getPropertyValue('margin-top'),\n\t\t\t\t\t'margin-right': style.getPropertyValue('margin-right'),\n\t\t\t\t\t'margin-bottom': style.getPropertyValue('margin-bottom'),\n\t\t\t\t\t'margin-left': style.getPropertyValue('margin-left'),\n\t\t\t\t\t'padding-top': style.getPropertyValue('padding-top'),\n\t\t\t\t\t'padding-right': style.getPropertyValue('padding-right'),\n\t\t\t\t\t'padding-bottom': style.getPropertyValue('padding-bottom'),\n\t\t\t\t\t'padding-left': style.getPropertyValue('padding-left'),\n\t\t\t\t\t'background-color': style.getPropertyValue('background-color'),\n\t\t\t\t};\n\t\t\t\treturn styleObj;\n\t\t\t}\n\n\t\t\tfunction getTextStyle(style) {\n\t\t\t\tvar text = '';\n\t\t\t\tangular.forEach(style, function(value, key) {\n\t\t\t\t\ttext += key + ': ' + value + '; ';\n\t\t\t\t});\n\t\t\t\treturn text;\n\t\t\t}\n\n\t\t\tfunction setStyle(node, style) {\n\t\t\t\tnode.style.cssText = getTextStyle(style);\n\t\t\t}\n\n\t\t\tfunction add() {\n\t\t\t\ttargetElement.addClass('popuppable-opening');\n\t\t\t\tDom.getParents(target).each(function(element, node) {\n\t\t\t\t\telement.addClass('popuppable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction remove() {\n\t\t\t\ttargetElement.removeClass('popuppable-opening');\n\t\t\t\tDom.getParents(target).each(function(element, node) {\n\t\t\t\t\telement.removeClass('popuppable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction open() {\n\t\t\t\tif (!opened) {\n\t\t\t\t\tadd();\n\t\t\t\t\tcurrent = angular.copy(from);\n\t\t\t\t\topenAnimation();\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction close() {\n\t\t\t\tif (opened) {\n\t\t\t\t\tcloseAnimation();\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction update() {\n\t\t\t\tcurrent.left = (from.left + (to.left - from.left) * state.pow) + 'px';\n\t\t\t\tcurrent.top = (from.top + (to.top - from.top) * state.pow) + 'px';\n\t\t\t\tcurrent.width = (from.width + (to.width - from.width) * state.pow) + 'px';\n\t\t\t\tcurrent.height = (from.height + (to.height - from.height) * state.pow) + 'px';\n\t\t\t\tsetStyle(target, current);\n\t\t\t}\n\n\t\t\tfunction toggle() {\n\t\t\t\tif (state.busy()) {\n\t\t\t\t\tif (opened) {\n\t\t\t\t\t\tclose();\n\t\t\t\t\t} else {\n\t\t\t\t\t\topen();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction set() {\n\t\t\t\ttarget = element[0].querySelector(attributes.popuppable);\n\t\t\t\tif (target) {\n\t\t\t\t\ttargetElement = angular.element(target);\n\t\t\t\t\ttargetElement.addClass('popuppable-target');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDown(e) {\n\t\t\t\tset();\n\t\t\t\tif (target) {\n\t\t\t\t\topen();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onUp(e) {\n\t\t\t\tif (Dom.getClosestNode(e.target, element[0])) {\n\t\t\t\t\t// nope\n\t\t\t\t} else {\n\t\t\t\t\tset();\n\t\t\t\t\tif (target) {\n\t\t\t\t\t\tclose();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\tif (opened || state.isBusy) {\n\t\t\t\t\tupdate();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onKeyDown(e) {\n\t\t\t\tvar key = e.key.toLowerCase();\n\t\t\t\tswitch (key) {\n\t\t\t\t\tcase 'escape':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target) {\n\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'enter':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target && target.tagName && target.tagName.toLowerCase() === 'input') {\n\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction addListeners() {\n\t\t\t\tvar trigger = element[0].querySelector('.popuppable-trigger');\n\t\t\t\tvar triggerElement = trigger ? angular.element(trigger) : element;\n\t\t\t\ttriggerElement\n\t\t\t\t\t.on('mousedown touchstart', onDown)\n\t\t\t\t\t.on('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.on('click', onUp)\n\t\t\t\t\t.on('resize', onResize);\n\t\t\t}\n\n\t\t\tfunction removeListeners() {\n\t\t\t\tvar trigger = element[0].querySelector('.popuppable-trigger');\n\t\t\t\tvar triggerElement = trigger ? angular.element(trigger) : element;\n\t\t\t\ttriggerElement\n\t\t\t\t\t.off('mousedown touchstart', onDown)\n\t\t\t\t\t.off('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.off('click', onUp)\n\t\t\t\t\t.off('resize', onResize);\n\t\t\t}\n\n\t\t\tscope.$on('$destroy', function() {\n\t\t\t\tremoveListeners();\n\t\t\t});\n\n\t\t\taddListeners();\n\n\t\t\tset();\n\n\t\t\tfunction openAnimation() {\n\t\t\t\tdynamics.animate(target, {\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tscale: 1\n\t\t\t\t}, {\n\t\t\t\t\ttype: dynamics.spring,\n\t\t\t\t\tfrequency: 200,\n\t\t\t\t\tfriction: 270,\n\t\t\t\t\tduration: 800,\n\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\topened = true;\n\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction closeAnimation() {\n\t\t\t\tdynamics.animate(target, {\n\t\t\t\t\topacity: 0,\n\t\t\t\t\tscale: 0.1\n\t\t\t\t}, {\n\t\t\t\t\ttype: dynamics.easeInOut,\n\t\t\t\t\tduration: 300,\n\t\t\t\t\tfriction: 100,\n\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\topened = false;\n\t\t\t\t\t\tremove();\n\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\twindow.ondragstart = function() {\n\t\treturn false;\n\t};\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('scrollableX', ['$parse', '$compile', '$timeout', 'Scrollable', 'Animate', 'Style', 'Events', 'Utils', function($parse, $compile, $timeout, Scrollable, Animate, Style, Events, Utils) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: '<div class=\"scrollable-content\" ng-transclude></div>',\n\t\t\ttransclude: true,\n\t\t\tlink: function(scope, element, attributes, model) {\n\n\t\t\t\tvar onLeft, onRight, showIndicatorFor, scrollableWhen;\n\t\t\t\tif (attributes.onLeft) {\n\t\t\t\t\tonLeft = $parse(attributes.onLeft);\n\t\t\t\t}\n\t\t\t\tif (attributes.onRight) {\n\t\t\t\t\tonRight = $parse(attributes.onRight);\n\t\t\t\t}\n\t\t\t\tif (attributes.showIndicatorFor) {\n\t\t\t\t\tshowIndicatorFor = $parse(attributes.showIndicatorFor);\n\t\t\t\t}\n\t\t\t\tif (attributes.scrollableWhen) {\n\t\t\t\t\tscrollableWhen = $parse(attributes.scrollableWhen);\n\t\t\t\t}\n\n\t\t\t\t// ELEMENTS & STYLESHEETS;\n\t\t\t\telement.attr('unselectable', 'on').addClass('unselectable');\n\t\t\t\tvar containerNode = element[0];\n\t\t\t\tvar contentNode = containerNode.querySelector('.scrollable-content');\n\t\t\t\tvar content = angular.element(content);\n\t\t\t\tvar contentStyle = new Style();\n\n\t\t\t\tvar animate = new Animate(render);\n\n\t\t\t\tvar scrollable = attributes.scrollableX ? $parse(attributes.scrollableX)(scope) : new Scrollable();\n\n\t\t\t\tlink(scrollable);\n\n\t\t\t\tfunction link(scrollable) {\n\t\t\t\t\tscrollable.link({\n\t\t\t\t\t\tgetItems: function() {\n\t\t\t\t\t\t\tif (attributes.scrollableItem) {\n\t\t\t\t\t\t\t\tvar items = containerNode.querySelectorAll(attributes.scrollableItem);\n\t\t\t\t\t\t\t\treturn items;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprev: function() {\n\t\t\t\t\t\t\tscrollable.scrollPrev();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tnext: function() {\n\t\t\t\t\t\t\tscrollable.scrollNext();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\treset: function() {\n\t\t\t\t\t\t\tscrollable.doReset();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLeft: onLeft,\n\t\t\t\t\t\tonRight: onRight,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/*\n\t\t\t\tscope.$watch(attributes.scrollableX, function (newValue) {\n\t\t\t\t\tconsole.log(newValue);\n\t\t\t\t});\n\t\t\t\t*/\n\n\t\t\t\t/*\n\t\t\t\tvar indicator = null,\n\t\t\t\t\tindicatorNode = null,\n\t\t\t\t\tindicatorStyle;\n\t\t\t\tshowIndicatorFor = false;\n\t\t\t\tif (showIndicatorFor) {\n\t\t\t\t\tindicator = angular.element('<div class=\"indicator\"></div>');\n\t\t\t\t\tindicatorNode = indicator[0];\n\t\t\t\t\tindicatorStyle = new Style();\n\t\t\t\t\telement.append(indicator);\n\t\t\t\t\t$compile(indicator.contents())(scope);\n\t\t\t\t\tvar i = scrollbar.getIndicator();\n\t\t\t\t\tindicatorStyle.transform('translate3d(' + i.x.toFixed(2) + 'px,' + i.y.toFixed(2) + 'px,0)');\n\t\t\t\t\tindicatorStyle.set(indicatorNode);\n\t\t\t\t}\n\t\t\t\t*/\n\n\t\t\t\tfunction render(time) {\n\t\t\t\t\tscrollable.setContainer(containerNode);\n\t\t\t\t\tscrollable.setContent(contentNode);\n\t\t\t\t\tscrollable.setEnabled(isEnabled());\n\t\t\t\t\tvar animating = scrollable.renderX();\n\t\t\t\t\tif (!animating) {\n\t\t\t\t\t\t// animate.pause();\n\t\t\t\t\t}\n\t\t\t\t\tvar current = scrollable.getCurrent();\n\t\t\t\t\tcontentStyle.transform('translate3d(' + current.x.toFixed(2) + 'px,0,0)');\n\t\t\t\t\tcontentStyle.set(contentNode);\n\t\t\t\t\t/*\n\t\t\t\t\tif (showIndicatorFor) {\n\t\t\t\t\t\tif (dragging || wheeling || speed) {\n\t\t\t\t\t\t\tvar percent = c.x / (containerNode.offsetWidth - contentNode.offsetWidth);\n\t\t\t\t\t\t\tpercent = Math.max(0, Math.min(1, percent));\n\t\t\t\t\t\t\ti.x = (containerNode.offsetWidth - indicatorNode.offsetWidth) * (percent);\n\t\t\t\t\t\t\ti.y += (0 - i.y) / 4;\n\t\t\t\t\t\t\t// var count = Math.round(contentNode.offsetWidth / 315);\n\t\t\t\t\t\t\tvar index = Math.max(1, Math.round(percent * showIndicatorFor.rows.length));\n\t\t\t\t\t\t\tindicator.html(index + '/' + showIndicatorFor.count);\n\t\t\t\t\t\t\t// indicator.html((percent * 100).toFixed(2).toString());\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ti.y += (45 - i.y) / 4;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tindicatorStyle.transform('translate3d(' + i.x.toFixed(2) + 'px,' + i.y.toFixed(2) + 'px,0)');\n\t\t\t\t\t\tindicatorStyle.set(indicatorNode);\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t}\n\n\t\t\t\tfunction undrag() {\n\t\t\t\t\tscrollable.off();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction onDown(event) {\n\t\t\t\t\tif (scrollable.dragStart(event.absolute)) {\n\t\t\t\t\t\tdragOn();\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onMove(event) {\n\t\t\t\t\tscrollable.dragMove(event.absolute);\n\t\t\t\t\tvar drag = scrollable.getDrag();\n\t\t\t\t\tif (Math.abs(drag.y) > Math.abs(drag.x)) {\n\t\t\t\t\t\tonUp(event);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onUp(event) {\n\t\t\t\t\tscrollable.dragEnd(event.absolute);\n\t\t\t\t\tevent.stop();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction _onScrollX(dir, interval) {\n\t\t\t\t\treturn scrollable.wheelX(dir, interval);\n\t\t\t\t}\n\n\t\t\t\tvar onScrollX = _onScrollX;\n\t\t\t\t// var onScrollX = Utils.throttle(_onScrollX, 25);\n\n\t\t\t\tfunction onWheel(event) {\n\t\t\t\t\t// console.log('onWheelX', event.dir, scrollable.wheelXCheck(event.dir));\n\t\t\t\t\tif (scrollable.wheelXCheck(event.dir)) {\n\t\t\t\t\t\tonScrollX(event.dir, event.interval);\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction off() {\n\t\t\t\t\tdragOff();\n\t\t\t\t\t// animate.pause();\n\t\t\t\t\tscrollable.off();\n\t\t\t\t}\n\n\t\t\t\tfunction isEnabled() {\n\t\t\t\t\tvar enabled = true;\n\t\t\t\t\tif (scrollableWhen) {\n\t\t\t\t\t\tenabled = enabled && scrollableWhen(scope);\n\t\t\t\t\t}\n\t\t\t\t\tenabled = enabled && window.innerWidth >= 1024;\n\t\t\t\t\tenabled = enabled && (containerNode.offsetWidth < contentNode.offsetWidth);\n\t\t\t\t\treturn enabled;\n\t\t\t\t}\n\n\t\t\t\tfunction onResize() {\n\t\t\t\t\tvar enabled = isEnabled();\n\t\t\t\t\tif (!enabled) {\n\t\t\t\t\t\toff();\n\t\t\t\t\t}\n\t\t\t\t\trender();\n\t\t\t\t}\n\n\t\t\t\tscope.$watch(function() {\n\t\t\t\t\treturn contentNode.offsetWidth;\n\t\t\t\t}, function(newValue, oldValue) {\n\t\t\t\t\tonResize();\n\t\t\t\t});\n\n\t\t\t\tvar events = new Events(element).add({\n\t\t\t\t\tdown: onDown,\n\t\t\t\t\twheel: onWheel,\n\t\t\t\t}, scope);\n\n\t\t\t\tvar windowEvents = new Events(window).add({\n\t\t\t\t\tresize: onResize,\n\t\t\t\t}, scope);\n\n\t\t\t\tfunction dragOn() {\n\t\t\t\t\twindowEvents.add({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t}, scope);\n\t\t\t\t}\n\n\t\t\t\tfunction dragOff() {\n\t\t\t\t\twindowEvents.remove({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tanimate.pause();\n\t\t\t\t});\n\n\t\t\t},\n\t\t};\n    }]);\n\n\tapp.directive('scrollableY', ['$parse', '$compile', '$timeout', 'Scrollable', 'Animate', 'Style', 'Events', 'Utils', function($parse, $compile, $timeout, Scrollable, Animate, Style, Events, Utils) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: '<div class=\"scrollable-content\" ng-transclude></div>',\n\t\t\ttransclude: true,\n\t\t\tlink: function(scope, element, attributes, model) {\n\n\t\t\t\tvar onTop, onBottom, showIndicatorFor, scrollableWhen;\n\t\t\t\tif (attributes.onTop) {\n\t\t\t\t\tonTop = $parse(attributes.onTop);\n\t\t\t\t}\n\t\t\t\tif (attributes.onBottom) {\n\t\t\t\t\tonBottom = $parse(attributes.onBottom);\n\t\t\t\t}\n\t\t\t\tif (attributes.showIndicatorFor) {\n\t\t\t\t\tshowIndicatorFor = $parse(attributes.showIndicatorFor);\n\t\t\t\t}\n\t\t\t\tif (attributes.scrollableWhen) {\n\t\t\t\t\tscrollableWhen = $parse(attributes.scrollableWhen);\n\t\t\t\t}\n\n\t\t\t\t// ELEMENTS & STYLESHEETS;\n\t\t\t\telement.attr('unselectable', 'on').addClass('unselectable');\n\t\t\t\tvar containerNode = element[0];\n\t\t\t\tvar contentNode = containerNode.querySelector('.scrollable-content');\n\t\t\t\tvar content = angular.element(content);\n\t\t\t\tvar contentStyle = new Style();\n\n\t\t\t\tvar animate = new Animate(render);\n\n\t\t\t\tvar scrollable = attributes.scrollableY ? $parse(attributes.scrollableY)(scope) : new Scrollable();\n\t\t\t\tlink(scrollable);\n\n\t\t\t\tfunction link(scrollable) {\n\t\t\t\t\tscrollable.link({\n\t\t\t\t\t\tgetItems: function() {\n\t\t\t\t\t\t\tif (attributes.scrollableItem) {\n\t\t\t\t\t\t\t\tvar items = containerNode.querySelectorAll(attributes.scrollableItem);\n\t\t\t\t\t\t\t\treturn items;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprev: function() {\n\t\t\t\t\t\t\tscrollable.scrollPrev();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tnext: function() {\n\t\t\t\t\t\t\tscrollable.scrollNext();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\treset: function() {\n\t\t\t\t\t\t\tscrollable.doReset();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonTop: onTop,\n\t\t\t\t\t\tonBottom: onBottom,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction render(time) {\n\t\t\t\t\tscrollable.setContainer(containerNode);\n\t\t\t\t\tscrollable.setContent(contentNode);\n\t\t\t\t\tscrollable.setEnabled(isEnabled());\n\t\t\t\t\tvar animating = scrollable.renderY();\n\t\t\t\t\tif (!animating) {\n\t\t\t\t\t\t// animate.pause();\n\t\t\t\t\t}\n\t\t\t\t\tvar current = scrollable.getCurrent();\n\t\t\t\t\tcontentStyle.transform('translate3d(0,' + current.y.toFixed(2) + 'px,0)');\n\t\t\t\t\tcontentStyle.set(contentNode);\n\t\t\t\t}\n\n\t\t\t\tfunction undrag() {\n\t\t\t\t\tscrollable.off();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction onDown(event) {\n\t\t\t\t\tif (scrollable.dragStart(event.absolute)) {\n\t\t\t\t\t\tdragOn();\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onMove(event) {\n\t\t\t\t\tscrollable.dragMove(event.absolute);\n\t\t\t\t\tvar drag = scrollable.getDrag();\n\t\t\t\t\tif (Math.abs(drag.x) > Math.abs(drag.y)) {\n\t\t\t\t\t\tonUp(event);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onUp(event) {\n\t\t\t\t\tscrollable.dragEnd(event.absolute);\n\t\t\t\t\tevent.stop();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction _onScrollY(dir, interval) {\n\t\t\t\t\treturn scrollable.wheelY(dir, interval);\n\t\t\t\t}\n\n\t\t\t\tvar onScrollY = _onScrollY;\n\t\t\t\t// var onScrollY = Utils.throttle(_onScrollY, 25);\n\n\t\t\t\tfunction onWheel(event) {\n\t\t\t\t\t// console.log('onWheelY', event.dir, scrollable.wheelYCheck(event.dir));\n\t\t\t\t\tif (scrollable.wheelYCheck(event.dir)) {\n\t\t\t\t\t\tonScrollY(event.dir, event.interval);\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction off() {\n\t\t\t\t\tdragOff();\n\t\t\t\t\t// animate.pause();\n\t\t\t\t\tscrollable.off();\n\t\t\t\t}\n\n\t\t\t\tfunction isEnabled() {\n\t\t\t\t\tvar enabled = true;\n\t\t\t\t\tif (scrollableWhen) {\n\t\t\t\t\t\tenabled = enabled && scrollableWhen(scope);\n\t\t\t\t\t}\n\t\t\t\t\tenabled = enabled && window.innerWidth >= 1024;\n\t\t\t\t\tenabled = enabled && (containerNode.offsetHeight < contentNode.offsetHeight);\n\t\t\t\t\treturn enabled;\n\t\t\t\t}\n\n\t\t\t\tfunction onResize() {\n\t\t\t\t\tvar enabled = isEnabled();\n\t\t\t\t\tif (!enabled) {\n\t\t\t\t\t\toff();\n\t\t\t\t\t}\n\t\t\t\t\trender();\n\t\t\t\t}\n\n\t\t\t\tscope.$watch(function() {\n\t\t\t\t\treturn contentNode.offsetHeight;\n\t\t\t\t}, function(newValue, oldValue) {\n\t\t\t\t\tonResize();\n\t\t\t\t});\n\n\t\t\t\tvar events = new Events(element).add({\n\t\t\t\t\tdown: onDown,\n\t\t\t\t\twheel: onWheel,\n\t\t\t\t}, scope);\n\n\t\t\t\tvar windowEvents = new Events(window).add({\n\t\t\t\t\tresize: onResize,\n\t\t\t\t}, scope);\n\n\t\t\t\tfunction dragOn() {\n\t\t\t\t\twindowEvents.add({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t}, scope);\n\t\t\t\t}\n\n\t\t\t\tfunction dragOff() {\n\t\t\t\t\twindowEvents.remove({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tanimate.pause();\n\t\t\t\t});\n\n\t\t\t},\n\t\t};\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Scrollable', ['Utils', 'Point', 'Rect', function(Utils, Point, Rect) {\n\n\t\tfunction Scrollable() {\n\n\t\t\tvar padding = 150;\n\t\t\tvar enabled, snappable, busy, dragging, wheeling, down, move, prev;\n\t\t\tvar currentIndex = 0;\n\n\t\t\tsnappable = true;\n\n\t\t\tvar start = new Point(),\n\t\t\t\tend = new Point(),\n\t\t\t\tcurrent = new Point(),\n\t\t\t\tdrag = new Point(),\n\t\t\t\tindicator = new Point(),\n\t\t\t\toffset = new Point(),\n\t\t\t\tspeed = new Point(),\n\t\t\t\tcontainer = new Rect(),\n\t\t\t\tcontent = new Rect(),\n\t\t\t\toverflow = new Rect();\n\n\t\t\tvar scrollable = {\n\t\t\t\t// properties\n\t\t\t\tstart: start,\n\t\t\t\tend: end,\n\t\t\t\tcurrent: current,\n\t\t\t\tindicator: indicator,\n\t\t\t\tspeed: speed,\n\t\t\t\toverflow: overflow,\n\t\t\t\tcontainer: container,\n\t\t\t\tcontent: content,\n\t\t\t\t// methods\n\t\t\t\tsetContainer: setContainer,\n\t\t\t\tsetContent: setContent,\n\t\t\t\tsetEnabled: setEnabled,\n\t\t\t\tgetCurrent: getCurrent,\n\t\t\t\tgetDrag: getDrag,\n\t\t\t\tgetIndicator: getIndicator,\n\t\t\t\tgetIndex: getIndex,\n\t\t\t\tscrollToIndex: scrollToIndex,\n\t\t\t\tscrollPrev: scrollPrev,\n\t\t\t\tscrollNext: scrollNext,\n\t\t\t\tdragStart: dragStart,\n\t\t\t\tdragMove: dragMove,\n\t\t\t\tdragEnd: dragEnd,\n\t\t\t\tdoReset: doReset,\n\t\t\t\toff: off,\n\t\t\t\t// x direction\n\t\t\t\tdoLeft: doLeft,\n\t\t\t\tdoRight: doRight,\n\t\t\t\trenderX: renderX,\n\t\t\t\tscrollToX: scrollToX,\n\t\t\t\twheelX: wheelX,\n\t\t\t\twheelXCheck: wheelXCheck,\n\t\t\t\t// y direction\n\t\t\t\tdoTop: doTop,\n\t\t\t\tdoBottom: doBottom,\n\t\t\t\trenderY: renderY,\n\t\t\t\tscrollToY: scrollToY,\n\t\t\t\twheelY: wheelY,\n\t\t\t\twheelYCheck: wheelYCheck,\n\t\t\t};\n\n\t\t\tangular.extend(this, scrollable);\n\n\t\t\tscrollable = this;\n\n\t\t\tfunction setContainer(node) {\n\t\t\t\tcontainer.width = node.offsetWidth;\n\t\t\t\tcontainer.height = node.offsetHeight;\n\t\t\t}\n\n\t\t\tfunction setContent(node) {\n\t\t\t\tcontent.width = node.offsetWidth;\n\t\t\t\tcontent.height = node.offsetHeight;\n\t\t\t}\n\n\t\t\tfunction setEnabled(flag) {\n\t\t\t\tenabled = flag;\n\t\t\t}\n\n\t\t\tfunction getCurrent() {\n\t\t\t\treturn current;\n\t\t\t}\n\n\t\t\tfunction getDrag() {\n\t\t\t\treturn drag;\n\t\t\t}\n\n\t\t\tfunction getIndicator() {\n\t\t\t\treturn indicator;\n\t\t\t}\n\n\t\t\tfunction getIndex() {\n\t\t\t\treturn currentIndex;\n\t\t\t}\n\n\t\t\tfunction scrollToIndex(index) {\n\t\t\t\tif (index !== currentIndex) {\n\t\t\t\t\tcurrentIndex = index;\n\t\t\t\t\tvar item = getItemAtIndex(index);\n\t\t\t\t\tif (item) {\n\t\t\t\t\t\toffset = new Point(\n\t\t\t\t\t\t\titem.offsetLeft,\n\t\t\t\t\t\t\titem.offsetTop\n\t\t\t\t\t\t);\n\t\t\t\t\t\t// console.log('scrollToIndex', index, offset);\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction dragStart(point) {\n\t\t\t\tif (!busy) {\n\t\t\t\t\tstart.x = end.x = current.x;\n\t\t\t\t\tstart.y = end.y = current.y;\n\t\t\t\t\tspeed.x = 0;\n\t\t\t\t\tspeed.y = 0;\n\t\t\t\t\tdown = point;\n\t\t\t\t\tcurrentIndex = -1;\n\t\t\t\t\twheeling = false;\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction dragMove(point) {\n\t\t\t\tprev = move;\n\t\t\t\tmove = point;\n\t\t\t\tdrag.x = move.x - down.x;\n\t\t\t\tdrag.y = move.y - down.y;\n\t\t\t\tdragging = true;\n\t\t\t}\n\n\t\t\tfunction dragEnd() {\n\t\t\t\tif (move && prev) {\n\t\t\t\t\tspeed.x += (move.x - prev.x) * 4;\n\t\t\t\t\tspeed.y += (move.y - prev.y) * 4;\n\t\t\t\t}\n\t\t\t\tstart.x = end.x = current.x;\n\t\t\t\tstart.y = end.y = current.y;\n\t\t\t\tdragging = false;\n\t\t\t\tmove = null;\n\t\t\t\tdown = null;\n\t\t\t\tprev = null;\n\t\t\t}\n\n\t\t\tfunction getItemAtIndex(index) {\n\t\t\t\tvar item = null;\n\t\t\t\tvar items = scrollable.getItems();\n\t\t\t\tif (items) {\n\t\t\t\t\tif (index >= 0 && index < items.length) {\n\t\t\t\t\t\titem = items[index];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// console.log('getItemAtIndex', index, items.length, item);\n\t\t\t\treturn item;\n\t\t\t}\n\n\t\t\tfunction scrollPrev() {\n\t\t\t\tvar index = Math.max(0, currentIndex - 1);\n\t\t\t\tconsole.log('scrollPrev', index);\n\t\t\t\tscrollToIndex(index);\n\t\t\t}\n\n\t\t\tfunction scrollNext() {\n\t\t\t\tvar items = scrollable.getItems();\n\t\t\t\tvar index = Math.min(items.length - 1, currentIndex + 1);\n\t\t\t\tconsole.log('scrollNext', index);\n\t\t\t\tscrollToIndex(index);\n\t\t\t}\n\n\t\t\tfunction doReset() {\n\t\t\t\tend.x = current.x = 0;\n\t\t\t}\n\n\t\t\tfunction off() {\n\t\t\t\tdragging = false;\n\t\t\t\twheeling = false;\n\t\t\t\tmove = null;\n\t\t\t\tdown = null;\n\t\t\t}\n\n\t\t\t// x - direction\n\n\t\t\tfunction doLeft(scope) {\n\t\t\t\tif (busy) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!scrollable.onLeft) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbusy = true;\n\t\t\t\tscrollable.onLeft(scope).then().finally(function() {\n\t\t\t\t\tscrollToX(0);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction doRight(scope) {\n\t\t\t\tif (busy) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!scrollable.onRight) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbusy = true;\n\t\t\t\tscrollable.onRight(scope).then().finally(function() {\n\t\t\t\t\tvar right = container.width - content.width;\n\t\t\t\t\tif (right > overflow.width) {\n\t\t\t\t\t\tstart.x = end.x = overflow.width;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstart.x = end.x = overflow.width + padding;\n\t\t\t\t\t}\n\t\t\t\t\tscrollToX(0);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction renderX() {\n\t\t\t\tvar animating = true;\n\t\t\t\tif (enabled) {\n\t\t\t\t\toverflow.x = 0;\n\t\t\t\t\toverflow.width = container.width - content.width;\n\t\t\t\t\tif (dragging) {\n\t\t\t\t\t\tend.x = start.x + move.x - down.x;\n\t\t\t\t\t\tif (extendX()) {\n\t\t\t\t\t\t\tstart.x = end.x;\n\t\t\t\t\t\t\tdown.x = move.x;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (speed.x) {\n\t\t\t\t\t\tend.x += speed.x;\n\t\t\t\t\t\tspeed.x *= 0.75;\n\t\t\t\t\t\tif (wheeling) {\n\t\t\t\t\t\t\textendX();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Math.abs(speed.x) < 2.05) {\n\t\t\t\t\t\t\tspeed.x = 0;\n\t\t\t\t\t\t\tscrollable.wheeling = wheeling = false;\n\t\t\t\t\t\t\tsnapToNearestX();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (offset) {\n\t\t\t\t\t\tend.x = -offset.x;\n\t\t\t\t\t\toffset = null;\n\t\t\t\t\t}\n\t\t\t\t\tend.x = Math.round(end.x * 10000) / 10000;\n\t\t\t\t\tend.x = Math.min(overflow.x, end.x);\n\t\t\t\t\tend.x = Math.max(overflow.width, end.x);\n\t\t\t\t\tcurrent.x += (end.x - current.x) / 4;\n\t\t\t\t\tif (speed.x === 0 && Math.abs(end.x - current.x) < 0.05) {\n\t\t\t\t\t\tcurrent.x = end.x;\n\t\t\t\t\t\tif (!snapToNearestX()) {\n\t\t\t\t\t\t\tanimating = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// console.log('renderX', current.x, end.x, overflow.x);\n\t\t\t\t} else {\n\t\t\t\t\tcurrent.x = end.x = 0;\n\t\t\t\t\tanimating = false;\n\t\t\t\t}\n\t\t\t\treturn animating;\n\t\t\t}\n\n\t\t\tfunction extendX() {\n\t\t\t\tvar extending = false;\n\t\t\t\toverflow.x += padding;\n\t\t\t\toverflow.width -= padding;\n\t\t\t\tif (end.x > overflow.x) {\n\t\t\t\t\textending = true;\n\t\t\t\t\tdoLeft();\n\t\t\t\t} else if (end.x < overflow.width) {\n\t\t\t\t\textending = true;\n\t\t\t\t\tdoRight();\n\t\t\t\t}\n\t\t\t\treturn extending;\n\t\t\t}\n\n\t\t\tfunction snapToNearestX() {\n\t\t\t\tvar items = scrollable.getItems();\n\t\t\t\tif (items) {\n\t\t\t\t\tvar index = -1;\n\t\t\t\t\tvar min = Number.POSITIVE_INFINITY;\n\t\t\t\t\tangular.forEach(items, function(item, i) {\n\t\t\t\t\t\tvar distance = Math.abs((end.x + speed.x) - (item.offsetLeft * -1));\n\t\t\t\t\t\tif (distance < min) {\n\t\t\t\t\t\t\tmin = distance;\n\t\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\tif (snappable) {\n\t\t\t\t\t\t\treturn scrollToIndex(index);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcurrentIndex = index;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction wheelXCheck(dir) {\n\t\t\t\t// console.log('wheelYCheck', dir < 0 ? (end.x - overflow.width) : (end.x - overflow.x));\n\t\t\t\tif (!busy && enabled) {\n\t\t\t\t\tif (dir < 0) {\n\t\t\t\t\t\treturn end.x - overflow.width;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn end.x - overflow.x;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction wheelX(dir, interval) {\n\t\t\t\tend.x += dir * 100 / 1000 * interval;\n\t\t\t\tspeed.x += dir * 100 / 1000 * interval;\n\t\t\t\twheeling = true;\n\t\t\t}\n\n\t\t\tfunction scrollToX(value) {\n\t\t\t\tstart.x = end.x = value;\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\toff();\n\t\t\t\t\tbusy = false;\n\t\t\t\t}, 500);\n\t\t\t}\n\n\t\t\t// y - direction\n\n\t\t\tfunction doTop(scope) {\n\t\t\t\tif (busy) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!scrollable.onTop) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbusy = true;\n\t\t\t\tscrollable.onTop(scope).then().finally(function() {\n\t\t\t\t\tscrollToY(0);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction doBottom(scope) {\n\t\t\t\tif (busy) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!scrollable.onBottom) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbusy = true;\n\t\t\t\tscrollable.onBottom(scope).then().finally(function() {\n\t\t\t\t\tvar bottom = container.height - content.height;\n\t\t\t\t\tif (bottom > overflow.height) {\n\t\t\t\t\t\tstart.y = end.y = overflow.height;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstart.y = end.y = overflow.height + padding;\n\t\t\t\t\t}\n\t\t\t\t\tscrollToY(0);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction renderY() {\n\t\t\t\tvar animating = true;\n\t\t\t\tif (enabled) {\n\t\t\t\t\toverflow.y = 0;\n\t\t\t\t\toverflow.height = container.height - content.height;\n\t\t\t\t\tif (dragging) {\n\t\t\t\t\t\tend.y = start.y + move.y - down.y;\n\t\t\t\t\t\tif (extendY()) {\n\t\t\t\t\t\t\tstart.y = end.y;\n\t\t\t\t\t\t\tdown.y = move.y;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (speed.y) {\n\t\t\t\t\t\tend.y += speed.y;\n\t\t\t\t\t\tspeed.y *= 0.75;\n\t\t\t\t\t\tif (wheeling) {\n\t\t\t\t\t\t\textendY();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Math.abs(speed.y) < 2.05) {\n\t\t\t\t\t\t\tspeed.y = 0;\n\t\t\t\t\t\t\tscrollable.wheeling = wheeling = false;\n\t\t\t\t\t\t\tsnapToNearestY();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (offset) {\n\t\t\t\t\t\tend.y = -offset.y;\n\t\t\t\t\t\toffset = null;\n\t\t\t\t\t}\n\t\t\t\t\tend.y = Math.round(end.y * 10000) / 10000;\n\t\t\t\t\tend.y = Math.min(overflow.y, end.y);\n\t\t\t\t\tend.y = Math.max(overflow.height, end.y);\n\t\t\t\t\tcurrent.y += (end.y - current.y) / 4;\n\t\t\t\t\tif (speed.y === 0 && Math.abs(end.y - current.y) < 0.05) {\n\t\t\t\t\t\tcurrent.y = end.y;\n\t\t\t\t\t\tif (!snapToNearestY()) {\n\t\t\t\t\t\t\tanimating = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// console.log(parseFloat(current.y.toFixed(6)), end.y, overflow.y);\n\t\t\t\t\t// console.log(dragging, wheeling, end.y, speed.y, Math.abs(end.y - current.y));\n\t\t\t\t} else {\n\t\t\t\t\tcurrent.y = end.y = 0;\n\t\t\t\t\tanimating = false;\n\t\t\t\t}\n\t\t\t\treturn animating;\n\t\t\t}\n\n\t\t\tfunction extendY() {\n\t\t\t\tvar extending = false;\n\t\t\t\toverflow.y += padding;\n\t\t\t\toverflow.height -= padding;\n\t\t\t\tif (end.y > overflow.y) {\n\t\t\t\t\textending = true;\n\t\t\t\t\tdoTop();\n\t\t\t\t} else if (end.y < overflow.height) {\n\t\t\t\t\textending = true;\n\t\t\t\t\tdoBottom();\n\t\t\t\t}\n\t\t\t\treturn extending;\n\t\t\t}\n\n\t\t\tfunction snapToNearestY() {\n\t\t\t\tvar items = scrollable.getItems();\n\t\t\t\tif (items) {\n\t\t\t\t\tvar index = -1;\n\t\t\t\t\tvar min = Number.POSITIVE_INFINITY;\n\t\t\t\t\tangular.forEach(items, function(item, i) {\n\t\t\t\t\t\tvar distance = Math.abs((end.y + speed.y) - (item.offsetTop * -1));\n\t\t\t\t\t\tif (distance < min) {\n\t\t\t\t\t\t\tmin = distance;\n\t\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t// console.log('snapToNearestY', index, min);\n\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\tif (snappable) {\n\t\t\t\t\t\t\treturn scrollToIndex(index);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcurrentIndex = index;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction wheelYCheck(dir) {\n\t\t\t\t// console.log('wheelYCheck', dir < 0 ? (end.y - overflow.height) : (end.y - overflow.y));\n\t\t\t\tif (!busy && enabled) {\n\t\t\t\t\tif (dir < 0) {\n\t\t\t\t\t\treturn end.y - overflow.height;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn end.y - overflow.y;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction wheelY(dir, interval) {\n\t\t\t\tend.y += dir * 100 / 1000 * interval;\n\t\t\t\tspeed.y += dir * 100 / 1000 * interval;\n\t\t\t\twheeling = true;\n\t\t\t}\n\n\t\t\tfunction scrollToY(value) {\n\t\t\t\tstart.y = end.y = value;\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\toff();\n\t\t\t\t\tbusy = false;\n\t\t\t\t}, 500);\n\t\t\t}\n\n\t\t}\n\n\t\tfunction link(methods) {\n\t\t\tangular.extend(this, methods);\n\t\t}\n\n\t\tScrollable.prototype = {\n\t\t\tlink: link,\n\t\t\tgetItems: function() {\n\t\t\t\treturn [content];\n\t\t\t},\n\t\t};\n\t\treturn Scrollable;\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('videoSource', ['$timeout', '$promise', function($timeout, $promise) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\tsource: '=videoSource',\n\t\t\t\timage: '=videoImage',\n\t\t\t},\n\t\t\ttemplateUrl: function(element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/video/partial/video-player';\n\t\t\t},\n\t\t\tlink: VideoSourceLink\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction VideoSourceLink(scope, element, attributes) {\n\n\t\t\tvar native = element[0];\n\t\t\tvar video = native.querySelector('video');\n\t\t\tvar img = native.querySelector('img');\n\t\t\tvar infos = {};\n\t\t\tscope.canplay = false;\n\t\t\tscope.playing = false;\n\t\t\tscope.busy = false;\n\t\t\tscope.toggle = toggle;\n\t\t\tscope.play = play;\n\t\t\tscope.pause = pause;\n\t\t\tscope.infos = infos;\n\n\t\t\t// loop><source src=\"{{source}}\" type=\"video/mp4\"\n\n\t\t\tfunction canplay() {\n\t\t\t\treturn $promise(function(promise) {\n\n\t\t\t\t\tfunction _onCanPlay(e) {\n\t\t\t\t\t\tscope.canplay = true;\n\t\t\t\t\t\tangular.element(video).off('canplay', _onCanPlay);\n\t\t\t\t\t\t// console.log('videoSource._onCanPlay', e);\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (scope.canplay) {\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tangular.element(video).on('canplay', _onCanPlay);\n\t\t\t\t\t\tvideo.preload = true;\n\t\t\t\t\t\tvideo.src = scope.source;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction toggle() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tif (scope.playing) {\n\t\t\t\t\t\tvideo.pause();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcanplay().then(function() {\n\t\t\t\t\t\t\tvideo.play();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction play() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tcanplay().then(function() {\n\t\t\t\t\t\tvideo.play();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction pause() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tvideo.pause();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onCanPlay(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tscope.canplay = true;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onPlaying(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tscope.playing = true;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onPause(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tscope.playing = false;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onEnded(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tscope.playing = false;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onProgress(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tinfos.buffered = video.buffered; // todo: TimeRanges\n\t\t\t\t\t// console.log('onProgress', infos);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onTimeUpdate(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tinfos.duration = video.duration;\n\t\t\t\t\tinfos.currentTime = video.currentTime;\n\t\t\t\t\tinfos.progressTime = infos.currentTime / infos.duration;\n\t\t\t\t\t// console.log('onTimeUpdate', infos);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar videoElement = angular.element(video);\n\n\t\t\tfunction addListeners() {\n\t\t\t\t// videoElement.on('canplay', onCanPlay);\n\t\t\t\tvideoElement.on('playing', onPlaying);\n\t\t\t\tvideoElement.on('pause', onPause);\n\t\t\t\tvideoElement.on('ended', onEnded);\n\t\t\t\tvideoElement.on('progress', onProgress);\n\t\t\t\tvideoElement.on('timeupdate', onTimeUpdate);\n\t\t\t}\n\n\t\t\tfunction removeListeners() {\n\t\t\t\t// videoElement.off('canplay', onCanPlay);\n\t\t\t\tvideoElement.off('playing', onPlaying);\n\t\t\t\tvideoElement.off('pause', onPause);\n\t\t\t\tvideoElement.off('ended', onEnded);\n\t\t\t\tvideoElement.off('progress', onProgress);\n\t\t\t\tvideoElement.off('timeupdate', onTimeUpdate);\n\t\t\t}\n\n\t\t\taddListeners();\n\t\t\tscope.$on('destroy', function() {\n\t\t\t\tremoveListeners();\n\t\t\t});\n\n\t\t}\n\n    }]);\n\n\t/*\n\tObject.defineProperty(HTMLMediaElement.prototype, 'playing', {\n\t    get: function () {\n\t        return !!(this.currentTime > 0 && !this.paused && !this.ended && this.readyState > 2);\n\t    }\n\t});\n\t*/\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Animate', [function() {\n\n\t\tfunction Animate(callback) {\n\t\t\tthis.callback = callback;\n\t\t\tthis.key = null;\n\t\t\tthis.ticks = 0;\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tpause: pause,\n\t\t\tplay: play,\n\t\t\ttoggle: toggle,\n\t\t};\n\n\t\tangular.extend(Animate, statics);\n\t\tangular.extend(Animate.prototype, publics);\n\n\t\treturn Animate;\n\n\t\t// static methods\n\n\t\t// prototype methods\n\n\t\tfunction pause() {\n\t\t\tvar animate = this;\n\t\t\tif (animate.key) {\n\t\t\t\twindow.cancelAnimationFrame(animate.key);\n\t\t\t\tanimate.key = null;\n\t\t\t}\n\t\t}\n\n\t\tfunction play() {\n\t\t\tvar animate = this;\n\n\t\t\tfunction loop(time) {\n\t\t\t\tanimate.ticks++;\n\t\t\t\tanimate.callback(time, animate.ticks);\n\t\t\t\tanimate.key = window.requestAnimationFrame(loop);\n\t\t\t}\n\t\t\tif (!animate.key) {\n\t\t\t\tloop();\n\t\t\t}\n\t\t}\n\n\t\tfunction toggle() {\n\t\t\tvar animate = this;\n\t\t\tif (animate.key) {\n\t\t\t\tanimate.pause();\n\t\t\t} else {\n\t\t\t\tanimate.play();\n\t\t\t}\n\t\t}\n\n    }]);\n\n\t(function() {\n\t\tvar lastTime = 0;\n\t\tvar vendors = ['ms', 'moz', 'webkit', 'o'];\n\t\tfor (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n\t\t\twindow.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n\t\t\twindow.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n\t\t\t\twindow[vendors[x] + 'CancelRequestAnimationFrame'];\n\t\t}\n\t\tif (!window.requestAnimationFrame) {\n\t\t\twindow.requestAnimationFrame = function(callback, element) {\n\t\t\t\tvar currTime = new Date().getTime();\n\t\t\t\tvar timeToCall = Math.max(0, 16 - (currTime - lastTime));\n\t\t\t\tvar id = window.setTimeout(function() {\n\t\t\t\t\tcallback(currTime + timeToCall);\n\t\t\t\t}, timeToCall);\n\t\t\t\tlastTime = currTime + timeToCall;\n\t\t\t\treturn id;\n\t\t\t};\n\t\t}\n\t\tif (!window.cancelAnimationFrame) {\n\t\t\twindow.cancelAnimationFrame = function(id) {\n\t\t\t\tclearTimeout(id);\n\t\t\t};\n\t\t}\n\t}());\n\n}());\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('calendarPopupRecords', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: function(element, attributes) {\n\t\t\t\treturn '<div calendar-popup=\"options\"></div>';\n\t\t\t},\n\t\t\trequire: 'ngModel',\n\t\t\tscope: {\n\t\t\t\tuser: '=calendarUser',\n\t\t\t},\n\t\t\tlink: function(scope, element, attributes, model, transclude) {\n\n\t\t\t\tvar user = scope.user;\n\n\t\t\t\tvar state = new State();\n\n\t\t\t\tvar options = {\n\t\t\t\t\tonMonthDidChange: onMonthDidChange,\n\t\t\t\t\tonWeekDidSelect: onWeekDidSelect,\n\t\t\t\t\tonDayDidSelect: onDayDidSelect,\n\t\t\t\t};\n\n\t\t\t\tvar sources = {};\n\n\t\t\t\tvar publics = {\n\t\t\t\t\t// user: user,\n\t\t\t\t\tstate: state,\n\t\t\t\t\toptions: options,\n\t\t\t\t\t// sources: sources,\n\t\t\t\t};\n\n\t\t\t\tangular.extend(scope, publics);\n\n\t\t\t\tvar currentDay = Range.Day();\n\n\t\t\t\tstate.busy();\n\t\t\t\t$q.all([\n                    Api.gantt.resources.actives().then(function success(response) {\n\t\t\t\t\t\tsetResources(response);\n\t\t\t\t\t}),\n\n                ]).then(function success(response) {\n\t\t\t\t\tstate.ready();\n\n\t\t\t\t}, function error(error) {\n\t\t\t\t\tstate.error(error);\n\t\t\t\t\t// console.log('calendarPopup.error', error);\n\n\t\t\t\t});\n\n\t\t\t\tfunction onMonthDidChange(date, month, calendar) {\n\t\t\t\t\tvar deferred = $q.defer();\n\t\t\t\t\t// console.log('calendarPopupRecords.onMonthDidChange', month.toString());\n\t\t\t\t\tGetMonthRecords(month).then(function() {\n\t\t\t\t\t\tsetAbsencesAndOvertimes();\n\t\t\t\t\t\tupdateCalendar(date, month, calendar);\n\t\t\t\t\t\tdeferred.resolve(getFirstWorkingDate(date, month, calendar));\n\n\t\t\t\t\t}, function() {\n\t\t\t\t\t\tdeferred.reject();\n\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction GetMonthRecords(month) {\n\t\t\t\t\tvar deferred = $q.defer();\n\t\t\t\t\tvar monthExpanded = Range.expand(month, DateTime.DAY * 7);\n\t\t\t\t\t// console.log('calendarPopupRecords.GetMonthRecords', monthExpanded.toString());\n\t\t\t\t\t$q.all([\n                        Api.gantt.absencesAndOvertimes(monthExpanded.getParams()).then(function success(response) {\n\t\t\t\t\t\t\tsources.absencesAndOvertimes = response;\n\t\t\t\t\t\t}),\n                        Api.gantt.calendar(monthExpanded.getParams()).then(function success(response) {\n\t\t\t\t\t\t\tvar unworkings = {};\n\t\t\t\t\t\t\tangular.forEach(response, function(item) {\n\t\t\t\t\t\t\t\tunworkings[item.key] = item;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tsources.unworkings = unworkings;\n\t\t\t\t\t\t\tsources.calendar = response;\n\t\t\t\t\t\t}),\n                        /*\n                        Api.gantt.planning.full(user.id, monthExpanded.getParams()).then(function (rows) {\n                            sources.monthSlots = rows.map(function (row) {\n                                row.day.date = new Date(row.day.date);\n                                return row;\n                            });\n                        }),\n                        */\n                        Api.gantt.records(user.id, monthExpanded.getParams()).then(function(rows) {\n\t\t\t\t\t\t\tsources.monthRecords = rows.map(function(row) {\n\t\t\t\t\t\t\t\trow.state = new State();\n\t\t\t\t\t\t\t\trow.record.date = new Date(row.record.date);\n\t\t\t\t\t\t\t\treturn row;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}),\n\n                    ]).then(function(response) {\n\t\t\t\t\t\t// state.success();\n\t\t\t\t\t\tdeferred.resolve();\n\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\t// state.error(error);\n\t\t\t\t\t\tdeferred.reject();\n\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t}\n\n\t\t\t\tfunction onWeekDidSelect(week, month, calendar) {\n\t\t\t\t\t// console.log('calendarPopupRecords.onWeekDidSelect', month.toString());\n\t\t\t\t\t// var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tfunction onDayDidSelect(day, month, calendar) {\n\t\t\t\t\t// var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n\t\t\t\t\tif (!day || currentDay.isBefore(day.date)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// console.log('calendarPopupRecords.onDayDidSelect', day, day.working, day.date);\n\t\t\t\t\tif (day && day.working) {\n\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\tmodel.$setViewValue(day.date);\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction updateCalendar(date, month, calendar) {\n\t\t\t\t\tvar resource = sources.resource;\n\t\t\t\t\tvar monthRecords = sources.monthRecords;\n\t\t\t\t\tif (!monthRecords) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcalendar.days.each(function(day) {\n\t\t\t\t\t\tvar availableHours = 0;\n\t\t\t\t\t\tif (day.working) {\n\t\t\t\t\t\t\tavailableHours += resource.baseHours;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar ao = resource.absencesAndOvertimes[day.key];\n\t\t\t\t\t\tif (ao) {\n\t\t\t\t\t\t\tavailableHours += ao.hours;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tday.availableHours = availableHours;\n\t\t\t\t\t\tday.recordedHours = 0;\n\t\t\t\t\t\t//\n\t\t\t\t\t\tvar has = availableHours > 0;\n\t\t\t\t\t\tday.working = !sources.unworkings[day.key];\n\t\t\t\t\t\tday.holiday = !day.working && !has && !day.weekend;\n\t\t\t\t\t\tday.vacation = day.working && !has;\n\t\t\t\t\t\tday.wasVacation = day.vacation && day.past;\n\t\t\t\t\t\tday.wasWorkable = day.working && day.past && has;\n\t\t\t\t\t\tday.workable = day.working && !day.past && has;\n\t\t\t\t\t});\n\t\t\t\t\tangular.forEach(monthRecords, function(row) {\n\t\t\t\t\t\tvar day = calendar.days.get(row.record.key);\n\t\t\t\t\t\tif (day) {\n\t\t\t\t\t\t\tday.recordedHours += row.record.hours;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tcalendar.days.each(function(day) {\n\t\t\t\t\t\tday.green = day.working && !currentDay.isBefore(day.date) && day.recordedHours >= 8;\n\t\t\t\t\t\tday.orange = day.working && !currentDay.isBefore(day.date) && day.recordedHours < 8;\n\t\t\t\t\t\t// day.full = day.workable && day.hours >= day.availableHours;\n\t\t\t\t\t\t// day.available = day.workable && day.hours < day.availableHours;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction setResources(resources) {\n\t\t\t\t\tsources.resources = resources;\n\t\t\t\t\tangular.forEach(resources, function(resource) {\n\t\t\t\t\t\tresource.absencesAndOvertimes = {};\n\t\t\t\t\t\tif (resource.id === user.id) {\n\t\t\t\t\t\t\tsources.resource = resource;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction setAbsencesAndOvertimes() {\n\t\t\t\t\tvar resource = sources.resource;\n\t\t\t\t\tif (!resource) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// assegno assenze e straordinari alla risorsa\n\t\t\t\t\tresource.absencesAndOvertimes = {};\n\t\t\t\t\tangular.forEach(sources.absencesAndOvertimes, function(item) {\n\t\t\t\t\t\tif (resource.id === item.resourceId) {\n\t\t\t\t\t\t\tresource.absencesAndOvertimes[item.key] = item;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction getFirstWorkingDate(date, month, calendar) {\n\t\t\t\t\t// console.log('calendarPopupRecords.getFirstWorkingDate', date);\n\t\t\t\t\tvar firstWorkingDate = null;\n\n\t\t\t\t\tfunction setFirstDay() {\n\t\t\t\t\t\tcalendar.days.forward();\n\t\t\t\t\t\tcalendar.days.each(function(day) {\n\t\t\t\t\t\t\tif (!firstWorkingDate && !month.isOutside(day.date) && day.working && !day.vacation) {\n\t\t\t\t\t\t\t\t// console.log('check', day.working, day.vacation, day.date);\n\t\t\t\t\t\t\t\tfirstWorkingDate = day.date;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// console.log('setFirstDay', firstWorkingDate);\n\t\t\t\t\t}\n\t\t\t\t\tif (date) {\n\t\t\t\t\t\tvar key = CalendarFactory.getKey(date);\n\t\t\t\t\t\tvar day = calendar.days.get(key);\n\t\t\t\t\t\t// console.log('getFirstWorkingDate', day.working, day.vacation, date);\n\t\t\t\t\t\tif (day && day.working && !day.vacation) {\n\t\t\t\t\t\t\tfirstWorkingDate = date;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetFirstDay();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetFirstDay();\n\t\t\t\t\t}\n\t\t\t\t\treturn firstWorkingDate;\n\t\t\t\t}\n\n\t\t\t}\n\t\t};\n    }]);\n\n\tapp.directive('calendarPopup', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n\n\t\treturn {\n\t\t\tpriority: 1002,\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: TemplateUrl,\n\t\t\tscope: {\n\t\t\t\toptions: '=calendarPopup',\n\t\t\t},\n\t\t\tlink: Link,\n\t\t};\n\n\t\tfunction TemplateUrl(element, attributes) {\n\t\t\tvar url = attributes.template;\n\t\t\tif (!url) {\n\t\t\t\turl = 'partials/calendar/popup';\n\t\t\t\tif (!$templateCache.get(url)) {\n\t\t\t\t\t$templateCache.put(url, '<div><json-formatter json=\"item\"></json-formatter></div>');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn url;\n\t\t}\n\n\t\tfunction Link(scope, element, attributes, model, transclude) {\n\n\t\t\tvar calendar = new CalendarFactory();\n\n\t\t\tvar options = scope.options || {\n\t\t\t\tonMonthDidChange: function() {},\n\t\t\t\tonWeekDidSelect: function() {},\n\t\t\t\tonDayDidSelect: function() {},\n\t\t\t};\n\n\t\t\tvar month = Range.Month();\n\t\t\tvar week = Range.Week();\n\t\t\tvar day = Range.Day();\n\n\t\t\tvar sources = {\n\t\t\t\tmonth: month,\n\t\t\t\tweek: week,\n\t\t\t\tday: day,\n\t\t\t};\n\n\t\t\tvar publics = {\n\t\t\t\tsources: sources,\n\t\t\t\tdoNavMonth: doNavMonth,\n\t\t\t\tonWeekSelect: onWeekSelect,\n\t\t\t\tonDaySelect: onDaySelect,\n\t\t\t\tgetDayClasses: getDayClasses,\n\t\t\t};\n\n\t\t\tangular.extend(scope, publics);\n\n\t\t\t// console.log('scope', scope);\n\n\t\t\tsetMonth(); // Init\n\n\t\t\tfunction setMonth(date) {\n\t\t\t\tif (!date || month.isOutside(date)) {\n\t\t\t\t\tif (date) {\n\t\t\t\t\t\tmonth.setDate(date);\n\t\t\t\t\t}\n\t\t\t\t\tonMonthChange(date);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onMonthChange(date) {\n\t\t\t\tvar calendarMonth = calendar.getMonthByDate(month.getDate());\n\t\t\t\tcalendarMonth.days.each(function(day) {\n\t\t\t\t\tvar d = day.date.getDay();\n\t\t\t\t\tday.dirty = true;\n\t\t\t\t\tday.hours = 0;\n\t\t\t\t\tday.availableHours = 0;\n\t\t\t\t\tday.recordedHours = 0;\n\t\t\t\t\tday.selected = sources.day.isCurrent(day.date);\n\t\t\t\t\tday.past = day.key < Range.today.key;\n\t\t\t\t\tday.weekend = d === 0 || d === 6;\n\t\t\t\t\tday.working = !day.weekend;\n\t\t\t\t\t// reset\n\t\t\t\t\tday.holiday = false;\n\t\t\t\t\tday.vacation = false;\n\t\t\t\t\tday.wasVacation = false;\n\t\t\t\t\tday.wasWorkable = false;\n\t\t\t\t\tday.workable = false;\n\t\t\t\t\tday.green = false;\n\t\t\t\t\tday.orange = false;\n\t\t\t\t});\n\t\t\t\tsources.calendarMonth = calendarMonth;\n\t\t\t\t// console.log('calendarPopup.onMonthChange', calendarMonth);\n\t\t\t\toptions.onMonthDidChange(date, month, calendarMonth);\n\t\t\t}\n\n\t\t\tfunction onWeekSelect(week) {\n\t\t\t\t// console.log('onWeekSelect', week);\n\t\t\t\tif (!week) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (options.onWeekDidSelect(week, month, sources.calendarMonth) === true) {\n\t\t\t\t\t// sources.week.setDate(week.date);\n\t\t\t\t\t// updateSelections();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDaySelect(day) {\n\t\t\t\t// console.log('onDaySelect', day);\n\t\t\t\tif (!day) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (options.onDayDidSelect(day, month, sources.calendarMonth) === true) {\n\t\t\t\t\tsources.day.setDate(day.date);\n\t\t\t\t\tupdateSelections();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction updateSelections() {\n\t\t\t\tvar calendarMonth = sources.calendarMonth;\n\t\t\t\tcalendarMonth.days.each(function(day) {\n\t\t\t\t\tday.selected = sources.day.isCurrent(day.date);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction doNavMonth(dir) {\n\t\t\t\t// console.log('doNavMonth', dir);\n\t\t\t\tsetMonth(month.getDate(dir));\n\t\t\t}\n\n\t\t\tfunction getDayClasses(day) {\n\t\t\t\tvar classes = {\n\t\t\t\t\t'day': day,\n\t\t\t\t};\n\t\t\t\tif (day) {\n\t\t\t\t\tangular.extend(classes, {\n\t\t\t\t\t\t'today': day.$today,\n\t\t\t\t\t\t'selected': day.selected,\n\t\t\t\t\t\t'workable': day.workable,\n\t\t\t\t\t\t'holiday': day.holiday,\n\t\t\t\t\t\t'vacation': day.vacation,\n\t\t\t\t\t\t'working': day.working,\n\t\t\t\t\t\t'available': day.available,\n\t\t\t\t\t\t'full': day.full,\n\t\t\t\t\t\t'status-green': day.green,\n\t\t\t\t\t\t'status-orange': day.orange,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn classes;\n\t\t\t}\n\n\t\t}\n\n    }]);\n\n}());\n\n/*\n\n(function () {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n\n    app.directive('calendarPopupRecords', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function ($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n        return {\n            restrict: 'A',\n            template: function (element, attributes) {\n                return '<div calendar-popup=\"options\"></div>';\n            },\n            require: 'ngModel',\n            scope: {\n                user: '=calendarUser',\n            },\n            link: CalendarPopupLink,\n        };\n\n        function CalendarPopupLink(scope, element, attributes, model, transclude) {\n            console.log('calendarPopupRecords.link');\n\n            var user = scope.user;\n\n            var state = new State();\n\n            var options = {\n                onMonthDidChange: onMonthDidChange,\n                onWeekDidSelect: onWeekDidSelect,\n                onDayDidSelect: onDayDidSelect,\n            };\n\n            var sources = {};\n\n            var publics = {\n                // user: user,\n                state: state,\n                options: options,\n                // sources: sources,\n            };\n\n            angular.extend(scope, publics);\n\n            var currentDay = new Range({ type: Range.types.DAY });\n\n            function loadResources() {\n                var deferred = $q.defer();\n                if (sources.resources) {\n                    deferred.resolve();\n                } else {\n                    Api.gantt.resources.actives().then(function success(response) {\n                        setResources(response);\n                        deferred.resolve();\n                    }, function (error) {\n                        deferred.reject();\n                    });\n                }\n                return deferred.promise;\n            }\n\n            function getFirstWorkingDate(date, month, calendar) {\n                // console.log('calendarPopupRecords.getFirstWorkingDate', date);\n                var firstWorkingDate = null;\n                function setFirstDay() {\n                    calendar.days.forward();\n                    calendar.days.each(function (day) {\n                        if (!firstWorkingDate && !month.isOutside(day.date) && day.working && !day.vacation) {\n                            // console.log('check', day.working, day.vacation, day.date);\n                            firstWorkingDate = day.date;\n                        }\n                    });\n                    // console.log('setFirstDay', firstWorkingDate);\n                }\n                if (date) {\n                    var key = CalendarFactory.getKey(date);\n                    var day = calendar.days.get(key);\n                    // console.log('getFirstWorkingDate', day.working, day.vacation, date);\n                    if (day && day.working && !day.vacation) {\n                        firstWorkingDate = date;\n                    } else {\n                        setFirstDay();\n                    }\n                } else {\n                    setFirstDay();\n                }\n                return firstWorkingDate;\n            }\n\n            function getMonthRecords(month) {\n                var deferred = $q.defer();\n                var user = scope.user;\n                var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                // console.log('calendarPopupRecords.getMonthRecords', monthExpanded.toString());\n                $q.all([\n                    loadResources(),\n                    Api.gantt.absencesAndOvertimes(monthExpanded.getParams()).then(function success(response) {\n                        sources.absencesAndOvertimes = response;\n                    }),\n                    Api.gantt.calendar(monthExpanded.getParams()).then(function success(response) {\n                        var unworkings = {};\n                        angular.forEach(response, function (item) {\n                            unworkings[item.key] = item;\n                        });\n                        sources.unworkings = unworkings;\n                        sources.calendar = response;\n                    }),\n                    Api.gantt.records(user.id, monthExpanded.getParams()).then(function (rows) {\n                        sources.monthRecords = rows.map(function (row) {\n                            row.state = new State();\n                            row.record.date = new Date(row.record.date);\n                            return row;\n                        });\n                    }),\n\n                ]).then(function (response) {\n                    // state.success();\n                    deferred.resolve();\n\n                }, function (error) {\n                    // state.error(error);\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onDayDidSelect(day, month, calendar) {\n                // var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                if (!day || currentDay.isBefore(day.date)) {\n                    return;\n                }\n                // console.log('calendarPopupRecords.onDayDidSelect', day, day.working, day.date);\n                if (day && day.working) {\n                    $timeout(function () {\n                        model.$setViewValue(day.date);\n                    });\n                    return true;\n                }\n            }\n\n            function onMonthDidChange(date, month, calendar) {\n                var deferred = $q.defer();\n                console.log('calendarPopupRecords.onMonthDidChange', month.toString());\n                getMonthRecords(month).then(function () {\n                    setAbsencesAndOvertimes();\n                    updateCalendar(date, month, calendar);\n                    deferred.resolve(getFirstWorkingDate(date, month, calendar));\n\n                }, function () {\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onWeekDidSelect(week, month, calendar) {\n                // console.log('calendarPopupRecords.onWeekDidSelect', month.toString());\n                // var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                return true;\n            }\n\n            function setAbsencesAndOvertimes() {\n                var resource = sources.resource;\n                if (!resource) {\n                    return;\n                }\n                // assegno assenze e straordinari alla risorsa\n                resource.absencesAndOvertimes = {};\n                angular.forEach(sources.absencesAndOvertimes, function (item) {\n                    if (resource.id === item.resourceId) {\n                        resource.absencesAndOvertimes[item.key] = item;\n                    }\n                });\n            }\n\n            function setResources(resources) {\n                var user = scope.user;\n                sources.resources = resources;\n                console.log('calendarPopupRecords.setResources', resources.length, user);\n                angular.forEach(resources, function (resource) {\n                    resource.absencesAndOvertimes = {};\n                    if (resource.id === user.id) {\n                        sources.resource = resource;\n                        // console.log('calendarPopupRecords.setResources.resource', resource);\n                    }\n                });\n            }\n\n            function setWorkableDay(day) {\n                var resource = sources.resource;\n                day.working = !sources.unworkings[day.key];\n                var availableHours = 0;\n                if (resource) {\n                    if (day.working) {\n                        availableHours += resource.baseHours;\n                    }\n                    var ao = resource.absencesAndOvertimes[day.key];\n                    if (ao) {\n                        availableHours += ao.hours;\n                    }\n                } else if (day.working) {\n                    availableHours += 8;\n                }\n                var has = availableHours > 0;\n                day.availableHours = availableHours;\n                day.recordedHours = 0;\n                day.holiday = !day.working && !has && !day.weekend;\n                day.vacation = day.working && !has;\n                day.wasVacation = day.vacation && day.past;\n                day.workable = day.working && !day.past && has;\n                day.wasWorkable = day.working && day.past && has;\n            }\n\n            function updateCalendar(date, month, calendar) {\n                calendar.days.each(function (day) {\n                    setWorkableDay(day);\n                });\n            }\n\n            function updateCalendar(date, month, calendar) {\n                calendar.days.each(function (day) {\n                    setWorkableDay(day);\n                });\n                var monthRecords = sources.monthRecords;\n                if (monthRecords) {\n                    angular.forEach(monthRecords, function (row) {\n                        var day = calendar.days.get(row.record.key);\n                        if (day) {\n                            day.recordedHours += row.record.hours;\n                        }\n                    });\n                    calendar.days.each(function (day) {\n                        day.green = day.working && !currentDay.isBefore(day.date) && day.recordedHours >= 8;\n                        day.orange = day.working && !currentDay.isBefore(day.date) && day.recordedHours < 8;\n                        // day.full = day.workable && day.hours >= day.availableHours;\n                        // day.available = day.workable && day.hours < day.availableHours;\n                    });\n                }\n            }\n\n        }\n    }]);\n\n    app.directive('calendarPopupWorkables', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function ($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n        return {\n            restrict: 'A',\n            template: function (element, attributes) {\n                return '<div calendar-popup=\"options\" template=\"partials/calendar/popup/workables\"></div>';\n            },\n            require: 'ngModel',\n            scope: {\n                user: '=?calendarUser',\n            },\n            link: CalendarPopupLink,\n        };\n\n        function CalendarPopupLink(scope, element, attributes, model, transclude) {\n            console.log('calendarPopupWorkables.link');\n\n            var user = scope.user;\n\n            var state = new State();\n\n            var options = {\n                onMonthDidChange: onMonthDidChange,\n                onWeekDidSelect: onWeekDidSelect,\n                onDayDidSelect: onDayDidSelect,\n            };\n\n            var sources = {};\n\n            var publics = {\n                state: state,\n                options: options,\n            };\n\n            angular.extend(scope, publics);\n\n            var currentDay = new Range({ type: Range.types.DAY });\n\n            function getFirstWorkingDate(date, month, calendar) {\n                var firstWorkingDate = null;\n                function setFirstDay() {\n                    calendar.days.forward();\n                    calendar.days.each(function (day) {\n                        if (!firstWorkingDate && !month.isOutside(day.date) && day.working && !day.vacation) {\n                            firstWorkingDate = day.date;\n                        }\n                    });\n                }\n                if (date) {\n                    var key = CalendarFactory.getKey(date);\n                    var day = calendar.days.get(key);\n                    if (day && day.working && !day.vacation) {\n                        firstWorkingDate = date;\n                    } else {\n                        setFirstDay();\n                    }\n                } else {\n                    setFirstDay();\n                }\n                return firstWorkingDate;\n            }\n\n            function loadResources(monthExpanded) {\n                var deferred = $q.defer();\n                if (sources.resources) {\n                    deferred.resolve();\n                } else {\n                    Api.gantt.resources.actives().then(function success(response) {\n                        setResources(response);\n                        deferred.resolve();\n                    }, function (error) {\n                        deferred.reject();\n                    });\n                }\n                return deferred.promise;\n            }\n\n            function loadAbsencesAndOvertimes(monthExpanded) {\n                return Api.gantt.absencesAndOvertimes(monthExpanded.getParams()).then(function success(response) {\n                    sources.absencesAndOvertimes = response;\n                });\n            }\n\n            function loadCalendar(monthExpanded) {\n                return Api.gantt.calendar(monthExpanded.getParams()).then(function success(response) {\n                    var unworkings = {};\n                    angular.forEach(response, function (item) {\n                        unworkings[item.key] = item;\n                    });\n                    sources.unworkings = unworkings;\n                    sources.calendar = response;\n                })\n            }\n\n            function getMonthRecords(month) {\n                var deferred = $q.defer();\n                var user = scope.user;\n                var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                var promises;\n                if (user) {\n                    promises = [loadResources(monthExpanded), loadAbsencesAndOvertimes(monthExpanded), loadCalendar(monthExpanded)];\n                } else {\n                    promises = [loadCalendar(monthExpanded)];\n                }\n                $q.all(promises).then(function (response) {\n                    deferred.resolve();\n\n                }, function (error) {\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onDayDidSelect(day, month, calendar) {\n                if (!day) { // || currentDay.isBefore(day.date)) {\n                    return;\n                }\n                if (day && day.working) {\n                    $timeout(function () {\n                        model.$setViewValue(day.date);\n                    });\n                    return true;\n                }\n            }\n\n            function onMonthDidChange(date, month, calendar) {\n                var deferred = $q.defer();\n                console.log('calendarPopupRecords.onMonthDidChange', month.toString());\n                getMonthRecords(month).then(function () {\n                    setAbsencesAndOvertimes();\n                    updateCalendar(date, month, calendar);\n                    deferred.resolve(getFirstWorkingDate(date, month, calendar));\n\n                }, function () {\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onWeekDidSelect(week, month, calendar) {\n                // console.log('calendarPopupRecords.onWeekDidSelect', month.toString());\n                // var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                return true;\n            }\n\n            function setAbsencesAndOvertimes() {\n                var resource = sources.resource;\n                if (!resource) {\n                    return;\n                }\n                // assegno assenze e straordinari alla risorsa\n                resource.absencesAndOvertimes = {};\n                angular.forEach(sources.absencesAndOvertimes, function (item) {\n                    if (resource.id === item.resourceId) {\n                        resource.absencesAndOvertimes[item.key] = item;\n                    }\n                });\n            }\n\n            function setResources(resources) {\n                var user = scope.user;\n                sources.resources = resources;\n                console.log('calendarPopupRecords.setResources', resources.length, user);\n                angular.forEach(resources, function (resource) {\n                    resource.absencesAndOvertimes = {};\n                    if (resource.id === user.id) {\n                        sources.resource = resource;\n                        // console.log('calendarPopupRecords.setResources.resource', resource);\n                    }\n                });\n            }\n\n            function setWorkableDay(day) {\n                var resource = sources.resource;\n                day.working = !sources.unworkings[day.key];\n                var availableHours = 0;\n                if (resource) {\n                    if (day.working) {\n                        availableHours += resource.baseHours;\n                    }\n                    var ao = resource.absencesAndOvertimes[day.key];\n                    if (ao) {\n                        availableHours += ao.hours;\n                    }\n                } else if (day.working) {\n                    availableHours += 8;\n                }\n                // console.log('setWorkableDay', day.key, 'day.working', day.working, 'availableHours', availableHours);\n                var has = availableHours > 0;\n                day.availableHours = availableHours;\n                day.recordedHours = 0;\n                day.holiday = !day.working && !has && !day.weekend;\n                day.vacation = day.working && !has;\n                day.wasVacation = day.vacation && day.past;\n                day.workable = day.working && !day.past && has;\n                day.wasWorkable = day.working && day.past && has;\n            }\n\n            function updateCalendar(date, month, calendar) {\n                calendar.days.each(function (day) {\n                    setWorkableDay(day);\n                });\n            }\n\n        }\n    }]);\n\n    app.directive('calendarPopup', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function ($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n        return {\n            restrict: 'A',\n            templateUrl: TemplateUrl,\n            scope: {\n                options: '=calendarPopup',\n            },\n            link: CalendarPopupLink,\n        }\n\n        function TemplateUrl(element, attributes) {\n            var url = attributes.template;\n            if (!url) {\n                url = 'partials/calendar/popup';\n                if (!$templateCache.get(url)) {\n                    $templateCache.put(url, '<div><json-formatter json=\"item\"></json-formatter></div>');\n                }\n            }\n            return url;\n        }\n\n        function CalendarPopupLink(scope, element, attributes, model, transclude) {\n            console.log('calendarPopup.link', scope.options);\n\n            var calendar = new CalendarFactory();\n\n            var options;\n\n            var month = new Range({ type: Range.types.MONTH });\n            var week = new Range({ type: Range.types.WEEK });\n            var day = new Range({ type: Range.types.DAY });\n\n            var sources = {\n                month: month,\n                week: week,\n                day: day,\n            };\n\n            var publics = {\n                sources: sources,\n                doNavMonth: doNavMonth,\n                onWeekSelect: onWeekSelect,\n                onDaySelect: onDaySelect,\n                getDayClasses: getDayClasses,\n            };\n\n            angular.extend(scope, publics);\n\n            // console.log('scope', scope);\n\n            scope.$watch('options', function (newValue) {\n                options = newValue;\n                options = options || {\n                    onMonthDidChange: function () {\n                        var deferred = $q.defer();\n                        deferred.resolve();\n                        return deferred.promise;\n                    },\n                    onWeekDidSelect: function () { },\n                    onDayDidSelect: function () { },\n                }\n                setMonth(); // Init\n            });\n\n            function setMonth(date) {\n                if (!date || month.isOutside(date)) {\n                    onMonthChange(date);\n                }\n            }\n\n            function onMonthChange(date) {\n                var calendarMonth = calendar.getMonthByDate(date); // month.getDate();\n                calendarMonth.days.each(function (day) {\n                    var d = day.date.getDay();\n                    day.dirty = true;\n                    day.hours = 0;\n                    day.availableHours = 0;\n                    day.recordedHours = 0;\n                    day.selected = sources.day.isCurrent(day.date);\n                    day.past = day.key < Range.today.key;\n                    day.weekend = d === 0 || d === 6;\n                    day.working = !day.weekend;\n                    // reset\n                    day.holiday = false;\n                    day.vacation = false;\n                    day.wasVacation = false;\n                    day.wasWorkable = false;\n                    day.workable = false;\n                    day.green = false;\n                    day.orange = false;\n                });\n                // console.log('calendarPopup.onMonthChange', calendarMonth);\n                options.onMonthDidChange(date, Range.currentMonth().setDate(date), calendarMonth).then(function () {\n                    date ? month.setDate(date) : null;\n                    sources.calendarMonth = calendarMonth;\n                    scope.$emit('onMonthDidChange', options);\n                });\n            }\n\n            function onWeekSelect(week) {\n                // console.log('onWeekSelect', week);\n                if (!week) {\n                    return;\n                }\n                if (options.onWeekDidSelect(week, month, sources.calendarMonth) === true) {\n                    // sources.week.setDate(week.date);\n                    // updateSelections();\n                    scope.$emit('onWeekDidSelect', options);\n                }\n            }\n\n            function onDaySelect(day) {\n                // console.log('onDaySelect', day);\n                if (!day) {\n                    return;\n                }\n                if (options.onDayDidSelect(day, month, sources.calendarMonth) === true) {\n                    sources.day.setDate(day.date);\n                    updateSelections();\n                    scope.$emit('onDayDidSelect', options);\n                }\n            }\n\n            function updateSelections() {\n                var calendarMonth = sources.calendarMonth;\n                calendarMonth.days.each(function (day) {\n                    day.selected = sources.day.isCurrent(day.date);\n                });\n            }\n\n            function doNavMonth(dir) {\n                // console.log('doNavMonth', dir);\n                setMonth(month.getDate(dir));\n            }\n\n            function getDayClasses(day) {\n                var classes = {\n                    'day': day,\n                }\n                if (day) {\n                    angular.extend(classes, {\n                        'today': day.$today,\n                        'selected': day.selected,\n                        'workable': day.workable,\n                        'holiday': day.holiday,\n                        'vacation': day.vacation,\n                        'working': day.working,\n                        'available': day.available,\n                        'full': day.full,\n                        'status-green': day.green,\n                        'status-orange': day.orange,\n                    });\n                }\n                return classes;\n            }\n\n        }\n\n    }]);\n\n}());\n\n*/\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Calendar', ['DateTime', 'Hash', function(DateTime, Hash) {\n\n\t\tvar service = this;\n\n\t\tvar days = new Hash('key');\n\t\tvar months = new Hash('mKey');\n\n\t\tvar statics = {\n\t\t\tgetDate: getDate,\n\t\t\tclearMonth: clearMonth,\n\t\t\tgetMonthByDate: getMonthByDate,\n\t\t\tgetWeekByDate: getWeekByDate,\n\t\t\tgetMonths: getMonths,\n\t\t\tgetMonth: getMonth,\n\t\t\tgetDay: getDay,\n\t\t\tgetKey: getKey,\n\t\t\tdays: days,\n\t\t\tmonths: months,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tfunction getDate(day) {\n\t\t\tif (typeof day.date.getMonth === 'function') {\n\t\t\t\treturn day.date;\n\t\t\t} else {\n\t\t\t\treturn new Date(day.date);\n\t\t\t}\n\t\t}\n\n\t\tfunction clearMonth(month) {\n\t\t\tmonth.days.each(function(day) {\n\t\t\t\tif (day) {\n\t\t\t\t\tday.hours = 0;\n\t\t\t\t\tday.tasks = new Hash('id');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction getMonthByDate(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar yyyy = date.getFullYear();\n\t\t\tvar MM = date.getMonth();\n\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\tvar mKey = yyyy * 12 + MM;\n\t\t\tvar month = months.get(mKey);\n\t\t\tif (!month) {\n\t\t\t\tvar fromDay = new Date(yyyy, MM, 1).getDay() - 1;\n\t\t\t\tfromDay = fromDay < 0 ? 6 : fromDay;\n\t\t\t\tvar monthDays = new Date(yyyy, MM + 1, 0).getDate();\n\t\t\t\tvar weeks = 6; // Math.ceil((fromDay + monthDays) / 7);\n\t\t\t\t// console.log('month', MM, 'weeks', weeks);\n\t\t\t\tmonth = {\n\t\t\t\t\tdate: date,\n\t\t\t\t\tmKey: mKey,\n\t\t\t\t\tmonth: MM,\n\t\t\t\t\tmonthDays: monthDays,\n\t\t\t\t\tfromDay: fromDay,\n\t\t\t\t\tdays: new Hash('key'),\n\t\t\t\t};\n\t\t\t\tmonth.weeks = new Array(weeks).fill().map(function(o, r) {\n\t\t\t\t\tvar days = new Hash('key');\n\t\t\t\t\tnew Array(7).fill().map(function(o, c) {\n\t\t\t\t\t\tvar item = null;\n\t\t\t\t\t\tvar d = r * 7 + c - fromDay;\n\t\t\t\t\t\tif (d >= 0 && d < monthDays) {\n\t\t\t\t\t\t\tvar date = new Date(yyyy, MM, d + 1);\n\t\t\t\t\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\t\t\t\t\titem = {\n\t\t\t\t\t\t\t\t$today: key === DateTime.today.key,\n\t\t\t\t\t\t\t\tc: c,\n\t\t\t\t\t\t\t\tr: r,\n\t\t\t\t\t\t\t\td: d + 1,\n\t\t\t\t\t\t\t\tdate: date,\n\t\t\t\t\t\t\t\tkey: key,\n\t\t\t\t\t\t\t\thours: 0,\n\t\t\t\t\t\t\t\ttasks: new Hash('id'),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tservice.days.add(item);\n\t\t\t\t\t\t\titem = month.days.add(item);\n\t\t\t\t\t\t\tdays.add(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t});\n\t\t\t\t\treturn {\n\t\t\t\t\t\tr: r,\n\t\t\t\t\t\tdate: new Date(yyyy, MM, r * 7 - fromDay + 1),\n\t\t\t\t\t\tdays: days,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tmonth.getMonth = function(diff) {\n\t\t\t\t\tdiff = diff || 0;\n\t\t\t\t\treturn new Date(yyyy, MM + diff, 1);\n\t\t\t\t};\n\t\t\t\tmonth = months.add(month);\n\t\t\t}\n\t\t\treturn month;\n\t\t}\n\n\t\tfunction getWeekByDate(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\tvar month = service.getMonthByDate(date);\n\t\t\tvar week = month.weeks.find(function(week) {\n\t\t\t\treturn week.days.find(function(day) {\n\t\t\t\t\treturn day.key === key;\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn week;\n\t\t}\n\n\t\tfunction getMonths(num) {\n\t\t\tdays.removeAll();\n\t\t\tmonths.removeAll();\n\t\t\tvar i = 0;\n\t\t\twhile (i < num) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setFullYear(DateTime.today.date.getFullYear());\n\t\t\t\tdate.setMonth(DateTime.today.date.getMonth() + i);\n\t\t\t\tdate.setDate(1);\n\t\t\t\tdate.setHours(0);\n\t\t\t\tdate.setMinutes(0);\n\t\t\t\tdate.setSeconds(0);\n\t\t\t\tvar month = getMonthByDate(date);\n\t\t\t\t// console.log('getMonths', month);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\t// console.log('getMonths', months);\n\t\t\treturn months;\n\t\t}\n\n\t\tfunction getMonth(day) {\n\t\t\tvar date = getDate(day);\n\t\t\tvar month = getMonthByDate(date);\n\t\t\treturn month;\n\t\t}\n\n\t\tfunction getDay(days) {\n\t\t\tvar date = new Date(DateTime.today.date);\n\t\t\tdate.setDate(date.getDate() + days);\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction getKey(date) {\n\t\t\treturn Math.ceil(date.getTime() / DateTime.DAY);\n\t\t}\n\n    }]);\n\n\tapp.factory('CalendarFactory', ['$filter', 'DateTime', 'Hash', function($filter, DateTime, Hash) {\n\n\t\tfunction Calendar() {\n\t\t\tthis.days = new Hash('key');\n\t\t\tthis.weeks = new Hash('wKey');\n\t\t\tthis.months = new Hash('mKey');\n\t\t}\n\n\t\tvar statics = {\n\t\t\tclearMonth: clearMonth,\n\t\t\tgetDate: getDate,\n\t\t\tgetDay: getDay,\n\t\t\tgetKey: getKey,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tgetWeeks: getWeeks,\n\t\t\tgetWeek: getWeek,\n\t\t\tgetWeekByDate: getWeekByDate,\n\t\t\tgetMonths: getMonths,\n\t\t\tgetMonth: getMonth,\n\t\t\tgetMonthByDate: getMonthByDate,\n\t\t};\n\n\t\tangular.extend(Calendar, statics);\n\t\tangular.extend(Calendar.prototype, publics);\n\n\t\treturn Calendar;\n\n\t\t// statics\n\n\t\tfunction clearMonth(month) {\n\t\t\tmonth.days.each(function(day) {\n\t\t\t\tif (day) {\n\t\t\t\t\tday.hours = 0;\n\t\t\t\t\tday.tasks = new Hash('id');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction getDate(day) {\n\t\t\tif (typeof day.date.getMonth === 'function') {\n\t\t\t\treturn day.date;\n\t\t\t} else {\n\t\t\t\treturn new Date(day.date);\n\t\t\t}\n\t\t}\n\n\t\tfunction getDay(days) {\n\t\t\tvar date = new Date(DateTime.today.date);\n\t\t\tdate.setDate(date.getDate() + days);\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction getKey(date) {\n\t\t\treturn Math.ceil(date.getTime() / DateTime.DAY);\n\t\t}\n\n\t\t// publics\n\n\t\tfunction getWeeks(num) {\n\t\t\tvar calendar = this;\n\t\t\tcalendar.days.removeAll();\n\t\t\tcalendar.weeks.removeAll();\n\t\t\tcalendar.months.removeAll();\n\t\t\tvar i = 0;\n\t\t\twhile (i < num) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setFullYear(DateTime.today.date.getFullYear());\n\t\t\t\tdate.setMonth(DateTime.today.date.getMonth() + i);\n\t\t\t\tdate.setDate(1);\n\t\t\t\tdate.setHours(0);\n\t\t\t\tdate.setMinutes(0);\n\t\t\t\tdate.setSeconds(0);\n\t\t\t\tvar week = calendar.getWeekByDate(date);\n\t\t\t\t// console.log('getWeeks', week);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\t// console.log('getWeeks', calendar.weeks);\n\t\t\treturn calendar.weeks;\n\t\t}\n\n\t\tfunction getWeek(day) {\n\t\t\tvar calendar = this;\n\t\t\tvar date = getDate(day);\n\t\t\tvar week = calendar.getWeekByDate(date);\n\t\t\treturn week;\n\t\t}\n\n\t\tfunction getWeekByDate(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar calendar = this;\n\t\t\tvar yyyy = date.getFullYear();\n\t\t\tvar MM = date.getMonth();\n\t\t\tvar day = date.getDay();\n\t\t\tvar diff = date.getDate() - day + (day === 0 ? -6 : 1);\n\t\t\tvar weekDate = new Date(date.setDate(diff));\n\t\t\tvar isoWeek = $filter('isoWeek')(date, 1);\n\t\t\tvar dKey = Math.ceil(weekDate.getTime() / DateTime.DAY);\n\t\t\tvar wKey = yyyy * 60 + isoWeek;\n\t\t\tvar mKey = yyyy * 12 + MM;\n\t\t\tvar week = calendar.weeks.get(wKey);\n\t\t\tif (!week) {\n\t\t\t\tvar days = new Hash('key');\n\t\t\t\tnew Array(7).fill().map(function(o, i) {\n\t\t\t\t\tvar dayDate = new Date(weekDate);\n\t\t\t\t\tdayDate.setDate(weekDate.getDate() + i);\n\t\t\t\t\tvar key = Math.ceil(dayDate.getTime() / DateTime.DAY);\n\t\t\t\t\tvar item = {\n\t\t\t\t\t\t$today: key === DateTime.today.key,\n\t\t\t\t\t\tc: i,\n\t\t\t\t\t\td: dayDate.getDate(),\n\t\t\t\t\t\tdate: dayDate,\n\t\t\t\t\t\tkey: key,\n\t\t\t\t\t};\n\t\t\t\t\tcalendar.days.add(item);\n\t\t\t\t\tdays.add(item);\n\t\t\t\t\treturn item;\n\t\t\t\t});\n\t\t\t\tweek = {\n\t\t\t\t\tisoWeek: isoWeek,\n\t\t\t\t\tkey: dKey,\n\t\t\t\t\twKey: wKey,\n\t\t\t\t\tmKey: mKey,\n\t\t\t\t\tdate: weekDate,\n\t\t\t\t\tdays: days,\n\t\t\t\t};\n\t\t\t\tweek = calendar.weeks.add(week);\n\t\t\t}\n\t\t\treturn week;\n\t\t}\n\n\t\tfunction getMonths(num) {\n\t\t\tvar calendar = this;\n\t\t\tcalendar.days.removeAll();\n\t\t\tcalendar.months.removeAll();\n\t\t\tvar i = 0;\n\t\t\twhile (i < num) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setFullYear(DateTime.today.date.getFullYear());\n\t\t\t\tdate.setMonth(DateTime.today.date.getMonth() + i);\n\t\t\t\tdate.setDate(1);\n\t\t\t\tdate.setHours(0);\n\t\t\t\tdate.setMinutes(0);\n\t\t\t\tdate.setSeconds(0);\n\t\t\t\tvar month = calendar.getMonthByDate(date);\n\t\t\t\t// console.log('getMonths', month);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\t// console.log('getMonths', months);\n\t\t\treturn calendar.months;\n\t\t}\n\n\t\tfunction getMonth(day) {\n\t\t\tvar calendar = this;\n\t\t\tvar date = getDate(day);\n\t\t\tvar month = calendar.getMonthByDate(date);\n\t\t\treturn month;\n\t\t}\n\n\t\tfunction getMonthByDate(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar calendar = this;\n\t\t\tvar yyyy = date.getFullYear();\n\t\t\tvar MM = date.getMonth();\n\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\tvar mKey = yyyy * 12 + MM;\n\t\t\tvar month = calendar.months.get(mKey);\n\t\t\tif (!month) {\n\t\t\t\tvar fromDay = new Date(yyyy, MM, 1).getDay() - 1;\n\t\t\t\tfromDay = fromDay < 0 ? 6 : fromDay;\n\t\t\t\tvar monthDays = new Date(yyyy, MM + 1, 0).getDate();\n\t\t\t\tvar weeks = 6; // Math.ceil((fromDay + monthDays) / 7);\n\t\t\t\t// console.log('month', MM, 'weeks', weeks);\n\t\t\t\tmonth = {\n\t\t\t\t\tdate: date,\n\t\t\t\t\tmKey: mKey,\n\t\t\t\t\tmonth: MM,\n\t\t\t\t\tmonthDays: monthDays,\n\t\t\t\t\tfromDay: fromDay,\n\t\t\t\t\tdays: new Hash('key'),\n\t\t\t\t};\n\t\t\t\tmonth.weeks = new Array(weeks).fill().map(function(o, r) {\n\t\t\t\t\tvar days = new Hash('key');\n\t\t\t\t\tnew Array(7).fill().map(function(o, c) {\n\t\t\t\t\t\tvar item = null;\n\t\t\t\t\t\tvar d = r * 7 + c - fromDay;\n\t\t\t\t\t\tif (d >= 0 && d < monthDays) {\n\t\t\t\t\t\t\tvar date = new Date(yyyy, MM, d + 1);\n\t\t\t\t\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\t\t\t\t\titem = {\n\t\t\t\t\t\t\t\t$today: key === DateTime.today.key,\n\t\t\t\t\t\t\t\tc: c,\n\t\t\t\t\t\t\t\tr: r,\n\t\t\t\t\t\t\t\td: d + 1,\n\t\t\t\t\t\t\t\tdate: date,\n\t\t\t\t\t\t\t\tkey: key,\n\t\t\t\t\t\t\t\thours: 0,\n\t\t\t\t\t\t\t\ttasks: new Hash('id'),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tcalendar.days.add(item);\n\t\t\t\t\t\t\titem = month.days.add(item);\n\t\t\t\t\t\t\tdays.add(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t});\n\t\t\t\t\tvar date = new Date(yyyy, MM, r * 7 - fromDay + 1);\n\t\t\t\t\tvar week = $filter('isoWeek')(date, 1);\n\t\t\t\t\tvar wKey = yyyy * 60 + week;\n\t\t\t\t\treturn {\n\t\t\t\t\t\tr: r,\n\t\t\t\t\t\twKey: wKey,\n\t\t\t\t\t\tdate: date,\n\t\t\t\t\t\tdays: days,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tmonth.getMonth = function(diff) {\n\t\t\t\t\tdiff = diff || 0;\n\t\t\t\t\treturn new Date(yyyy, MM + diff, 1);\n\t\t\t\t};\n\t\t\t\tmonth = calendar.months.add(month);\n\t\t\t}\n\t\t\treturn month;\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('DateTime', [function() {\n\n\t\tvar service = this;\n\n\t\tvar SECOND = 1000;\n\t\tvar MINUTE = 60 * SECOND;\n\t\tvar QUARTER = 15 * MINUTE;\n\t\tvar HOUR = 60 * MINUTE;\n\t\tvar DAY = 24 * HOUR;\n\t\tvar WEEK = 7 * DAY;\n\t\tvar FIRSTDAYOFWEEK = 1;\n\n\t\tvar today = getFullDate();\n\n\t\tvar statics = {\n\t\t\tgetIndexLeft: getIndexLeft,\n\t\t\tgetIndexRight: getIndexRight,\n\t\t\t//\n\t\t\tgetDayLeft: getDayLeft,\n\t\t\tgetDayRight: getDayRight,\n\t\t\t//\n\t\t\tgetMonthLeft: getMonthLeft,\n\t\t\tgetMonthRight: getMonthRight,\n\t\t\t//\n\t\t\tgetWeekLeft: getWeekLeft,\n\t\t\tgetWeekRight: getWeekRight,\n\t\t\t//\n\t\t\tgetYearLeft: getYearLeft,\n\t\t\tgetYearRight: getYearRight,\n\t\t\t//\n\t\t\tdateToKey: dateToKey,\n\t\t\t//\n\t\t\tdayDiff: dayDiff,\n\t\t\tdayLeft: dayLeft,\n\t\t\tdayRight: dayRight,\n\t\t\t//\n\t\t\tgetDate: getDate,\n\t\t\tgetFullDate: getFullDate,\n\t\t\tgetDay: getDay,\n\t\t\tgetFullDay: getFullDay,\n\t\t\tgetWeek: getWeek,\n\t\t\tgetDayByKey: getDayByKey,\n\t\t\tgetDayByDate: getDayByDate,\n\t\t\thourToTime: hourToTime,\n\t\t\tkeyToDate: keyToDate,\n\t\t\t//\n\t\t\tmonthDiff: monthDiff,\n\t\t\tmonthLeft: monthLeft,\n\t\t\tmonthRight: monthRight,\n\t\t\t//\n\t\t\ttoday: today,\n\t\t\t//\n\t\t\tweekDiff: weekDiff,\n\t\t\tweekLeft: weekLeft,\n\t\t\tweekRight: weekRight,\n\t\t\t//\n\t\t\tyearDiff: yearDiff,\n\t\t\tyearLeft: yearLeft,\n\t\t\tyearRight: yearRight,\n\t\t\t// conversion\n\t\t\ttimeToHour: timeToHour,\n\t\t\ttimeToQuarterHour: timeToQuarterHour,\n\t\t\t// units\n\t\t\tSECOND: SECOND,\n\t\t\tMINUTE: MINUTE,\n\t\t\tQUARTER: QUARTER,\n\t\t\tHOUR: HOUR,\n\t\t\tDAY: DAY,\n\t\t\tWEEK: WEEK,\n\t\t\tFIRSTDAYOFWEEK: FIRSTDAYOFWEEK,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tfunction datetime(date) {\n\t\t\tdate = date ? new Date(date) : new Date();\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction components(date) {\n\t\t\tdate = datetime(date);\n\t\t\t// console.log($locale.DATETIME_FORMATS.FIRSTDAYOFWEEK);\n\t\t\treturn {\n\t\t\t\tdate: date,\n\t\t\t\tyyyy: date.getFullYear(),\n\t\t\t\tMM: date.getMonth(),\n\t\t\t\tdd: date.getDate(),\n\t\t\t\t// ee: (date.getDay() + $locale.DATETIME_FORMATS.FIRSTDAYOFWEEK) % 7,\n\t\t\t\tee: date.getDay(),\n\t\t\t\tHH: date.getHours(),\n\t\t\t\tmm: date.getMinutes(),\n\t\t\t\tss: date.getSeconds(),\n\t\t\t\tsss: date.getMilliseconds(),\n\t\t\t};\n\t\t}\n\n\t\tfunction dateToKey(date) {\n\t\t\tdate = dayLeft(datetime(date));\n\t\t\tvar offset = date.getTimezoneOffset();\n\t\t\treturn Math.floor((date.valueOf() - offset * MINUTE) / DAY);\n\t\t}\n\n\t\tfunction dayDiff(diff, date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd + diff, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction dayLeft(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction dayRight(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction getDate(date) {\n\t\t\tdate = dayLeft(date);\n\t\t\treturn getDayByDate(date);\n\t\t}\n\n\t\tfunction getFullDate(date) {\n\t\t\treturn getFullDay(getDate(date));\n\t\t}\n\n\t\tfunction getDay(date, key) {\n\t\t\treturn {\n\t\t\t\tdate: date,\n\t\t\t\tkey: key,\n\t\t\t};\n\t\t}\n\n\t\tfunction getDayByKey(key) {\n\t\t\treturn getDay(keyToDate(key), key);\n\t\t}\n\n\t\tfunction getDayByDate(date) {\n\t\t\treturn getDay(date, dateToKey(date));\n\t\t}\n\n\t\tfunction getFullDay(day) {\n\t\t\tvar c = components(day.date);\n\t\t\tc.key = day.key;\n\t\t\tc.wKey = dateToKey(weekLeft(day.date));\n\t\t\tc.mKey = dateToKey(monthLeft(day.date));\n\t\t\tc.ww = getWeek(day.date, FIRSTDAYOFWEEK);\n\t\t\treturn c;\n\t\t}\n\n\t\tfunction hourToTime(hour) {\n\t\t\treturn hour * HOUR;\n\t\t}\n\n\t\tfunction keyToDate(key) {\n\t\t\tvar date = new Date();\n\t\t\tvar offset = date.getTimezoneOffset();\n\t\t\treturn new Date(date.setTime(key * DAY + offset * MINUTE));\n\t\t}\n\n\t\tfunction monthDiff(diff, date, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step + diff * step;\n\t\t\treturn new Date(c.yyyy, MM, 1, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction monthLeft(date, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\treturn new Date(c.yyyy, MM, 1, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction monthRight(date, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\treturn new Date(c.yyyy, MM + step, 0, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction timeToHour(time) {\n\t\t\treturn time / HOUR;\n\t\t}\n\n\t\tfunction timeToQuarterHour(time) {\n\t\t\treturn Math.floor(time / QUARTER) * QUARTER / HOUR;\n\t\t}\n\n\t\tfunction weekDiff(diff, date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd + diff * 7, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction weekLeft(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd - c.ee + FIRSTDAYOFWEEK, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction weekRight(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd - c.ee + FIRSTDAYOFWEEK + 6, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction yearDiff(diff, date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM + diff * 12, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction yearLeft(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, 0, 1, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction yearRight(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, 12, 0, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction getIndexLeft(diff, size, step) {\n\t\t\tdiff = diff || 0;\n\t\t\tsize = size || 1;\n\t\t\tstep = step || 1;\n\t\t\tvar index = diff * step;\n\t\t\treturn index;\n\t\t}\n\n\t\tfunction getIndexRight(diff, size, step) {\n\t\t\tsize = size || 1;\n\t\t\tstep = step || 1;\n\t\t\tvar index = getIndexLeft(diff, size, step);\n\t\t\tindex += (size * step) - 1;\n\t\t\treturn index;\n\t\t}\n\n\t\tfunction getYearLeft(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar yyyy = Math.floor(c.yyyy / step) * step;\n\t\t\tyyyy += getIndexLeft(diff, size, step);\n\t\t\tdate = new Date(yyyy, c.MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn yearLeft(date);\n\t\t}\n\n\t\tfunction getYearRight(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar yyyy = Math.floor(c.yyyy / step) * step;\n\t\t\tyyyy += getIndexRight(diff, size, step);\n\t\t\tdate = new Date(yyyy, c.MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn yearRight(date);\n\t\t}\n\n\t\tfunction getMonthLeft(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\tMM += getIndexLeft(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn monthLeft(date);\n\t\t}\n\n\t\tfunction getMonthRight(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\tMM += getIndexRight(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn monthRight(date);\n\t\t}\n\n\t\tfunction getWeekLeft(date, diff, size, step) {\n\t\t\tvar c = components(date);\n\t\t\tvar dd = c.dd + getIndexLeft(diff, size, step) * 7;\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn weekLeft(date);\n\t\t}\n\n\t\tfunction getWeekRight(date, diff, size, step) {\n\t\t\tvar c = components(date);\n\t\t\tvar dd = c.dd + getIndexRight(diff, size, step) * 7;\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn weekRight(date);\n\t\t}\n\n\t\tfunction getDayLeft(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar dd = Math.floor(c.dd / step) * step;\n\t\t\tdd += getIndexLeft(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn dayLeft(date);\n\t\t}\n\n\t\tfunction getDayRight(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar dd = Math.floor(c.dd / step) * step;\n\t\t\tdd += getIndexRight(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn dayRight(date);\n\t\t}\n\n\t\tfunction getWeekDay(date, offsetDays) {\n\t\t\toffsetDays = offsetDays || 0; // default offsetDays to zero\n\t\t\tvar ee = date.getDay();\n\t\t\tee -= offsetDays;\n\t\t\tif (ee < 0) {\n\t\t\t\tee += 7;\n\t\t\t}\n\t\t\treturn ee;\n\t\t}\n\n\t\tfunction getWeek(date, offsetDays) {\n\t\t\tvar startingDayOfWeek = 4; // first week of year with thursday;\n\t\t\tvar now = getDayByDate(date);\n\t\t\tvar first = getDayByDate(getYearLeft(date)); // diff, size, step\n\t\t\tvar ee = getWeekDay(first.date, offsetDays);\n\t\t\tvar num = now.key - first.key;\n\t\t\tvar week = Math.floor((num + ee) / 7);\n\t\t\tif (ee < startingDayOfWeek) {\n\t\t\t\tweek++;\n\t\t\t\tif (week > 52) {\n\t\t\t\t\t// next year\n\t\t\t\t\tee = getWeekDay(getYearLeft(date, 1), offsetDays);\n\t\t\t\t\t// if the next year starts before the middle of the week, it is week #1 of that year\n\t\t\t\t\tweek = ee < startingDayOfWeek ? 1 : 53;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn week;\n\t\t}\n\n    }]);\n\n\tapp.filter('isoWeek', ['DateTime', function(DateTime) {\n\t\treturn function(value, offsetDays) {\n\t\t\tif (value) {\n\t\t\t\tvar week = DateTime.getWeek(value, offsetDays);\n\t\t\t\treturn week < 10 ? '0' + week : week; // padded\n\t\t\t} else {\n\t\t\t\treturn '-';\n\t\t\t}\n\t\t};\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tvar it_IT = {\n\t\tlong: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: 'Anno {from|date:yyyy}',\n\t\t\tSEMESTER: 'Semestre {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: 'Quadrimestre {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: 'Trimestre {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM yyyy}',\n\t\t\tWEEK: 'Settimana {to|isoWeek:1}',\n\t\t\tDAY: '{from|date:EEEE dd MMM yyyy}',\n\t\t},\n\t\tshort: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: '{from|date:yyyy}',\n\t\t\tSEMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM}',\n\t\t\tWEEK: 'W{to|isoWeek:1}',\n\t\t\tDAY: '{from|date:EEEE}',\n\t\t},\n\t\tweek: 1,\n\t};\n\n\tvar en_US = {\n\t\tlong: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: 'Year {from|date:yyyy}',\n\t\t\tSEMESTER: 'Semester {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: 'Trimester {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: 'Quarter {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM yyyy}',\n\t\t\tWEEK: 'Week {from|isoWeek:0}',\n\t\t\tDAY: '{from|date:EEEE MM/dd/yyyy}',\n\t\t},\n\t\tshort: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: '{from|date:yyyy}',\n\t\t\tSEMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM}',\n\t\t\tWEEK: 'W{from|isoWeek:0}',\n\t\t\tDAY: '{from|date:EEEE}',\n\t\t},\n\t\tweek: 0,\n\t};\n\n\tvar formats = it_IT;\n\n\tapp.constant('RangeTypes', {\n\t\tRANGE: 10,\n\t\tYEAR: 11,\n\t\tSEMESTER: 12,\n\t\tTRIMESTER: 13,\n\t\tQUARTER: 14,\n\t\tMONTH: 15,\n\t\tWEEK: 16,\n\t\tDAY: 17,\n\t});\n\n\tapp.factory('Range', ['$filter', 'DateTime', 'RangeTypes', function($filter, DateTime, RangeTypes) {\n\n\t\tfunction Range(options) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.dayLeft();\n\t\t\trange.type = RangeTypes.QUARTER;\n\t\t\tif (options) {\n\t\t\t\tangular.extend(range, options);\n\t\t\t}\n\t\t\trange.setDiff();\n\t\t}\n\n\t\tvar publics = {\n\t\t\tsetYear: setYear,\n\t\t\tsetSemester: setSemester,\n\t\t\tsetTrimester: setTrimester,\n\t\t\tsetQuarter: setQuarter,\n\t\t\tsetMonth: setMonth,\n\t\t\tsetWeek: setWeek,\n\t\t\tsetDay: setDay,\n\t\t\tsetKey: setKey,\n\n\t\t\tprev: prev,\n\t\t\tnext: next,\n\n\t\t\tgetDiff: getDiff,\n\t\t\tgetParams: getParams,\n\t\t\tgetDate: getDate,\n\t\t\tsetDate: setDate,\n\t\t\tsetDiff: setDiff,\n\n\t\t\tset: set,\n\t\t\tis: is,\n\t\t\tisInside: isInside,\n\t\t\tisOutside: isOutside,\n\t\t\tisCurrent: isCurrent,\n\t\t\tisBefore: isBefore,\n\t\t\tisAfter: isAfter,\n\t\t\tequals: equals,\n\n\t\t\teachDay: eachDay,\n\t\t\ttotalDays: totalDays,\n\n\t\t\tgetName: getName,\n\t\t\tgetShortName: getShortName,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tvar statics = {\n\t\t\t//\n\t\t\tcopy: RangeCopy,\n\t\t\texpand: RangeExpand,\n\t\t\tgetMonth: RangeGetMonth,\n\t\t\taddYear: RangeAddYear,\n\t\t\ttypes: RangeTypes,\n\t\t\t//\n\t\t\tYear: RangeYear,\n\t\t\tSemester: RangeSemester,\n\t\t\tTrimester: RangeTrimester,\n\t\t\tQuarter: RangeQuarter,\n\t\t\tMonth: RangeMonth,\n\t\t\tWeek: RangeWeek,\n\t\t\tDay: RangeDay,\n\t\t\t//\n\t\t\tgetDate: DateTime.getDate,\n\t\t\tgetFullDate: DateTime.getFullDate,\n\t\t\tdateToKey: DateTime.dateToKey,\n\t\t\tkeyToDate: DateTime.keyToDate,\n\t\t\tgetDay: DateTime.getDay,\n\t\t\tgetFullDay: DateTime.getFullDay,\n\t\t\tgetDayByKey: DateTime.getDayByKey,\n\t\t\tgetDayByDate: DateTime.getDayByDate,\n\t\t\ttoday: DateTime.today,\n\t\t\tDateTime: DateTime,\n\t\t};\n\n\t\tangular.extend(Range.prototype, publics);\n\t\tangular.extend(Range, statics);\n\n\t\treturn Range;\n\n\t\t// public methods\n\t\tfunction isInside(date) {\n\t\t\tvar range = this;\n\t\t\treturn !range.isOutside(date);\n\t\t}\n\n\t\tfunction isOutside(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\tvar outside = date < range.from || date > range.to;\n\t\t\t// console.log('isOutside', date, range.from, range.to);\n\t\t\treturn outside;\n\t\t}\n\n\t\tfunction isCurrent(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\treturn !range.isOutside(date);\n\t\t}\n\n\t\tfunction isBefore(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\tvar before = range.to < date;\n\t\t\t// console.log('isBefore', before, range.to, date);\n\t\t\treturn before;\n\t\t}\n\n\t\tfunction isAfter(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\tvar after = range.from > date;\n\t\t\t// console.log('isAfter', after);\n\t\t\treturn after;\n\t\t}\n\n\t\tfunction setDate(date, diff) {\n\t\t\tvar range = this;\n\t\t\tswitch (range.type) {\n\t\t\t\tcase RangeTypes.YEAR:\n\t\t\t\t\trange.setYear(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.SEMESTER:\n\t\t\t\t\trange.setSemester(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.TRIMESTER:\n\t\t\t\t\trange.setTrimester(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.QUARTER:\n\t\t\t\t\trange.setQuarter(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.MONTH:\n\t\t\t\t\trange.setMonth(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.WEEK:\n\t\t\t\t\trange.setWeek(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.DAY:\n\t\t\t\t\trange.setDay(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction getDate(diff) {\n\t\t\tdiff = diff || 0;\n\t\t\tvar range = this;\n\t\t\tvar date = new Date(range.from);\n\t\t\tswitch (range.type) {\n\t\t\t\tcase RangeTypes.YEAR:\n\t\t\t\t\tdate = new Date(date.setFullYear(date.getFullYear() + diff));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.SEMESTER:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff * 6));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.TRIMESTER:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff * 4));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.QUARTER:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff * 3));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.MONTH:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.WEEK:\n\t\t\t\t\tdate = new Date(date.setDate(date.getDate() + diff * 7));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.DAY:\n\t\t\t\t\tdate = new Date(date.setDate(date.getDate() + diff));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction getDiff(diff) {\n\t\t\tvar range = this;\n\t\t\treturn new Range({\n\t\t\t\ttype: range.type,\n\t\t\t}).setDate(range.from).setDiff(diff);\n\t\t}\n\n\t\tfunction getParams() {\n\t\t\treturn {\n\t\t\t\tdateFrom: new Date(this.from),\n\t\t\t\tdateTo: new Date(this.to),\n\t\t\t};\n\t\t}\n\n\t\tfunction setYear(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getYearLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getYearRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction setSemester(date, diff, size) {\n\t\t\treturn this.setMonth(date, diff, size, 6);\n\t\t}\n\n\t\tfunction setTrimester(date, diff, size) {\n\t\t\treturn this.setMonth(date, diff, size, 4);\n\t\t}\n\n\t\tfunction setQuarter(date, diff, size) {\n\t\t\treturn this.setMonth(date, diff, size, 3);\n\t\t}\n\n\t\tfunction setMonth(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getMonthLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getMonthRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction setWeek(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getWeekLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getWeekRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction setDay(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getDayLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getDayRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction setKey(key, diff, size, step) {\n\t\t\treturn this.setDay(DateTime.keyToDate(key), diff, size, step);\n\t\t}\n\n\t\tfunction prev() {\n\t\t\treturn this.setDiff(-1);\n\t\t}\n\n\t\tfunction next() {\n\t\t\treturn this.setDiff(1);\n\t\t}\n\n\t\tfunction setDiff(diff) {\n\t\t\tvar range = this;\n\t\t\tswitch (range.type) {\n\t\t\t\tcase RangeTypes.YEAR:\n\t\t\t\t\trange.setYear(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.SEMESTER:\n\t\t\t\t\trange.setSemester(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.TRIMESTER:\n\t\t\t\t\trange.setTrimester(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.QUARTER:\n\t\t\t\t\trange.setQuarter(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.MONTH:\n\t\t\t\t\trange.setMonth(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.WEEK:\n\t\t\t\t\trange.setWeek(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.DAY:\n\t\t\t\t\trange.setDay(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction set(filters, source) {\n\t\t\tvar range = this;\n\t\t\tfilters.dateFrom = range.from;\n\t\t\tfilters.dateTo = range.to;\n\t\t\tif (source) {\n\t\t\t\tsource.setDates(filters.dateFrom, filters.dateTo);\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction is(filters) {\n\t\t\tvar range = this,\n\t\t\t\tflag = false;\n\t\t\tif (filters.dateFrom && filters.dateTo) {\n\t\t\t\tflag = filters.dateFrom.getTime() == range.from.getTime() && filters.dateTo.getTime() == range.to.getTime();\n\t\t\t}\n\t\t\treturn flag;\n\t\t}\n\n\t\tfunction equals(r) {\n\t\t\tvar range = this;\n\t\t\treturn r && DateTime.dateToKey(r.from) === DateTime.dateToKey(range.from) && DateTime.dateToKey(r.to) === DateTime.dateToKey(range.to);\n\t\t}\n\n\t\tfunction eachDay(callback) {\n\t\t\tvar range = this;\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn range;\n\t\t\t}\n\t\t\tvar fromKey = DateTime.dateToKey(range.from);\n\t\t\tvar toKey = DateTime.dateToKey(range.to);\n\t\t\twhile (fromKey <= toKey) {\n\t\t\t\tcallback(DateTime.getDayByKey(fromKey, formats.week));\n\t\t\t\tfromKey++;\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction totalDays() {\n\t\t\tvar range = this;\n\t\t\tvar fromKey = DateTime.dateToKey(range.from);\n\t\t\tvar toKey = DateTime.dateToKey(range.to);\n\t\t\treturn toKey - fromKey + 1;\n\t\t}\n\n\t\tfunction getName() {\n\t\t\tvar range = this;\n\t\t\tvar key = RangeExtract(RangeTypes, range.type);\n\t\t\treturn RangeFormat(range, formats.long[key]);\n\t\t}\n\n\t\tfunction getShortName() {\n\t\t\tvar range = this;\n\t\t\tvar key = RangeExtract(RangeTypes, range.type);\n\t\t\treturn RangeFormat(range, formats.short[key]);\n\t\t}\n\n\t\tfunction toString() {\n\t\t\tvar range = this;\n\t\t\treturn '[' +\n\t\t\t\t$filter('date')(range.from, 'MMM dd yyyy HH:mm:ss.sss') + ', ' +\n\t\t\t\t$filter('date')(range.to, 'MMM dd yyyy HH:mm:ss.sss') +\n\t\t\t\t'] \\'' + range.getName() + '\\'';\n\t\t}\n\n\t\t// static methods\n\t\tfunction RangeCopy($range) {\n\t\t\tvar range = new Range($range);\n\t\t\trange.from = new Date($range.from);\n\t\t\trange.to = new Date($range.to);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction RangeExpand(range, time) {\n\t\t\trange = RangeCopy(range);\n\t\t\trange.from = new Date(range.from.getTime() - time);\n\t\t\trange.to = new Date(range.to.getTime() + time);\n\t\t\t// console.log('RangeExpand', range.toString());\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction RangeGetMonth(date) {\n\t\t\tif (!date) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tdate = new Date(date);\n\t\t\tdate.setDate(1);\n\t\t\tdate.setHours(0, 0, 0, 0);\n\t\t\treturn date.getTime();\n\t\t}\n\n\t\tfunction RangeAddYear(date, years) {\n\t\t\tif (!date) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tdate = new Date(date);\n\t\t\treturn new Date(date.setFullYear(date.getFullYear() + years));\n\t\t}\n\n\t\tfunction RangeYear() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.YEAR\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeSemester() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.SEMESTER\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeTrimester() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.TRIMESTER\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeQuarter() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.QUARTER\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeMonth() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.MONTH\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeWeek() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.WEEK\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeDay() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.DAY\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeFormat(range, format) {\n\t\t\tvar name = format;\n\t\t\tname = name.replace(/{(.*?)}/g, function(replaced, token) {\n\t\t\t\tvar a = token.split('|');\n\t\t\t\tvar p = a.shift();\n\t\t\t\tvar f = a.join(''),\n\t\t\t\t\tj;\n\t\t\t\tif (f.indexOf(':') !== -1) {\n\t\t\t\t\tf = f.split(':');\n\t\t\t\t\tj = f.length ? f.pop() : null;\n\t\t\t\t\tf = f.join('');\n\t\t\t\t}\n\t\t\t\t// console.log(token, f, p, j);\n\t\t\t\treturn f.length ? $filter(f)(range[p], j) : range[p];\n\t\t\t});\n\t\t\t// console.log(name);\n\t\t\treturn name;\n\t\t}\n\n\t\tfunction RangeExtract(obj, value) {\n\t\t\treturn Object.keys(obj)[Object.values(obj).indexOf(value)];\n\t\t}\n\n    }]);\n\n\t(function() {\n\t\t// POLYFILL Object.values\n\t\tif (typeof Object.values !== 'function') {\n\t\t\tObject.defineProperty(Object, 'values', {\n\t\t\t\tvalue: function(obj) {\n\t\t\t\t\tvar vals = [];\n\t\t\t\t\tfor (var key in obj) {\n\t\t\t\t\t\tif (has(obj, key) && isEnumerable(obj, key)) {\n\t\t\t\t\t\t\tvals.push(obj[key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn vals;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}());\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t/*\n\tapp.value('now', null);\n\t*/\n\n\tapp.value('$formats', {\n\t\tjust_now: 'just now',\n\t\tseconds_ago: '{{num}} seconds ago',\n\t\ta_minute_ago: 'a minute ago',\n\t\tminutes_ago: '{{num}} minutes ago',\n\t\tan_hour_ago: 'an hour ago',\n\t\thours_ago: '{{num}} hours ago',\n\t\ta_day_ago: 'yesterday',\n\t\tdays_ago: '{{num}} days ago',\n\t\ta_week_ago: 'a week ago',\n\t\tweeks_ago: '{{num}} weeks ago',\n\t\ta_month_ago: 'a month ago',\n\t\tmonths_ago: '{{num}} months ago',\n\t\ta_year_ago: 'a year ago',\n\t\tyears_ago: '{{num}} years ago',\n\t\tover_a_year_ago: 'over a year ago',\n\t\tseconds_from_now: '{{num}} seconds from now',\n\t\ta_minute_from_now: 'a minute from now',\n\t\tminutes_from_now: '{{num}} minutes from now',\n\t\tan_hour_from_now: 'an hour from now',\n\t\thours_from_now: '{{num}} hours from now',\n\t\ta_day_from_now: 'tomorrow',\n\t\tdays_from_now: '{{num}} days from now',\n\t\ta_week_from_now: 'a week from now',\n\t\tweeks_from_now: '{{num}} weeks from now',\n\t\ta_month_from_now: 'a month from now',\n\t\tmonths_from_now: '{{num}} months from now',\n\t\ta_year_from_now: 'a year from now',\n\t\tyears_from_now: '{{num}} years from now',\n\t\tover_a_year_from_now: 'over a year from now'\n\t});\n\n\tapp.filter('dateRelative', ['$rootScope', '$interval', '$injector', '$formats', function($rootScope, $interval, $injector, $formats) {\n\n\t\tvar minute = 60;\n\t\tvar hour = minute * 60;\n\t\tvar day = hour * 24;\n\t\tvar week = day * 7;\n\t\tvar month = day * 30;\n\t\tvar year = day * 365;\n\n\t\tvar $format = getFormat();\n\n\t\tfunction getFormat() {\n\t\t\tif ($injector.has('$format')) {\n\t\t\t\treturn $injector.get('$format');\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\tinstant: function(id, params) {\n\t\t\t\t\t\treturn $formats[id].replace('{{num}}', params.num);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tfunction getDelta(now, date) {\n\t\t\treturn Math.round(Math.abs(now - date) / 1000);\n\t\t}\n\t\t/*\n        $interval(function () {\n            $rootScope.$now = new Date();\n            console.log($rootScope.$now);\n        }, 3 * 1000);\n\t\t*/\n\t\treturn function(date) {\n\t\t\tif (!(date instanceof Date)) {\n\t\t\t\tdate = new Date(date);\n\t\t\t}\n\n\t\t\t// now = now || new Date();\n\t\t\tvar now = new Date();\n\n\t\t\tvar delta = getDelta(now, date);\n\n\t\t\tif (delta > day && delta < week) {\n\t\t\t\tdate = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0, 0);\n\t\t\t\tdelta = getDelta(now, date);\n\t\t\t}\n\n\t\t\tvar suffix = now >= date ? '_ago' : '_from_now';\n\n\t\t\tfunction format(key, num) {\n\t\t\t\treturn $format.instant(key + (delta > 30 ? suffix : ''), {\n\t\t\t\t\tnum: num\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconsole.log('delta', delta, now, date);\n\n\t\t\tif (delta < 30) {\n\t\t\t\treturn format('just_now');\n\n\t\t\t} else if (delta < minute) {\n\t\t\t\treturn format('seconds', delta);\n\n\t\t\t} else if (delta < 2 * minute) {\n\t\t\t\treturn format('a_minute');\n\n\t\t\t} else if (delta < hour) {\n\t\t\t\treturn format('minutes', Math.floor(delta / minute));\n\n\t\t\t} else if (delta < hour * 2) {\n\t\t\t\treturn format('an_hour');\n\n\t\t\t} else if (delta < day) {\n\t\t\t\treturn format('hours', Math.floor(delta / hour));\n\n\t\t\t} else if (delta < day * 2) {\n\t\t\t\treturn format('a_day');\n\n\t\t\t} else if (delta < week) {\n\t\t\t\treturn format('days', Math.floor(delta / day));\n\n\t\t\t} else if (Math.floor(delta / week) !== 1) {\n\t\t\t\treturn format('a_week');\n\n\t\t\t} else if (delta < month) {\n\t\t\t\treturn format('weeks', Math.floor(delta / week));\n\n\t\t\t} else if (Math.floor(delta / month) !== 1) {\n\t\t\t\treturn format('a_month');\n\n\t\t\t} else if (delta < year) {\n\t\t\t\treturn format('months', Math.floor(delta / month));\n\n\t\t\t} else if (Math.floor(delta / year) !== 1) {\n\t\t\t\treturn format('a_year');\n\n\t\t\t} else {\n\t\t\t\treturn format('over_a_year');\n\n\t\t\t}\n\n\t\t};\n    }]);\n\n\tapp.directive('dateRelative', ['$parse', '$filter', '$interval', function($parse, $filter, $interval) {\n\t\treturn {\n\t\t\tpriority: 1001,\n\t\t\trestrict: 'A',\n\t\t\tlink: function(scope, element, attributes, model) {\n\n\t\t\t\tfunction setDate() {\n\t\t\t\t\tvar date = $parse(attributes.dateRelative)(scope);\n\t\t\t\t\tvar relative = $filter('dateRelative')(date);\n\t\t\t\t\telement[0].innerHTML = relative;\n\t\t\t\t\t// console.log('dateRelative.setDate', relative);\n\t\t\t\t}\n\n\t\t\t\tsetDate();\n\n\t\t\t\tvar i = setInterval(setDate, 60 * 1000);\n\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tcancelInterval(i);\n\t\t\t\t});\n\n\t\t\t}\n\t\t};\n\t}]);\n\n\t// directive dateRelative -> apply filter every timeout\n\n\t/*\n\tmyApp.config(function ($translateProvider) {\n\t    $translateProvider.translations('en', {\n\t        just_now: 'just now',\n\t        seconds_ago: '{{time}} seconds ago',\n\t    });\n\n\t    $translateProvider.translations('de', {\n\t        just_now: 'soeben',\n\t        seconds_ago: 'vor {{time}} stunden',\n\t    });\n\n\t    $translateProvider.preferredLanguage('en');\n\t});\n\t*/\n\n}());\n\n/*\n// handle transition on resizing\nvar resizingTimeout;\n$(window).on('resize', function () {\n    clearTimeout(resizingTimeout);\n    $('body').addClass('resizing');\n    resizingTimeout = setTimeout(function () {\n        $('body').removeClass('resizing');\n    }, 100);\n})\n*/\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Dom', ['Point', 'Rect', function(Point, Rect) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tgetBoundRect: getBoundRect,\n\t\t\tgetClosest: getClosest,\n\t\t\tgetClosestNode: getClosestNode,\n\t\t\tgetDelta: getDelta,\n\t\t\tgetDocumentNode: getDocumentNode,\n\t\t\tgetElement: getElement,\n\t\t\tgetNode: getNode,\n\t\t\tgetNodeOffset: getNodeOffset,\n\t\t\tgetPageScroll: getPageScroll,\n\t\t\tgetParents: getParents,\n\t\t\tgetView: getView,\n\t\t\tgetPointInView: getPointInView,\n\t\t\tcompileController: compileController,\n\t\t\tdownloadFile: downloadFile,\n\t\t\tua: getUA(),\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// return node element BoundingClientRect\n\t\tfunction getBoundRect(node) {\n\t\t\tnode = getNode(node);\n\t\t\tif (node === window) {\n\t\t\t\tnode = getDocumentNode();\n\t\t\t}\n\t\t\tvar rect = node.getBoundingClientRect();\n\t\t\treturn rect;\n\t\t}\n\n\t\t// return closest parent node that match a selector\n\t\tfunction getClosest(node, selector) {\n\t\t\tvar matchesFn, parent;\n            ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function(fn) {\n\t\t\t\tif (typeof document.body[fn] == 'function') {\n\t\t\t\t\tmatchesFn = fn;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tif (node[matchesFn](selector)) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t\twhile (node !== null) {\n\t\t\t\tparent = node.parentElement;\n\t\t\t\tif (parent !== null && parent[matchesFn](selector)) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\t\t\t\tnode = parent;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\t// return closest parent node that math a target node\n\t\tfunction getClosestNode(node, target) {\n\t\t\tvar parent = null;\n\t\t\tif (node === target) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t\twhile (node !== null) {\n\t\t\t\tparent = node.parentElement;\n\t\t\t\tif (parent !== null && parent === target) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\t\t\t\tnode = parent;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\t// return wheel delta\n\t\tfunction getDelta(event) {\n\t\t\tvar original = event.originalEvent ? event.originalEvent : event;\n\t\t\tvar type = original.type;\n\t\t\tvar delta = null;\n\t\t\tif (type === 'wheel' || type === 'mousewheel' || type === 'DOMMouseScroll') {\n\t\t\t\tvar deltaX = original.deltaX || original.wheelDeltaX;\n\t\t\t\tvar deltaY = original.deltaY || original.wheelDeltaY;\n\t\t\t\tdelta = new Point(deltaX, deltaY);\n\t\t\t\tif (Math.abs(deltaX) > Math.abs(deltaY)) {\n\t\t\t\t\tdelta.dir = deltaX < 0 ? 1 : -1;\n\t\t\t\t} else {\n\t\t\t\t\tdelta.dir = deltaY < 0 ? 1 : -1;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn delta;\n\t\t}\n\n\t\t// return document element node\n\t\tfunction getDocumentNode() {\n\t\t\tvar documentNode = (document.documentElement || document.body.parentNode || document.body);\n\t\t\treturn documentNode;\n\t\t}\n\n\t\t// return an angular element\n\t\tfunction getElement(element) {\n\t\t\treturn angular.isArray(element) ? element : angular.element(element);\n\t\t}\n\n\t\t// return a native html node\n\t\tfunction getNode(element) {\n\t\t\treturn angular.isArray(element) ? element[0] : element;\n\t\t}\n\n\t\t// return a node offset point\n\t\tfunction getNodeOffset(node) {\n\t\t\tvar offset = new Point();\n\t\t\tnode = getNode(node);\n\t\t\tif (node && node.nodeType === 1) {\n\t\t\t\toffset.x = node.offsetLeft;\n\t\t\t\toffset.y = node.offsetTop;\n\t\t\t}\n\t\t\treturn offset;\n\t\t}\n\n\t\t// return the current page scroll\n\t\tfunction getPageScroll() {\n\t\t\tvar scroll = new Point();\n\t\t\tvar documentNode = getDocumentNode();\n\t\t\tscroll.x = window.pageXOffset || documentNode.scrollLeft;\n\t\t\tscroll.y = window.pageYOffset || documentNode.scrollTop;\n\t\t\treturn scroll;\n\t\t}\n\n\t\t// return an array of node parants\n\t\tfunction getParents(node, topParentNode) {\n\t\t\t// if no topParentNode defined will bubble up all the way to *document*\n\t\t\ttopParentNode = topParentNode || getDocumentNode();\n\t\t\tvar parents = [];\n\t\t\tif (node) {\n\t\t\t\tparents.push(node);\n\t\t\t\tvar parentNode = node.parentNode;\n\t\t\t\twhile (parentNode && parentNode !== topParentNode) {\n\t\t\t\t\tparents.push(parentNode);\n\t\t\t\t\tparentNode = parentNode.parentNode;\n\t\t\t\t}\n\t\t\t\tparents.push(topParentNode); // push that topParentNode you wanted to stop at\n\t\t\t}\n\t\t\tparents.each = function(callback) {\n\t\t\t\tthis.filter(function(node) {\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(angular.element(node), node);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn parents;\n\t\t}\n\n\t\t// return the view rect\n\t\tfunction getView() {\n\t\t\tvar view = new Rect();\n\t\t\tif (window.innerWidth !== undefined) {\n\t\t\t\tview.width = window.innerWidth;\n\t\t\t\tview.height = window.innerHeight;\n\t\t\t} else {\n\t\t\t\tvar documentNode = getDocumentNode();\n\t\t\t\tview.width = documentNode.clientWidth;\n\t\t\t\tview.height = documentNode.clientHeight;\n\t\t\t}\n\t\t\treturn view;\n\t\t}\n\n\t\t// add to constant\n\t\tvar MOUSE_EVENTS = ['click', 'mousedown', 'mouseup', 'mousemove', 'mouseover', 'mouseout', 'mouseenter', 'mouseleave', 'contextmenu'];\n\t\tvar TOUCH_EVENTS = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\n\n\t\tfunction getPointInView(event) {\n\t\t\tvar original = event.originalEvent ? event.originalEvent : event;\n\t\t\tvar type = original.type;\n\t\t\tvar point = null;\n\t\t\tif (TOUCH_EVENTS.indexOf(type) !== -1) {\n\t\t\t\tvar touch = null;\n\t\t\t\tvar touches = original.touches.length ? original.touches : original.changedTouches;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\ttouch = touches[0];\n\t\t\t\t}\n\t\t\t\tif (touch) {\n\t\t\t\t\tpoint = new Point();\n\t\t\t\t\tpoint.x = touch.pageX;\n\t\t\t\t\tpoint.y = touch.pageY;\n\t\t\t\t}\n\t\t\t} else if (MOUSE_EVENTS.indexOf(type) !== -1) {\n\t\t\t\tpoint = new Point();\n\t\t\t\tpoint.x = original.pageX;\n\t\t\t\tpoint.y = original.pageY;\n\t\t\t}\n\t\t\treturn point;\n\t\t}\n\n\t\tfunction getUA() {\n\t\t\tvar agent = window.navigator.userAgent.toLowerCase();\n\t\t\tvar safari = agent.indexOf('safari') !== -1 && agent.indexOf('chrome') === -1;\n\t\t\tvar msie = agent.indexOf('trident') !== -1 || agent.indexOf('edge') !== -1 || agent.indexOf('msie') !== -1;\n\t\t\tvar chrome = !safari && !msie && agent.indexOf('chrome') !== -1;\n\t\t\tvar mobile = agent.indexOf('mobile') !== -1;\n\t\t\tvar mac = agent.indexOf('macintosh') !== -1;\n\t\t\tvar ua = {\n\t\t\t\tagent: agent,\n\t\t\t\tsafari: safari,\n\t\t\t\tmsie: msie,\n\t\t\t\tchrome: chrome,\n\t\t\t\tmobile: mobile,\n\t\t\t\tmac: mac,\n\t\t\t};\n\t\t\tangular.forEach(ua, function(value, key) {\n\t\t\t\tif (value) {\n\t\t\t\t\tangular.element(document.getElementsByTagName('body')).addClass(key);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ua;\n\t\t}\n\n\t\t/*\n    function mobilecheck() {\n        var check = false;\n        (function(a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n        return check;\n    }\n\n    // For those wishing to include tablets in this test (though arguably, you shouldn't), you can use the following function:\n    function mobileAndTabletcheck() {\n        var check = false;\n        (function(a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n        return check;\n    }\n\n    var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n    var isMobile = mobilecheck();\n    var isMobileAndTabled = mobileAndTabletcheck();\n\t\t*/\n\n\t\tfunction compileController(scope, element, html, data) {\n\t\t\t// console.log('Dom.compileController', element);\n\t\t\telement = getElement(element);\n\t\t\telement.html(html);\n\t\t\tvar link = $compile(element.contents());\n\t\t\tif (data.controller) {\n\t\t\t\tvar $scope = scope.$new();\n\t\t\t\tangular.extend($scope, data);\n\t\t\t\tvar controller = $controller(data.controller, {\n\t\t\t\t\t$scope: $scope\n\t\t\t\t});\n\t\t\t\tif (data.controllerAs) {\n\t\t\t\t\tscope[data.controllerAs] = controller;\n\t\t\t\t}\n\t\t\t\telement.data('$ngControllerController', controller);\n\t\t\t\telement.children().data('$ngControllerController', controller);\n\t\t\t\tscope = $scope;\n\t\t\t}\n\t\t\tlink(scope);\n\t\t}\n\n\t\tfunction downloadFile(content, name, type) {\n\t\t\ttype = type || 'application/octet-stream';\n\t\t\tvar base64 = null;\n\t\t\tvar blob = new Blob([content], {\n\t\t\t\ttype: type\n\t\t\t});\n\t\t\tvar reader = new window.FileReader();\n\t\t\treader.readAsDataURL(blob);\n\t\t\treader.onloadend = function() {\n\t\t\t\tbase64 = reader.result;\n\t\t\t\tdownload();\n\t\t\t};\n\n\t\t\tfunction download() {\n\t\t\t\tif (document.createEvent) {\n\t\t\t\t\tvar anchor = document.createElement('a');\n\t\t\t\t\tanchor.href = base64;\n\t\t\t\t\tif (anchor.download !== undefined) {\n\t\t\t\t\t\tvar downloadName = name || base64.substring(base64.lastIndexOf('/') + 1, base64.length);\n\t\t\t\t\t\tanchor.download = downloadName;\n\t\t\t\t\t}\n\t\t\t\t\tvar event = document.createEvent('MouseEvents');\n\t\t\t\t\tevent.initEvent('click', true, true);\n\t\t\t\t\tanchor.dispatchEvent(event);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tvar query = '?download';\n\t\t\t\twindow.open(base64.indexOf('?') > -1 ? base64 : base64 + query, '_self');\n\t\t\t}\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Event', ['EventsService', 'Dom', 'Point', 'Rect', function(EventsService, Dom, Point, Rect) {\n\n\t\tfunction Event(event, element) {\n\t\t\ttry {\n\t\t\t\tevent = event || window.event;\n\t\t\t\tvar type = event.type;\n\t\t\t\tvar originalEvent = event.originalEvent ? event.originalEvent : event;\n\t\t\t\tvar node = element[0]; // Dom.getNode(element);\n\t\t\t\tvar offset = Dom.getNodeOffset(node);\n\t\t\t\tvar rect = Dom.getBoundRect(node);\n\t\t\t\tvar view = Dom.getView();\n\t\t\t\tvar scroll = Dom.getPageScroll();\n\t\t\t\tvar point = Dom.getPointInView(event);\n\t\t\t\tif (point) {\n\t\t\t\t\tvar absolute = new Point(point.x - scroll.x, point.y - scroll.y);\n\t\t\t\t\tvar relative = new Point(absolute.x - rect.left, absolute.y - rect.top);\n\t\t\t\t\tthis.point = point;\n\t\t\t\t\tthis.absolute = absolute;\n\t\t\t\t\tthis.relative = relative;\n\t\t\t\t}\n\t\t\t\tvar delta = Dom.getDelta(event);\n\t\t\t\tif (delta) {\n\t\t\t\t\tthis.delta = delta;\n\t\t\t\t\tthis.dir = delta.dir;\n\t\t\t\t}\n\t\t\t\tthis.event = event;\n\t\t\t\tthis.type = type;\n\t\t\t\tthis.originalEvent = originalEvent;\n\t\t\t\tthis.element = element;\n\t\t\t\tthis.node = node;\n\t\t\t\tthis.offset = offset;\n\t\t\t\tthis.rect = rect;\n\t\t\t\tthis.view = view;\n\t\t\t\tthis.scroll = scroll;\n\t\t\t\tthis.timestamp = new Date().getTime();\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('Event.error', error);\n\t\t\t}\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tstop: stop,\n\t\t};\n\n\t\tangular.extend(Event, statics);\n\t\tangular.extend(Event.prototype, publics);\n\t\treturn Event;\n\n\t\t// prototype methods\n\n\t\tfunction stop() {\n\t\t\tthis.event.stopPropagation();\n\t\t\tthis.event.preventDefault();\n\t\t}\n\n\t}]);\n\n\tapp.factory('Events', ['EventsService', 'Event', 'Dom', function(EventsService, Event, Dom) {\n\n\t\tfunction Events(element) {\n\t\t\tvar events = this;\n\n\t\t\tthis.element = Dom.getElement(element);\n\t\t\tthis.listeners = {};\n\t\t\tthis.standardEvents = {\n\t\t\t\tclick: {\n\t\t\t\t\tkey: 'click',\n\t\t\t\t\tcallback: onClick\n\t\t\t\t},\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'mousedown',\n\t\t\t\t\tcallback: onMouseDown\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'mousemove',\n\t\t\t\t\tcallback: onMouseMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'mouseup',\n\t\t\t\t\tcallback: onMouseUp\n\t\t\t\t},\n\t\t\t\tresize: {\n\t\t\t\t\tkey: 'resize',\n\t\t\t\t\tcallback: onResize\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.touchEvents = {\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'touchstart',\n\t\t\t\t\tcallback: onTouchStart\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'touchmove',\n\t\t\t\t\tcallback: onTouchMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'touchend',\n\t\t\t\t\tcallback: onTouchEnd\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.wheelEvents = {\n\t\t\t\twheel: {\n\t\t\t\t\tkey: 'mousewheel',\n\t\t\t\t\tcallback: onMouseWheel\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.scrollEvents = {\n\t\t\t\twheel: {\n\t\t\t\t\tkey: 'DOMMouseScroll',\n\t\t\t\t\tcallback: onMouseScroll\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.timestamp = new Date().getTime();\n\t\t\tthis.setTimestamp = setTimestamp;\n\n\t\t\tfunction setTimestamp(event) {\n\t\t\t\tif (event) {\n\t\t\t\t\tevent.interval = Math.min(250, event.timestamp - events.timestamp);\n\t\t\t\t\t// console.log(event.interval, event.timestamp, events.timestamp);\n\t\t\t\t}\n\t\t\t\tevents.timestamp = new Date().getTime();\n\t\t\t}\n\n\t\t\tfunction onClick(e) {\n\t\t\t\t// console.log('onClick', e, events);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.click.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseDown(e) {\n\t\t\t\t// console.log('onMouseDown', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeTouchEvents();\n\t\t\t}\n\n\t\t\tfunction onMouseMove(e) {\n\t\t\t\t// console.log('onMouseMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseUp(e) {\n\t\t\t\t// console.log('onMouseUp', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseWheel(e) {\n\t\t\t\t// console.log('onMouseWheel', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.wheel.apply(this, [event]);\n\t\t\t\tevents.removeScrollEvents();\n\t\t\t}\n\n\t\t\tfunction onMouseScroll(e) {\n\t\t\t\t// console.log('onMouseScroll', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.wheel.apply(this, [event]);\n\t\t\t\tevents.removeWheelEvents();\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\t// console.log('onResize', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.resize.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchStart(e) {\n\t\t\t\t// console.log('onTouchStart', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeStandardEvents();\n\t\t\t}\n\n\t\t\tfunction onTouchMove(e) {\n\t\t\t\t// console.log('onTouchMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchEnd(e) {\n\t\t\t\t// console.log('onTouchEnd', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\t\t}\n\n\t\tvar statics = {\n\t\t\tgetTouch: getTouch,\n\t\t\tgetRelativeTouch: getRelativeTouch,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tadd: add,\n\t\t\tremove: remove,\n\t\t\tremoveStandardEvents: removeStandardEvents,\n\t\t\tremoveTouchEvents: removeTouchEvents,\n\t\t\tremoveWheelEvents: removeWheelEvents,\n\t\t\tremoveScrollEvents: removeScrollEvents,\n\t\t};\n\n\t\tangular.extend(Events, statics);\n\t\tangular.extend(Events.prototype, publics);\n\t\treturn Events;\n\n\t\t// prototype methods\n\n\t\tfunction add(listeners, scope) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents,\n\t\t\t\twheel = this.wheelEvents,\n\t\t\t\tscroll = this.scrollEvents;\n\t\t\tvar element = this.element,\n\t\t\t\twindowElement = angular.element(window);\n\n\t\t\tangular.forEach(listeners, function(callback, key) {\n\t\t\t\tif (events.listeners[key]) {\n\t\t\t\t\tvar listener = {};\n\t\t\t\t\tlistener[key] = events.listeners[key];\n\t\t\t\t\tremove(listener);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = callback;\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.on(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t\tif (wheel[key]) {\n\t\t\t\t\telement.on(wheel[key].key, wheel[key].callback);\n\t\t\t\t}\n\t\t\t\tif (scroll[key]) {\n\t\t\t\t\telement.on(scroll[key].key, scroll[key].callback);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (scope) {\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tevents.remove(listeners);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction remove(listeners) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents,\n\t\t\t\twheel = this.wheelEvents,\n\t\t\t\tscroll = this.scrollEvents;\n\t\t\tvar element = this.element,\n\t\t\t\twindowElement = angular.element(window);\n\t\t\tangular.forEach(listeners, function(callback, key) {\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.off(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t\tif (wheel[key]) {\n\t\t\t\t\telement.off(wheel[key].key, wheel[key].callback);\n\t\t\t\t}\n\t\t\t\tif (scroll[key]) {\n\t\t\t\t\telement.off(scroll[key].key, scroll[key].callback);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = null;\n\t\t\t});\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction removeStandardEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = events.element;\n\t\t\telement.off('mousedown', standard.down.callback);\n\t\t\telement.off('mousemove', standard.move.callback);\n\t\t\telement.off('mouseup', standard.up.callback);\n\t\t}\n\n\t\tfunction removeTouchEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = events.element;\n\t\t\telement.off('touchstart', touch.down.callback);\n\t\t\telement.off('touchmove', touch.move.callback);\n\t\t\telement.off('touchend', touch.up.callback);\n\t\t}\n\n\t\tfunction removeWheelEvents() {\n\t\t\tvar events = this;\n\t\t\tvar element = events.element;\n\t\t\telement.off('mousewheel', events.mouseEvents.wheel.callback);\n\t\t}\n\n\t\tfunction removeScrollEvents() {\n\t\t\tvar events = this;\n\t\t\tvar element = events.element;\n\t\t\telement.off('DOMMouseScroll', events.scrollEvents.wheel.callback);\n\t\t}\n\n\t\t// statics methods\n\n\t\tfunction getTouch(e, previous) {\n\t\t\tvar point = new Point();\n\t\t\tif (e.type === 'touchstart' || e.type === 'touchmove' || e.type === 'touchend' || e.type === 'touchcancel') {\n\t\t\t\tvar touch = null;\n\t\t\t\tvar event = e.originalEvent ? e.originalEvent : e;\n\t\t\t\tvar touches = event.touches.length ? event.touches : event.changedTouches;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\ttouch = touches[0];\n\t\t\t\t}\n\t\t\t\tif (touch) {\n\t\t\t\t\tpoint.x = touch.pageX;\n\t\t\t\t\tpoint.y = touch.pageY;\n\t\t\t\t}\n\t\t\t} else if (e.type === 'click' || e.type === 'mousedown' || e.type === 'mouseup' || e.type === 'mousemove' || e.type === 'mouseover' || e.type === 'mouseout' || e.type === 'mouseenter' || e.type === 'mouseleave' || e.type === 'contextmenu') {\n\t\t\t\tpoint.x = e.pageX;\n\t\t\t\tpoint.y = e.pageY;\n\t\t\t}\n\t\t\tif (previous) {\n\t\t\t\tpoint.s = Point.difference(t, previous);\n\t\t\t}\n\t\t\tpoint.type = e.type;\n\t\t\treturn point;\n\t\t}\n\n\t\tfunction getRelativeTouch(node, point) {\n\t\t\tnode = angular.isArray(node) ? node[0] : node;\n\t\t\treturn Point.difference(point, {\n\t\t\t\tx: node.offsetLeft,\n\t\t\t\ty: node.offsetTop\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.service('EventsService', ['Dom', function(Dom) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\thasPassiveEvents: hasPassiveEvents,\n\t\t\taddEventListener: getAddEventListener(),\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// prevent history back on mac os\n\n\t\tpreventHistoryNavigation();\n\n\t\t// static methods\n\n\t\tfunction hasPassiveEvents() {\n\t\t\tvar supported = false;\n\t\t\tif (window.addEventListener) {\n\t\t\t\ttry {\n\t\t\t\t\tvar options = Object.defineProperty({}, 'passive', {\n\t\t\t\t\t\tget: function() {\n\t\t\t\t\t\t\tsupported = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\twindow.addEventListener('test', null, options);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('getAddEventListener.isSupprted', e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction getAddEventListener() {\n\t\t\tvar supported = hasPassiveEvents();\n\t\t\tif (!supported) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar defaults = {\n\t\t\t\tpassive: false,\n\t\t\t\tcapture: false,\n\t\t\t};\n\n\t\t\tfunction getModifiedAddEventListener(original) {\n\t\t\t\tfunction addEventListener(type, listener, options) {\n\t\t\t\t\tif (typeof options !== 'object') {\n\t\t\t\t\t\tvar capture = options === true;\n\t\t\t\t\t\toptions = angular.copy(defaults);\n\t\t\t\t\t\toptions.capture = capture;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toptions = angular.extend(angular.copy(defaults), options);\n\t\t\t\t\t}\n\t\t\t\t\toriginal.call(this, type, listener, options);\n\t\t\t\t}\n\t\t\t\treturn addEventListener;\n\t\t\t}\n\n\t\t\tvar original = EventTarget.prototype.addEventListener;\n\t\t\tvar modified = getModifiedAddEventListener(original);\n\t\t\tEventTarget.prototype.addEventListener = modified;\n\t\t\treturn modified;\n\t\t}\n\n\t\tfunction preventHistoryNavigation() {\n\t\t\tif (!Dom.ua.mac) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Dom.ua.chrome || Dom.ua.safari || Dom.ua.firefox) {\n\t\t\t\twindow.addEventListener('mousewheel', onScroll, {\n\t\t\t\t\tpassive: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onScroll(e) {\n\t\t\t\tif (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\t(e.deltaX < 0 && (Dom.getParents(e.target).filter(function(node) {\n\t\t\t\t\t\treturn node.scrollLeft > 0;\n\t\t\t\t\t}).length === 0)) ||\n\t\t\t\t\t(e.deltaX > 0 && (Dom.getParents(e.target).filter(function(node) {\n\t\t\t\t\t\treturn node.scrollWidth - node.scrollLeft > node.clientWidth;\n\t\t\t\t\t}).length === 0))\n\t\t\t\t) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular, app, Autolinker */\r\n(function() {\r\n\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.filter('notIn', ['$filter', function($filter) {\r\n\t\treturn function(array, filters, element) {\r\n\t\t\tif (filters) {\r\n\t\t\t\treturn $filter(\"filter\")(array, function(item) {\r\n\t\t\t\t\tfor (var i = 0; i < filters.length; i++) {\r\n\t\t\t\t\t\tif (filters[i][element] === item[element]) return false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('autolink', [function() {\r\n\t\treturn function(value) {\r\n\t\t\treturn Autolinker.link(value, {\r\n\t\t\t\tclassName: \"a-link\"\r\n\t\t\t});\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('shortName', ['$filter', function($filter) {\r\n\t\tfunction toTitleCase(str) {\r\n\t\t\treturn str.replace(/\\w\\S*/g, function(txt) {\r\n\t\t\t\treturn txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn function(value) {\r\n\t\t\tif (!value) {\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\tif (value.indexOf(' .') === value.length - 2) {\r\n\t\t\t\tvalue = value.split(' .').join('');\r\n\t\t\t}\r\n\t\t\t/*\r\n\t\t\tvar splitted;\r\n\t\t\tif (value.indexOf('.') !== -1) {\r\n\t\t\t    splitted = value.split('.');\r\n\t\t\t} else {\r\n\t\t\t    splitted = value.split(' ');\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\tvar splitted = value.split(' ');\r\n\t\t\tvar firstName = splitted.shift();\r\n\t\t\tif (splitted.length) {\r\n\t\t\t\tvar lastName = splitted.join(' ');\r\n\t\t\t\treturn firstName.substr(0, 1).toUpperCase() + '.' + toTitleCase(lastName);\r\n\t\t\t} else {\r\n\t\t\t\treturn firstName;\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customCurrency', ['$filter', function($filter) {\r\n\t\tvar legacyFilter = $filter('currency');\r\n\t\treturn function(cost, currency) {\r\n\t\t\treturn legacyFilter(cost * currency.ratio, currency.formatting);\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customSize', ['APP', function(APP) {\r\n\t\treturn function(inches) {\r\n\t\t\tif (APP.unit === APP.units.IMPERIAL) {\r\n\t\t\t\tvar feet = Math.floor(inches / 12);\r\n\t\t\t\tinches = inches % 12;\r\n\t\t\t\tinches = Math.round(inches * 10) / 10;\r\n\t\t\t\treturn (feet ? feet + '\\' ' : '') + (inches + '\\'\\'');\r\n\t\t\t} else {\r\n\t\t\t\tvar meters = Math.floor(inches * APP.size.ratio);\r\n\t\t\t\tvar cm = (inches * APP.size.ratio * 100) % 100;\r\n\t\t\t\tcm = Math.round(cm * 10) / 10;\r\n\t\t\t\treturn (meters ? meters + 'm ' : '') + (cm + 'cm');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customWeight', ['APP', function(APP) {\r\n\t\treturn function(pounds) {\r\n\t\t\tif (APP.unit === APP.units.IMPERIAL) {\r\n\t\t\t\tif (pounds < 1) {\r\n\t\t\t\t\tvar oz = pounds * 16;\r\n\t\t\t\t\toz = Math.round(oz * 10) / 10;\r\n\t\t\t\t\treturn (oz ? oz + 'oz ' : '');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpounds = Math.round(pounds * 100) / 100;\r\n\t\t\t\t\treturn (pounds ? pounds + 'lb ' : '');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar kg = Math.floor(pounds * APP.weight.ratio / 1000);\r\n\t\t\t\tvar grams = (pounds * APP.weight.ratio) % 1000;\r\n\t\t\t\tgrams = Math.round(grams * 10) / 10;\r\n\t\t\t\treturn (kg ? kg + 'kg ' : '') + (grams + 'g');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customNumber', ['$filter', function($filter) {\r\n\t\treturn function(value, precision, unit) {\r\n\t\t\tunit = unit || '';\r\n\t\t\t// return ((value || value === 0) ? $filter('number')(value, precision) + unit : '-');\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tif (Math.floor(value) === value) {\r\n\t\t\t\t\tprecision = 0;\r\n\t\t\t\t}\r\n\t\t\t\tvalue = $filter('number')(value, precision) + unit;\r\n\t\t\t} else {\r\n\t\t\t\tvalue = '-';\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('reportNumber', ['$filter', function($filter) {\r\n\t\treturn function(value, precision, unit) {\r\n\t\t\tunit = unit || '';\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvalue = $filter('number')(value, precision) + unit;\r\n\t\t\t} else {\r\n\t\t\t\tvalue = '-';\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customHours', [function() {\r\n\t\treturn function(value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value);\r\n\t\t\t\tvar minutes = Math.floor((value - hours) * 60);\r\n\t\t\t\tvar label = hours ? hours + ' H' : '';\r\n\t\t\t\tlabel += minutes ? ' ' + minutes + ' m' : '';\r\n\t\t\t\treturn label;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customTimer', [function() {\r\n\t\tvar second = 1000;\r\n\t\tvar minute = second * 60;\r\n\t\tvar hour = minute * 60;\r\n\t\treturn function(value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value / hour);\r\n\t\t\t\tvar minutes = Math.floor((value - hours * hour) / minute);\r\n\t\t\t\tvar seconds = Math.floor((value - hours * hour - minutes * minute) / second);\r\n\t\t\t\tvar label = hours ? hours + ' H' : '';\r\n\t\t\t\tlabel += minutes ? ' ' + minutes + ' m' : '';\r\n\t\t\t\tlabel += seconds ? ' ' + seconds + ' s' : '';\r\n\t\t\t\treturn label;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDigitalTimer', [function() {\r\n\t\tvar second = 1000;\r\n\t\tvar minute = second * 60;\r\n\t\tvar hour = minute * 60;\r\n\t\treturn function(value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value / hour);\r\n\t\t\t\tvar minutes = Math.floor((value - hours * hour) / minute);\r\n\t\t\t\tvar seconds = Math.floor((value - hours * hour - minutes * minute) / second);\r\n\t\t\t\t// hours = hours % 24;\r\n\t\t\t\treturn (hours < 10 ? '0' : '') + hours + ':' + (minutes < 10 ? '0' : '') + minutes + ':' + (seconds < 10 ? '0' : '') + seconds;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDigitalTime', [function() {\r\n\t\tvar second = 1000;\r\n\t\tvar minute = second * 60;\r\n\t\tvar hour = minute * 60;\r\n\t\treturn function(value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value / hour);\r\n\t\t\t\tvar minutes = Math.floor((value - hours * hour) / minute);\r\n\t\t\t\t// hours = hours % 24;\r\n\t\t\t\treturn (hours < 10 ? '0' : '') + hours + ':' + (minutes < 10 ? '0' : '') + minutes;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDate', ['$filter', function($filter) {\r\n\t\tvar filter = $filter('date');\r\n\t\treturn function(value, format, timezone) {\r\n\t\t\treturn value ? filter(value, format, timezone) : '-';\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customTime', ['$filter', function($filter) {\r\n\t\treturn function(value, placeholder) {\r\n\t\t\tif (value) {\r\n\t\t\t\treturn Utils.parseTime(value);\r\n\t\t\t} else {\r\n\t\t\t\treturn (placeholder ? placeholder : '-');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDigital', ['$filter', function($filter) {\r\n\t\treturn function(value, placeholder) {\r\n\t\t\tif (value) {\r\n\t\t\t\treturn Utils.parseHour(value);\r\n\t\t\t} else {\r\n\t\t\t\treturn (placeholder ? placeholder : '-');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customString', ['$filter', function($filter) {\r\n\t\treturn function(value, placeholder) {\r\n\t\t\treturn value ? value : (placeholder ? placeholder : '-');\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customEnum', function() {\r\n\t\treturn function(val) {\r\n\t\t\tval = val + 1;\r\n\t\t\treturn val < 10 ? '0' + val : val;\r\n\t\t};\r\n\t});\r\n\r\n\tapp.filter('groupBy', ['$parse', 'filterWatcher', function($parse, filterWatcher) {\r\n\t\tfunction _groupBy(collection, getter) {\r\n\t\t\tvar dict = {};\r\n\t\t\tvar key;\r\n\t\t\tangular.forEach(collection, function(item) {\r\n\t\t\t\tkey = getter(item);\r\n\t\t\t\tif (!dict[key]) {\r\n\t\t\t\t\tdict[key] = [];\r\n\t\t\t\t}\r\n\t\t\t\tdict[key].push(item);\r\n\t\t\t});\r\n\t\t\treturn dict;\r\n\t\t}\r\n\t\treturn function(collection, property) {\r\n\t\t\tif (!angular.isObject(collection) || angular.isUndefined(property)) {\r\n\t\t\t\treturn collection;\r\n\t\t\t}\r\n\t\t\treturn filterWatcher.isMemoized('groupBy', arguments) || filterWatcher.memoize('groupBy', arguments, this, _groupBy(collection, $parse(property)));\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('htmlToPlaintext', function() {\r\n\t\tfunction getStyle(n, p) {\r\n\t\t\treturn n.currentStyle ? n.currentStyle[p] : window.getComputedStyle(n, null).getPropertyValue(p);\r\n\t\t}\r\n\r\n\t\tfunction toText(node) {\r\n\t\t\tvar result = '';\r\n\t\t\tif (node.nodeType == document.TEXT_NODE) {\r\n\t\t\t\tvar nodeValue = node.nodeValue;\r\n\t\t\t\tresult = nodeValue;\r\n\t\t\t\tresult = result ? String(result).replace(/</gm, '&lt;') : '';\r\n\t\t\t\tresult = result ? String(result).replace(/>/gm, '&gt;') : '';\r\n\t\t\t} else if (node.nodeType == document.ELEMENT_NODE) {\r\n\t\t\t\tfor (var i = 0, j = node.childNodes.length; i < j; i++) {\r\n\t\t\t\t\tresult += toText(node.childNodes[i]);\r\n\t\t\t\t}\r\n\t\t\t\tvar display = getStyle(node, 'display');\r\n\t\t\t\tif (display.match(/^block/) || display.match(/list/) || display.match(/row/) || node.tagName == 'BR' || node.tagName == 'HR') {\r\n\t\t\t\t\tresult += '\\n<br>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn function(html) {\r\n\t\t\tconsole.log(html);\r\n\t\t\tvar div = document.createElement('div');\r\n\t\t\tdiv.innerHTML = html;\r\n\t\t\treturn toText(div);\r\n\t\t\t// return html ? String(html).replace(/<[^>]+>/gm, '') : '';\r\n\t\t};\r\n\t});\r\n\r\n}());\r\n\n/* global angular, firebase */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Point', [function() {\n\n\t\tfunction Point(x, y) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tdifference: PointDifference,\n\t\t\tmultiply: PointMultiply,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tclone: clone,\n\t\t\tcopy: copy,\n\t\t\tdifference: difference,\n\t\t\tmult: mult,\n\t\t\toffset: offset,\n\t\t\tsetPos: setPos,\n\t\t\tsetX: setX,\n\t\t\tsetY: setY,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Point, statics);\n\t\tangular.extend(Point.prototype, publics);\n\n\t\treturn Point;\n\n\t\t// static methods\n\n\t\tfunction PointDifference(a, b) {\n\t\t\treturn new Point(a.x - b.x, a.y - b.y);\n\t\t}\n\n\t\tfunction PointMultiply(point, value) {\n\t\t\tpoint.x *= value;\n\t\t\tpoint.y *= value;\n\t\t\treturn point;\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction clone() {\n\t\t\treturn new Point(this.x, this.y);\n\t\t}\n\n\t\tfunction copy(point) {\n\t\t\tthis.x = point.x;\n\t\t\tthis.y = point.y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction difference(b) {\n\t\t\treturn PointDifference(this, b);\n\t\t}\n\n\t\tfunction mult(value) {\n\t\t\treturn PointMultiply(this, value);\n\t\t}\n\n\t\tfunction offset(x, y) {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setPos(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setX(x) {\n\t\t\tthis.x = x;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setY(y) {\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + '}';\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular, firebase */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Rect', [function() {\n\n\t\tfunction Rect(x, y, w, h) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t\tthis.w = w || 0;\n\t\t\tthis.h = h || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tmult: RectMultiply,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tbottom: bottom,\n\t\t\tbottomLeft: bottomLeft,\n\t\t\tbottomRight: bottomRight,\n\t\t\tcenter: center,\n\t\t\tclone: clone,\n\t\t\tcopy: copy,\n\t\t\texpand: expand,\n\t\t\texpandRect: expandRect,\n\t\t\tintersect: intersect,\n\t\t\tleft: left,\n\t\t\tmult: mult,\n\t\t\toffset: offset,\n\t\t\treduce: reduce,\n\t\t\treduceRect: reduceRect,\n\t\t\tright: right,\n\t\t\tsetH: setH,\n\t\t\tsetPos: setPos,\n\t\t\tsetSize: setSize,\n\t\t\tsetX: setX,\n\t\t\tsetY: setY,\n\t\t\tsetW: setW,\n\t\t\ttop: top,\n\t\t\ttopLeft: topLeft,\n\t\t\ttopRight: topRight,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Rect, statics);\n\t\tangular.extend(Rect.prototype, publics);\n\n\t\treturn Rect;\n\n\t\t// static methods\n\n\t\tfunction RectMultiply(rect, value) {\n\t\t\trect.x *= value;\n\t\t\trect.y *= value;\n\t\t\trect.w *= value;\n\t\t\trect.h *= value;\n\t\t\treturn rect;\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction bottom() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction bottomLeft() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction bottomRight() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction center() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction clone() {\n\t\t\treturn new Rect(this.x, this.y, this.w, this.h);\n\t\t}\n\n\t\tfunction copy(rect) {\n\t\t\tthis.x = rect.x;\n\t\t\tthis.y = rect.y;\n\t\t\tthis.w = rect.w;\n\t\t\tthis.h = rect.h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction expand(size) {\n\t\t\treturn this.expandRect({\n\t\t\t\tx: size,\n\t\t\t\ty: size,\n\t\t\t\tw: size * 2,\n\t\t\t\th: size * 2\n\t\t\t});\n\t\t}\n\n\t\tfunction expandRect(rect) {\n\t\t\tthis.x -= rect.x || 0;\n\t\t\tthis.y -= rect.y || 0;\n\t\t\tthis.w += rect.w || 0;\n\t\t\tthis.h += rect.h || 0;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction intersect(rect) {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn !(rect.x > x + w || rect.x + rect.w < x || rect.y > y + h || rect.y + rect.h < y);\n\t\t}\n\n\t\tfunction left() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction mult(value) {\n\t\t\treturn RectMultiply(this, value);\n\t\t}\n\n\t\tfunction offset(x, y) {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction reduce(size) {\n\t\t\treturn this.offset(-size);\n\t\t}\n\n\t\tfunction reduceRect(rect) {\n\t\t\treturn this.offsetRect(RectMultiply(rect, -1));\n\t\t}\n\n\t\tfunction right() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction setH(h) {\n\t\t\tthis.h = h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setPos(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setSize(w, h) {\n\t\t\tthis.w = w;\n\t\t\tthis.h = h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setX(x) {\n\t\t\tthis.x = x;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setY(y) {\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setW(w) {\n\t\t\tthis.w = w;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction top() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction topLeft() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction topRight() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + ',' + this.w + ',' + this.h + '}';\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular, firebase */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Vector', function() {\n\t\tfunction Vector(x, y) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tcross: VectorCross,\n\t\t\tdifference: VectorDifference,\n\t\t\tdistance: VectorDistance,\n\t\t\tincidence: VectorIncidence,\n\t\t\tmake: VectorMake,\n\t\t\tnormalize: VectorNormalize,\n\t\t\tpower: VectorPower,\n\t\t\tsize: VectorSize,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tadd: add,\n\t\t\tcopy: copy,\n\t\t\tcross: cross,\n\t\t\tdifference: difference,\n\t\t\tdistance: distance,\n\t\t\tfriction: friction,\n\t\t\tincidence: incidence,\n\t\t\tnormalize: normalize,\n\t\t\tpower: power,\n\t\t\tsize: size,\n\t\t\ttowards: towards,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Vector, statics);\n\t\tangular.extend(Vector.prototype, publics);\n\n\t\treturn Vector;\n\n\t\t// statics methods\n\n\t\tfunction VectorCross(a, b) {\n\t\t\treturn (a.x * b.y) - (a.y * b.x);\n\t\t}\n\n\t\tfunction VectorDifference(a, b) {\n\t\t\treturn new Vector(a.x - b.x, a.y - b.y);\n\t\t}\n\n\t\tfunction VectorDistance(a, b) {\n\t\t\treturn Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\n\t\t}\n\n\t\tfunction VectorIncidence(a, b) {\n\t\t\tvar angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\n\t\t\treturn angle;\n\t\t}\n\n\t\tfunction VectorMake(a, b) {\n\t\t\treturn new Vector(b.x - a.x, b.y - a.y);\n\t\t}\n\n\t\tfunction VectorNormalize(a) {\n\t\t\tvar l = Vector.size(a);\n\t\t\ta.x /= l;\n\t\t\ta.y /= l;\n\t\t\treturn a;\n\t\t}\n\n\t\tfunction VectorPower(a, b) {\n\t\t\tvar x = Math.abs(b.x - a.x);\n\t\t\tvar y = Math.abs(b.y - a.y);\n\t\t\treturn (x + y) / 2;\n\t\t}\n\n\t\tfunction VectorSize(a) {\n\t\t\treturn Math.sqrt(a.x * a.x + a.y * a.y);\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction add(b) {\n\t\t\tthis.x += b.x;\n\t\t\tthis.y += b.y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction copy(b) {\n\t\t\treturn new Vector(this.x, this.y);\n\t\t}\n\n\t\tfunction cross(b) {\n\t\t\treturn VectorCross(this, b);\n\t\t}\n\n\t\tfunction difference(b) {\n\t\t\treturn VectorDifference(this, b);\n\t\t}\n\n\t\tfunction distance(b) {\n\t\t\treturn VectorDistance(this, b);\n\t\t}\n\n\t\tfunction friction(b) {\n\t\t\tthis.x *= b;\n\t\t\tthis.y *= b;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction incidence(b) {\n\t\t\treturn VectorIncidence(this, b);\n\t\t}\n\n\t\tfunction normalize() {\n\t\t\treturn VectorNormalize(this);\n\t\t}\n\n\t\tfunction power() {\n\t\t\treturn (Math.abs(this.x) + Math.abs(this.y)) / 2;\n\t\t}\n\n\t\tfunction size() {\n\t\t\treturn VectorSize(this);\n\t\t}\n\n\t\tfunction towards(b, friction) {\n\t\t\tfriction = friction || 0.125;\n\t\t\tthis.x += (b.x - this.x) * friction;\n\t\t\tthis.y += (b.y - this.y) * friction;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + '}';\n\t\t}\n\n\t});\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Hash', [function() {\n\t\tvar pools = {};\n\n\t\tfunction Hash(key, pool) {\n\t\t\tkey = key || 'id';\n\t\t\tpool = pool ? HashGet(pool) : {};\n\t\t\tObject.defineProperties(this, {\n\t\t\t\tkey: {\n\t\t\t\t\tvalue: key,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: false\n\t\t\t\t},\n\t\t\t\tpool: {\n\t\t\t\t\tvalue: pool,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: false\n\t\t\t\t},\n\t\t\t\tlength: {\n\t\t\t\t\tvalue: 0,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: true\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tvar publics = {\n\t\t\thas: has,\n\t\t\tget: get,\n\t\t\tgetItem: getItem,\n\t\t\tset: set,\n\t\t\tadd: add,\n\t\t\tonce: once,\n\t\t\tremove: remove,\n\t\t\teach: each,\n\t\t\taddMany: addMany,\n\t\t\tremoveMany: removeMany,\n\t\t\tremoveAll: removeAll,\n\t\t\tforward: forward,\n\t\t\tbackward: backward,\n\t\t\tdiffers: differs,\n\t\t\tupdatePool: updatePool,\n\t\t};\n\n\t\tvar statics = {\n\t\t\tget: HashGet,\n\t\t};\n\n\t\tHash.prototype = new Array;\n\t\tangular.extend(Hash.prototype, publics);\n\t\tangular.extend(Hash, statics);\n\n\t\treturn Hash;\n\n\t\t// publics\n\t\tfunction has(id) {\n\t\t\treturn this.pool[id] !== undefined;\n\t\t}\n\n\t\tfunction get(id) {\n\t\t\treturn this.pool[id];\n\t\t}\n\n\t\tfunction getItem(item) {\n\t\t\tvar hash = this,\n\t\t\t\tkey = this.key;\n\t\t\treturn item ? hash.get(item[key]) : null;\n\t\t}\n\n\t\tfunction set(item) {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tpool[item[key]] = item;\n\t\t\thash.push(item);\n\t\t\treturn item;\n\t\t}\n\n\t\tfunction add(newItem) {\n\t\t\tvar hash = this;\n\t\t\tvar item = hash.getItem(newItem);\n\t\t\tif (item) {\n\t\t\t\tfor (var i = 0, keys = Object.keys(newItem), p; i < keys.length; i++) {\n\t\t\t\t\tp = keys[i];\n\t\t\t\t\titem[p] = newItem[p];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem = hash.set(newItem);\n\t\t\t}\n\t\t\treturn item;\n\t\t}\n\n\t\tfunction once(newItem, callback) {\n\t\t\tvar hash = this;\n\t\t\tvar item = hash.getItem(newItem);\n\t\t\tif (!item) {\n\t\t\t\titem = hash.set(newItem);\n\t\t\t}\n\t\t\tif (typeof callback == 'function') {\n\t\t\t\tcallback(item);\n\t\t\t}\n\t\t\treturn item;\n\t\t}\n\n\t\tfunction remove(oldItem) {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tvar item = hash.getItem(oldItem);\n\t\t\tif (item) {\n\t\t\t\tvar index = hash.indexOf(item);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\thash.splice(index, 1);\n\t\t\t\t}\n\t\t\t\tdelete pool[item[key]];\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction addMany(items) {\n\t\t\tvar hash = this;\n\t\t\tif (!items) {\n\t\t\t\treturn hash;\n\t\t\t}\n\t\t\tvar i = 0;\n\t\t\twhile (i < items.length) {\n\t\t\t\thash.add(items[i]);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction removeMany(items) {\n\t\t\tvar hash = this;\n\t\t\tif (!items) {\n\t\t\t\treturn hash;\n\t\t\t}\n\t\t\tvar i = 0;\n\t\t\twhile (i < items.length) {\n\t\t\t\thash.remove(items[i]);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction removeAll() {\n\t\t\tvar hash = this,\n\t\t\t\tkey = hash.key,\n\t\t\t\tpool = hash.pool;\n\t\t\tvar i = 0,\n\t\t\t\tt = hash.length,\n\t\t\t\titem;\n\t\t\twhile (hash.length) {\n\t\t\t\titem = hash.shift();\n\t\t\t\tdelete pool[item[key]];\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction each(callback) {\n\t\t\tvar hash = this;\n\t\t\tif (callback) {\n\t\t\t\tvar i = 0;\n\t\t\t\twhile (i < hash.length) {\n\t\t\t\t\tcallback(hash[i], i);\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction forward(key, reverse) {\n\t\t\tvar hash = this,\n\t\t\t\tkey = (key || this.key);\n\t\t\thash.sort(function(c, d) {\n\t\t\t\tvar a = reverse ? d : c;\n\t\t\t\tvar b = reverse ? c : d;\n\t\t\t\treturn a[key] - b[key];\n\t\t\t});\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction backward(key) {\n\t\t\treturn this.forward(key, true);\n\t\t}\n\n\t\tfunction differs(hash) {\n\t\t\tif (hash.key !== this.key || hash.length !== this.length) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tvar differs = false,\n\t\t\t\t\ti = 0,\n\t\t\t\t\tt = this.length,\n\t\t\t\t\tkey = this.key;\n\t\t\t\twhile (differs && i < t) {\n\t\t\t\t\tdiffers = this[i][key] !== hash[i][key];\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction updatePool() {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tObject.keys(pool).forEach(function(key) {\n\t\t\t\tdelete pool[key];\n\t\t\t});\n\t\t\tangular.forEach(hash, function(item) {\n\t\t\t\tpool[item[key]] = item;\n\t\t\t});\n\t\t}\n\n\t\t// statics\n\t\tfunction HashGet(pool) {\n\t\t\treturn pools[pool] = (pools[pool] || {});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('$promise', ['$q', function($q) {\n\n\t\tfunction $promise(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\tthrow ('promise resolve callback missing');\n\t\t\t}\n\t\t\tvar deferred = $q.defer();\n\t\t\tcallback(deferred);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tall: $promiseAll,\n\t\t};\n\n\t\tvar publics = {};\n\n\t\tangular.extend($promise, statics);\n\t\tangular.extend($promise.prototype, publics);\n\n\t\treturn $promise;\n\n\t\tfunction $promiseAll(promises) {\n\t\t\treturn $q.all(promises);\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('State', ['$timeout', '$rootScope', function($timeout, $rootScope) {\n\n\t\tfunction State() {\n\t\t\tthis.idle();\n\t\t}\n\n\t\tvar DELAY = 2000;\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tbusy: busy,\n\t\t\tclasses: classes,\n\t\t\tenabled: enabled,\n\t\t\terror: error,\n\t\t\terrorMessage: errorMessage,\n\t\t\terrors: [],\n\t\t\tidle: idle,\n\t\t\tlabels: labels,\n\t\t\tready: ready,\n\t\t\tsubmitClass: submitClass,\n\t\t\tsuccess: success,\n\t\t};\n\n\t\tangular.extend(State, statics);\n\t\tangular.extend(State.prototype, publics);\n\n\t\treturn State;\n\n\t\t// static methods\n\n\t\t// publics methods\n\n\t\tfunction busy() {\n\t\t\tvar state = this;\n\t\t\tif (!state.isBusy) {\n\t\t\t\tstate.isBusy = true;\n\t\t\t\tstate.isError = false;\n\t\t\t\tstate.isErroring = false;\n\t\t\t\tstate.isSuccess = false;\n\t\t\t\tstate.isSuccessing = false;\n\t\t\t\tstate.errors = [];\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfunction classes(addons) {\n\t\t\tvar state = this,\n\t\t\t\tclasses = null;\n\t\t\tclasses = {\n\t\t\t\tready: state.isReady,\n\t\t\t\tbusy: state.isBusy,\n\t\t\t\tsuccessing: state.isSuccessing,\n\t\t\t\tsuccess: state.isSuccess,\n\t\t\t\terrorring: state.isErroring,\n\t\t\t\terror: state.isError,\n\t\t\t};\n\t\t\tif (addons) {\n\t\t\t\tangular.forEach(addons, function(value, key) {\n\t\t\t\t\tclasses[value] = classes[key];\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn classes;\n\t\t}\n\n\t\tfunction enabled() {\n\t\t\tvar state = this;\n\t\t\treturn !state.isBusy && !state.isErroring && !state.isSuccessing;\n\t\t}\n\n\t\tfunction error(error) {\n\t\t\tconsole.log('State.error', error);\n\t\t\tvar state = this;\n\t\t\tstate.isBusy = false;\n\t\t\tstate.isError = true;\n\t\t\tstate.isErroring = true;\n\t\t\tstate.isSuccess = false;\n\t\t\tstate.isSuccessing = false;\n\t\t\tstate.errors.push(error);\n\t\t\t$timeout(function() {\n\t\t\t\tstate.isErroring = false;\n\t\t\t}, DELAY);\n\t\t}\n\n\t\tfunction errorMessage() {\n\t\t\tvar state = this;\n\t\t\treturn state.isError ? state.errors[state.errors.length - 1] : null;\n\t\t}\n\n\t\tfunction idle() {\n\t\t\tvar state = this;\n\t\t\tstate.isBusy = false;\n\t\t\tstate.isError = false;\n\t\t\tstate.isErroring = false;\n\t\t\tstate.isSuccess = false;\n\t\t\tstate.isSuccessing = false;\n\t\t\tstate.button = null;\n\t\t\tstate.errors = [];\n\t\t}\n\n\t\tfunction labels(addons) {\n\t\t\tvar state = this;\n\t\t\tvar defaults = {\n\t\t\t\tready: 'submit',\n\t\t\t\tbusy: 'sending',\n\t\t\t\terror: 'error',\n\t\t\t\tsuccess: 'success',\n\t\t\t};\n\t\t\tif (addons) {\n\t\t\t\tangular.extend(defaults, addons);\n\t\t\t}\n\t\t\tvar label = defaults.ready;\n\t\t\tif (state.isBusy) {\n\t\t\t\tlabel = defaults.busy;\n\t\t\t} else if (state.isSuccess) {\n\t\t\t\tlabel = defaults.success;\n\t\t\t} else if (state.isError) {\n\t\t\t\tlabel = defaults.error;\n\t\t\t}\n\t\t\treturn label;\n\t\t}\n\n\t\tfunction ready() {\n\t\t\tvar state = this;\n\t\t\tstate.idle();\n\t\t\tstate.isReady = true;\n\t\t\t$rootScope.$broadcast('$stateReady', state);\n\t\t}\n\n\t\tfunction submitClass() {\n\t\t\tvar state = this;\n\t\t\treturn {\n\t\t\t\tbusy: state.isBusy,\n\t\t\t\tready: state.isReady,\n\t\t\t\tsuccessing: state.isSuccessing,\n\t\t\t\tsuccess: state.isSuccess,\n\t\t\t\terrorring: state.isErroring,\n\t\t\t\terror: state.isError,\n\t\t\t};\n\t\t}\n\n\t\tfunction success() {\n\t\t\tvar state = this;\n\t\t\tstate.isBusy = false;\n\t\t\tstate.isError = false;\n\t\t\tstate.isErroring = false;\n\t\t\tstate.isSuccess = true;\n\t\t\tstate.isSuccessing = true;\n\t\t\tstate.errors = [];\n\t\t\t$timeout(function() {\n\t\t\t\tstate.isSuccessing = false;\n\t\t\t}, DELAY);\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar transformProperty = detectTransformProperty();\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Style', [function() {\n\n\t\tfunction Style() {\n\t\t\tthis.props = {\n\t\t\t\tscale: 1,\n\t\t\t\thoverScale: 1,\n\t\t\t\tcurrentScale: 1,\n\t\t\t};\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tset: set,\n\t\t\ttransform: transform,\n\t\t\ttransformOrigin: transformOrigin,\n\t\t};\n\n\t\tangular.extend(Style, statics);\n\t\tangular.extend(Style.prototype, publics);\n\n\t\treturn Style;\n\n\t\t// static methods\n\n\t\t// prototype methods\n\n\t\tfunction set(element) {\n\t\t\tvar styles = [];\n\t\t\tfor (var key in this) {\n\t\t\t\tif (key !== 'props') {\n\t\t\t\t\tstyles.push(key + ':' + this[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telement.style.cssText = styles.join(';') + ';';\n\t\t}\n\n\t\tfunction transform(transform) {\n\t\t\tthis[transformProperty] = transform;\n\t\t}\n\n\t\tfunction transformOrigin(x, y) {\n\t\t\tthis[transformProperty + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\n\t\t\tthis[transformProperty + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\n\t\t}\n\n    }]);\n\n\tfunction detectTransformProperty() {\n\t\tvar transformProperty = 'transform',\n\t\t\tsafariPropertyHack = 'webkitTransform';\n\t\tvar div = document.createElement(\"DIV\");\n\t\tif (typeof div.style[transformProperty] !== 'undefined') {\n            ['webkit', 'moz', 'o', 'ms'].every(function(prefix) {\n\t\t\t\tvar e = '-' + prefix + '-transform';\n\t\t\t\tif (typeof div.style[e] !== 'undefined') {\n\t\t\t\t\ttransformProperty = e;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\t\t} else if (typeof div.style[safariPropertyHack] !== 'undefined') {\n\t\t\ttransformProperty = '-webkit-transform';\n\t\t} else {\n\t\t\ttransformProperty = undefined;\n\t\t}\n\t\treturn transformProperty;\n\t}\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Utils', ['$compile', '$controller', 'Vector', function($compile, $controller, Vector) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tcompileController: compileController,\n\t\t\textract: extract,\n\t\t\tformat: format,\n\t\t\tindexOf: indexOf,\n\t\t\treducer: reducer,\n\t\t\treducerAdder: reducerAdder,\n\t\t\treducerSetter: reducerSetter,\n\t\t\tremoveValue: removeValue,\n\t\t\treverseSortOn: reverseSortOn,\n\t\t\tthrottle: throttle,\n\t\t\ttoMd5: toMd5,\n\t\t\twhere: where,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tvar getNow = Date.now || function() {\n\t\t\treturn new Date().getTime();\n\t\t};\n\n\t\tfunction compileController(scope, element, html, data) {\n\t\t\t// console.log('Utils.compileController', element);\n\t\t\telement.html(html);\n\t\t\tvar link = $compile(element.contents());\n\t\t\tif (data.controller) {\n\t\t\t\tvar $scope = scope.$new();\n\t\t\t\tangular.extend($scope, data);\n\t\t\t\tvar controller = $controller(data.controller, {\n\t\t\t\t\t$scope: $scope\n\t\t\t\t});\n\t\t\t\tif (data.controllerAs) {\n\t\t\t\t\tscope[data.controllerAs] = controller;\n\t\t\t\t}\n\t\t\t\telement.data('$ngControllerController', controller);\n\t\t\t\telement.children().data('$ngControllerController', controller);\n\t\t\t\tscope = $scope;\n\t\t\t}\n\t\t\tlink(scope);\n\t\t}\n\n\t\tfunction extract(obj, value) {\n\t\t\treturn Object.keys(obj)[Object.values(obj).indexOf(value)];\n\t\t}\n\n\t\tfunction format(string, prepend, expression) {\n\t\t\tstring = string || '';\n\t\t\tprepend = prepend || '';\n\t\t\tvar splitted = string.split(',');\n\t\t\tif (splitted.length > 1) {\n\t\t\t\tvar formatted = splitted.shift();\n\t\t\t\tangular.forEach(splitted, function(value, index) {\n\t\t\t\t\tif (expression) {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join(prepend + value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (expression) {\n\t\t\t\t\treturn '\\'' + formatted + '\\'';\n\t\t\t\t} else {\n\t\t\t\t\treturn formatted;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn prepend + string;\n\t\t\t}\n\t\t}\n\n\t\tfunction indexOf(array, object, key) {\n\t\t\tkey = key || 'id';\n\t\t\tvar index = -1;\n\t\t\tif (array) {\n\t\t\t\tvar i = 0,\n\t\t\t\t\tt = array.length;\n\t\t\t\twhile (i < t) {\n\t\t\t\t\tif (array[i] && array[i][key] === object[key]) {\n\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn index;\n\t\t}\n\n\t\tfunction reducer(o, key) {\n\t\t\treturn o[key];\n\t\t}\n\n\t\tfunction reducerAdder(o, key, value) {\n\t\t\tif (typeof key == 'string') {\n\t\t\t\treturn reducerAdder(o, key.split('.'), value);\n\t\t\t} else if (key.length == 1 && value !== undefined) {\n\t\t\t\treturn (o[key[0]] += value);\n\t\t\t} else if (key.length === 0) {\n\t\t\t\treturn o;\n\t\t\t} else {\n\t\t\t\treturn reducerAdder(o[key[0]], key.slice(1), value);\n\t\t\t}\n\t\t}\n\n\t\tfunction reducerSetter(o, key, value) {\n\t\t\tif (typeof key == 'string') {\n\t\t\t\treturn reducerSetter(o, key.split('.'), value);\n\t\t\t} else if (key.length == 1 && value !== undefined) {\n\t\t\t\treturn (o[key[0]] = value);\n\t\t\t} else if (key.length === 0) {\n\t\t\t\treturn o;\n\t\t\t} else {\n\t\t\t\treturn reducerSetter(o[key[0]], key.slice(1), value);\n\t\t\t}\n\t\t}\n\n\t\tfunction removeValue(array, value) {\n\t\t\tvar index = -1;\n\t\t\tif (array) {\n\t\t\t\tvar i = 0,\n\t\t\t\t\tt = array.length;\n\t\t\t\twhile (i < t) {\n\t\t\t\t\tif (array[i] === value) {\n\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (index !== -1) {\n\t\t\t\tarray.splice(index, 1);\n\t\t\t\treturn value;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tfunction reverseSortOn(key) {\n\t\t\treturn function(a, b) {\n\t\t\t\tif (a[key] < b[key]) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\tif (a[key] > b[key]) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\t// a must be equal to b\n\t\t\t\treturn 0;\n\t\t\t};\n\t\t}\n\n\t\tfunction throttle(func, wait, options) {\n\t\t\t// Returns a function, that, when invoked, will only be triggered at most once\n\t\t\t// during a given window of time. Normally, the throttled function will run\n\t\t\t// as much as it can, without ever going more than once per `wait` duration;\n\t\t\t// but if you'd like to disable the execution on the leading edge, pass\n\t\t\t// `{leading: false}`. To disable execution on the trailing edge, ditto.\n\t\t\tvar context, args, result;\n\t\t\tvar timeout = null;\n\t\t\tvar previous = 0;\n\t\t\tif (!options) options = {};\n\t\t\tvar later = function() {\n\t\t\t\tprevious = options.leading === false ? 0 : getNow();\n\t\t\t\ttimeout = null;\n\t\t\t\tresult = func.apply(context, args);\n\t\t\t\tif (!timeout) context = args = null;\n\t\t\t};\n\t\t\treturn function() {\n\t\t\t\tvar now = getNow();\n\t\t\t\tif (!previous && options.leading === false) previous = now;\n\t\t\t\tvar remaining = wait - (now - previous);\n\t\t\t\tcontext = this;\n\t\t\t\targs = arguments;\n\t\t\t\tif (remaining <= 0 || remaining > wait) {\n\t\t\t\t\tif (timeout) {\n\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\ttimeout = null;\n\t\t\t\t\t}\n\t\t\t\t\tprevious = now;\n\t\t\t\t\tresult = func.apply(context, args);\n\t\t\t\t\tif (!timeout) context = args = null;\n\t\t\t\t} else if (!timeout && options.trailing !== false) {\n\t\t\t\t\ttimeout = setTimeout(later, remaining);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t};\n\t\t}\n\n\t\tfunction toMd5(string) {\n\t\t\t// return Md5.encode(string);\n\t\t}\n\n\t\tfunction where(array, query) {\n\t\t\tvar found = null;\n\t\t\tif (array) {\n\t\t\t\tangular.forEach(array, function(item) {\n\t\t\t\t\tvar has = true;\n\t\t\t\t\tangular.forEach(query, function(value, key) {\n\t\t\t\t\t\thas = has && item[key] === value;\n\t\t\t\t\t});\n\t\t\t\t\tif (has) {\n\t\t\t\t\t\tfound = item;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn found;\n\t\t}\n\n    }]);\n\n\t(function() {\n\t\t// POLYFILL Array.prototype.reduce\n\t\t// Production steps of ECMA-262, Edition 5, 15.4.4.21\n\t\t// Reference: http://es5.github.io/#x15.4.4.21\n\t\t// https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n\t\tif (typeof Array.prototype.reduce !== 'function') {\n\t\t\tObject.defineProperty(Array.prototype, 'reduce', {\n\t\t\t\tvalue: function(callback) { // , initialvalue\n\t\t\t\t\tif (this === null) {\n\t\t\t\t\t\tthrow new TypeError('Array.prototype.reduce called on null or undefined');\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof callback !== 'function') {\n\t\t\t\t\t\tthrow new TypeError(callback + ' is not a function');\n\t\t\t\t\t}\n\t\t\t\t\tvar o = Object(this);\n\t\t\t\t\tvar len = o.length >>> 0;\n\t\t\t\t\tvar k = 0;\n\t\t\t\t\tvar value;\n\t\t\t\t\tif (arguments.length == 2) {\n\t\t\t\t\t\tvalue = arguments[1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\twhile (k < len && !(k in o)) {\n\t\t\t\t\t\t\tk++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (k >= len) {\n\t\t\t\t\t\t\tthrow new TypeError('Reduce of empty array with no initial value');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue = o[k++];\n\t\t\t\t\t}\n\t\t\t\t\twhile (k < len) {\n\t\t\t\t\t\tif (k in o) {\n\t\t\t\t\t\t\tvalue = callback(value, o[k], k, o);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tk++;\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}());\n\n\t(function() {\n\t\t// POLYFILL Object.values\n\t\tif (typeof Object.values !== 'function') {\n\t\t\tObject.defineProperty(Object, 'values', {\n\t\t\t\tvalue: function(obj) {\n\t\t\t\t\tvar vals = [];\n\t\t\t\t\tfor (var key in obj) {\n\t\t\t\t\t\tif (has(obj, key) && isEnumerable(obj, key)) {\n\t\t\t\t\t\t\tvals.push(obj[key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn vals;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}());\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.provider('environment', ['$locationProvider', '$httpProvider', function($locationProvider, $httpProvider) {\n\n\t\tvar provider = this;\n\n\t\tvar statics = {\n\t\t\tadd: EnvironmentAdd,\n\t\t\tuse: EnvironmentUse,\n\t\t};\n\n\t\tangular.extend(provider, statics);\n\n\t\tvar defaults = {\n\t\t\tplugins: {\n\t\t\t\tfacebook: {\n\t\t\t\t\tfields: 'id,name,first_name,last_name,email,gender,picture,cover,link',\n\t\t\t\t\tscope: 'public_profile, email', // publish_stream\n\t\t\t\t\tversion: 'v2.10',\n\t\t\t\t},\n\t\t\t\tgoogle: {},\n\t\t\t\tgooglemaps: {\n\t\t\t\t\tclusterer: true,\n\t\t\t\t\tstyles: '/googlemaps/applemapesque.json',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tcenter: {\n\t\t\t\t\t\t\tlat: 43.9023386,\n\t\t\t\t\t\t\tlng: 12.8505094\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdisableDefaultUI: true,\n\t\t\t\t\t\tmapTypeId: 'roadmap', // \"hybrid\", \"roadmap\", \"satellite\", \"terrain\"\n\t\t\t\t\t\tscrollwheel: true,\n\t\t\t\t\t\t// tilt: 0, // 45\n\t\t\t\t\t\tzoom: 4.0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmapbox: {\n\t\t\t\t\tclusterer: true,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tbearing: 0.0,\n\t\t\t\t\t\tcenter: [\n                            12.8505094,\n                            43.9023386\n                        ],\n\t\t\t\t\t\tcurve: 1,\n\t\t\t\t\t\tpitch: 0.0,\n\t\t\t\t\t\tspeed: 1.5,\n\t\t\t\t\t\tzoom: 4.0,\n\t\t\t\t\t},\n\t\t\t\t\tversion: 'v0.42.0',\n\t\t\t\t}\n\t\t\t},\n\t\t\thttp: {\n\t\t\t\tinterceptors: [], // ['AuthService'],\n\t\t\t\twithCredentials: false,\n\t\t\t},\n\t\t\tlanguage: {\n\t\t\t\tcode: 'en',\n\t\t\t\tculture: 'en_US',\n\t\t\t\tiso: 'ENU',\n\t\t\t\tname: 'English',\n\t\t\t},\n\t\t\tlocation: {\n\t\t\t\thash: '!',\n\t\t\t\thtml5: false,\n\t\t\t},\n\t\t\tpaths: {},\n\t\t};\n\n\t\tvar global = {};\n\n\t\tif (window.environment) {\n\t\t\tangular.merge(global, window.environment);\n\t\t}\n\n\t\tvar config = {};\n\n\t\tvar environment = angular.copy(defaults);\n\t\tangular.merge(environment, global);\n\n\t\tfunction EnvironmentSetHttp() {\n\t\t\t$httpProvider.defaults.headers.common[\"Accept-Language\"] = environment.language.code;\n\t\t\t$httpProvider.defaults.withCredentials = environment.http.withCredentials;\n\t\t\t$httpProvider.interceptors.push.apply($httpProvider.interceptors, environment.http.interceptors);\n\t\t}\n\n\t\tfunction EnvironmentSetLocation() {\n\t\t\t$locationProvider.html5Mode(environment.location.html5);\n\t\t\t$locationProvider.hashPrefix(environment.location.hash);\n\t\t}\n\n\t\tfunction EnvironmentAdd(key, data) {\n\t\t\tconfig[key] = config[key] ? angular.merge(config[key], data) : data;\n\t\t\tEnvironmentSet();\n\t\t}\n\n\t\tfunction EnvironmentSet() {\n\t\t\tenvironment = angular.copy(defaults);\n\t\t\tif (config.environment) {\n\t\t\t\tangular.merge(environment, config.environment);\n\t\t\t}\n\t\t\tvar value = EnvironmentGet();\n\t\t\tif (value) {\n\t\t\t\tangular.merge(environment, value);\n\t\t\t}\n\t\t\tangular.merge(environment, global);\n\t\t\tEnvironmentSetHttp();\n\t\t\tEnvironmentSetLocation();\n\t\t}\n\n\t\tfunction EnvironmentUse(key) {\n\t\t\tif (config[key]) {\n\t\t\t\tenvironment = angular.copy(defaults);\n\t\t\t\tangular.merge(environment, config[key]);\n\t\t\t\tangular.merge(environment, global);\n\t\t\t\tEnvironmentSetHttp();\n\t\t\t\tEnvironmentSetLocation();\n\t\t\t}\n\t\t}\n\n\t\tfunction EnvironmentGet() {\n\t\t\tfor (var key in config) {\n\t\t\t\tvar value = config[key];\n\t\t\t\tif (value.paths && window.location.href.indexOf(value.paths.app) !== -1) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprovider.$get = function() {\n\t\t\treturn environment;\n\t\t};\n\n    }]);\n\n}());\n\n/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Doc', ['Api', '$promise', function(Api, $promise) {\r\n\r\n\t\tfunction Doc(item) {\r\n\t\t\tif (item) {\r\n\t\t\t\tangular.extend(this, item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar statics = {};\r\n\r\n\t\tvar publics = {};\r\n\r\n\t\tangular.extend(Doc, statics);\r\n\t\tangular.extend(Doc.prototype, publics);\r\n\r\n\t\treturn Doc;\r\n\r\n\t\t// static methods\r\n\r\n\t\t// prototype methods\r\n\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Route', ['$promise', '$location', '$route', '$routeParams', 'Router', function($promise, $location, $route, $routeParams, Router) {\n\n\t\tfunction Route(current) {\n\n\t\t\tvar route = {\n\t\t\t\tcontroller: current.$$route.controller,\n\t\t\t\tparams: current.params,\n\t\t\t\tpath: $location.path(),\n\t\t\t\tpathParams: current.pathParams,\n\t\t\t\toriginalPath: current.$$route.originalPath,\n\t\t\t\ttemplateUrl: current.loadedTemplateUrl,\n\t\t\t};\n\t\t\tangular.extend(this, route);\n\t\t}\n\n\t\tvar statics = {\n\t\t\tcurrent: RouteCurrent,\n\t\t};\n\n\t\tvar publics = {};\n\n\t\tangular.extend(Route, statics);\n\t\tangular.extend(Route.prototype, publics);\n\n\t\treturn Route;\n\n\t\t// static methods\n\n\t\tfunction RouteCurrent() {\n\t\t\treturn new Route($route.current);\n\t\t}\n\n\t\t// prototype methods\n\n    }]);\n\n}());\n\n/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('View', ['Api', '$promise', 'environment', 'Doc', 'Route', function(Api, $promise, environment, Doc, Route) {\r\n\r\n\t\tfunction View(doc, route) {\r\n\t\t\tvar view = {\r\n\t\t\t\tdoc: doc,\r\n\t\t\t\tenvironment: environment,\r\n\t\t\t\troute: route,\r\n\t\t\t};\r\n\t\t\tangular.extend(this, view);\r\n\t\t}\r\n\r\n\t\tvar statics = {\r\n\t\t\tcurrent: ViewCurrent, // ViewCurrentSimple\r\n\t\t};\r\n\r\n\t\tvar publics = {};\r\n\r\n\t\tangular.extend(View, statics);\r\n\t\tangular.extend(View.prototype, publics);\r\n\r\n\t\treturn View;\r\n\r\n\t\t// static methods\r\n\r\n\t\tfunction ViewCurrent() {\r\n\t\t\treturn $promise(function(promise) {\r\n\t\t\t\tvar route = Route.current();\r\n\t\t\t\tvar path = route.path;\r\n\t\t\t\tconsole.log('ViewCurrent', path);\r\n\t\t\t\tApi.docs.path(path).then(function(response) {\r\n\t\t\t\t\tvar doc = new Doc(response);\r\n\t\t\t\t\tvar view = new View(doc, route);\r\n\t\t\t\t\tpromise.resolve(view);\r\n\r\n\t\t\t\t}, function(error) {\r\n\t\t\t\t\tpromise.reject(error);\r\n\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction ViewCurrentSimple() {\r\n\t\t\treturn $promise(function(promise) {\r\n\t\t\t\tconsole.log('ViewCurrentSimple');\r\n\t\t\t\tvar route = Route.current();\r\n\t\t\t\tvar path = route.path;\r\n\t\t\t\tApi.navs.main().then(function(items) {\r\n\t\t\t\t\tvar doc = null,\r\n\t\t\t\t\t\tview = null,\r\n\t\t\t\t\t\tpath = path,\r\n\t\t\t\t\t\tpool = ViewPool(items);\r\n\t\t\t\t\tvar item = pool[path];\r\n\t\t\t\t\tif (item) {\r\n\t\t\t\t\t\tdoc = new Doc(item);\r\n\t\t\t\t\t\tview = new View(doc, route);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpromise.resolve(view);\r\n\r\n\t\t\t\t}, function(error) {\r\n\t\t\t\t\tpromise.reject(error);\r\n\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction ViewPool(items) {\r\n\t\t\tvar pool = {};\r\n\r\n\t\t\tfunction _getPool(items) {\r\n\t\t\t\tif (items) {\r\n\t\t\t\t\tangular.forEach(items, function(item) {\r\n\t\t\t\t\t\tpool[item.path] = item;\r\n\t\t\t\t\t\t_getPool(item.items);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t_getPool(items);\r\n\t\t\treturn pool;\r\n\t\t}\r\n\r\n\t\t// prototype methods\r\n\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t// todo\n\n\tapp.service('AuthService', ['$q', '$rootScope', '$location', 'LocalStorage', 'environment', function($q, $rootScope, $location, LocalStorage, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tisAuthorizedOrGoTo: isAuthorizedOrGoTo,\n\t\t\tisAuthorized: isAuthorized,\n\t\t\trequest: request,\n\t\t\tresponse: response,\n\t\t\tresponseError: responseError,\n\t\t\tsignOut: signOut,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t/* * * * * * * * * * * * * * * * *\n\t\t *  detect current auth storage  *\n\t\t * * * * * * * * * * * * * * * * */\n\n\t\tconsole.log(environment.plugins);\n\n\t\t// statics methods\n\n\t\tfunction isAuthorizedOrGoTo(redirect) {\n\t\t\tvar deferred = $q.defer();\n\t\t\tvar auth = LocalStorage.get('authorization');\n\t\t\tif (auth && auth.created_at + auth.expires_in < new Date().getTime()) {\n\t\t\t\tdeferred.resolve(auth);\n\t\t\t} else {\n\t\t\t\tdeferred.reject({\n\t\t\t\t\tstatus: 'unauthorized'\n\t\t\t\t});\n\t\t\t\t$location.path(redirect);\n\t\t\t}\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tfunction isAuthorized() {\n\t\t\tvar auth = LocalStorage.get('authorization');\n\t\t\treturn (auth && auth.created_at + auth.expires_in < new Date().getTime());\n\t\t}\n\n\t\tfunction request(config) {\n\t\t\tvar auth = LocalStorage.get('authorization');\n\t\t\tif (auth && auth.created_at + auth.expires_in < new Date().getTime()) {\n\t\t\t\tconfig.headers = config.headers || {};\n\t\t\t\tconfig.headers.Authorization = 'Bearer ' + auth.access_token; // add your token from your service or whatever\n\t\t\t}\n\t\t\treturn config;\n\t\t}\n\n\t\tfunction response(response) {\n\t\t\treturn response || $q.when(response);\n\t\t}\n\n\t\tfunction responseError(error) {\n\t\t\tconsole.log('AuthService.responseError', error);\n\t\t\t// your error handler\n\t\t\tswitch (error.status) {\n\t\t\t\tcase 400:\n\t\t\t\t\tvar errors = [];\n\t\t\t\t\tif (error.data) {\n\t\t\t\t\t\terrors.push(error.data.Message);\n\t\t\t\t\t\tfor (var key in error.data.ModelState) {\n\t\t\t\t\t\t\tfor (var i = 0; i < error.data.ModelState[key].length; i++) {\n\t\t\t\t\t\t\t\terrors.push(error.data.ModelState[key][i]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\terrors.push('Server error');\n\t\t\t\t\t}\n\t\t\t\t\terror.Message = errors.join(' ');\n\t\t\t\t\t// warning !!\n\t\t\t\t\t$rootScope.httpError = error;\n\t\t\t\t\t$rootScope.$broadcast('onHttpInterceptorError', error);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 404:\n\t\t\t\t\terror.Message = \"Not found\";\n\t\t\t\t\t$rootScope.httpError = error;\n\t\t\t\t\t$rootScope.$broadcast('onHttpInterceptorError', error);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 500:\n\t\t\t\t\t// console.log('500',error);\n\t\t\t\t\t$rootScope.httpError = error;\n\t\t\t\t\t$rootScope.$broadcast('onHttpInterceptorError', error);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 401:\n\t\t\t\t\tLocalStorage.delete('authorization');\n\t\t\t\t\tLocalStorage.delete('user');\n\t\t\t\t\t$location.path('/signin');\n\t\t\t\t\tbreak;\n\t\t\t\tcase -1:\n\t\t\t\t\twindow.open(error.config.path, '_blank');\n\t\t\t\t\t// status == 0 you lost connection\n\t\t\t}\n\t\t\treturn $q.reject(error);\n\t\t}\n\n\t\tfunction signOut() {\n\t\t\tLocalStorage.delete('authorization');\n\t\t\tLocalStorage.delete('user');\n\t\t\tLocalStorage.delete('CampagnoloToken');\n\t\t\tLocalStorage.delete('GoogleToken');\n\t\t\tLocalStorage.delete('StravaToken');\n\t\t\tLocalStorage.delete('FacebookToken');\n\t\t\tLocalStorage.delete('GarminToken');\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Bearer', ['$http', '$promise', 'SessionStorage', 'LocalStorage', 'environment', function($http, $promise, SessionStorage, LocalStorage, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\t'delete': BearerDelete,\n\t\t\texist: BearerExists,\n\t\t\tget: BearerGet,\n\t\t\tset: BearerSet,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// statics methods\n\n\t\tfunction BearerDelete(accessToken, remember) {\n\t\t\tSessionStorage.delete('accessToken');\n\t\t\tLocalStorage.delete('accessToken');\n\t\t\tdelete $http.defaults.headers.common['Authorization'];\n\t\t}\n\n\t\tfunction BearerExists(accessToken, remember) {\n\t\t\treturn SessionStorage.exist('accessToken') || LocalStorage.exist('accessToken');\n\t\t}\n\n\t\tfunction BearerGet(accessToken, remember) {\n\t\t\tvar accessToken = null;\n\t\t\tif (SessionStorage.exist('accessToken')) {\n\t\t\t\taccessToken = SessionStorage.get('accessToken');\n\t\t\t\tBearerSet(accessToken);\n\t\t\t} else if (LocalStorage.exist('accessToken')) {\n\t\t\t\taccessToken = LocalStorage.get('accessToken');\n\t\t\t\tBearerSet(accessToken);\n\t\t\t}\n\t\t\treturn accessToken;\n\t\t}\n\n\t\tfunction BearerSet(accessToken, remember) {\n\t\t\tvar header = 'Bearer ' + accessToken;\n\t\t\tdelete $http.defaults.headers.common['Authorization'];\n\t\t\t$http.defaults.headers.common['Authorization'] = header;\n\t\t\tSessionStorage.set('accessToken', accessToken);\n\t\t\tif (remember) {\n\t\t\t\tLocalStorage.set('accessToken', accessToken);\n\t\t\t}\n\t\t\treturn header;\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.service('Http', ['$http', '$promise', '$timeout', 'environment', function($http, $promise, $timeout, environment) {\r\n\r\n\t\tvar service = this;\r\n\r\n\t\tvar statics = {\r\n\t\t\tget: HttpGet,\r\n\t\t\tpost: HttpPost,\r\n\t\t\tput: HttpPut,\r\n\t\t\tpatch: HttpPatch,\r\n\t\t\t'delete': HttpDelete,\r\n\t\t\t'static': HttpStatic,\r\n\t\t\tfake: HttpFake,\r\n\t\t};\r\n\r\n\t\tangular.extend(service, statics);\r\n\r\n\t\t// statics methods\r\n\r\n\t\tfunction HttpPath(path) {\r\n\t\t\treturn environment.paths.api + path;\r\n\t\t}\r\n\r\n\t\tfunction HttpPromise(method, path, data) {\r\n\t\t\treturn $promise(function(promise) {\r\n\t\t\t\t$http[method](path, data).then(function(response) {\r\n\t\t\t\t\tpromise.resolve(response.data);\r\n\r\n\t\t\t\t}, function(e, status) {\r\n\t\t\t\t\tvar error = (e && e.data) ? e.data : {};\r\n\t\t\t\t\terror.status = e.status;\r\n\t\t\t\t\tpromise.reject(error);\r\n\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction HttpGet(path) {\r\n\t\t\treturn HttpPromise('get', HttpPath(path));\r\n\t\t}\r\n\r\n\t\tfunction HttpPost(path, data) {\r\n\t\t\treturn HttpPromise('post', HttpPath(path), data);\r\n\t\t}\r\n\r\n\t\tfunction HttpPut(path, data) {\r\n\t\t\treturn HttpPromise('put', HttpPath(path), data);\r\n\t\t}\r\n\r\n\t\tfunction HttpPatch(path, data) {\r\n\t\t\treturn HttpPromise('patch', HttpPath(path), data);\r\n\t\t}\r\n\r\n\t\tfunction HttpDelete(path) {\r\n\t\t\treturn HttpPromise('delete', HttpPath(path));\r\n\t\t}\r\n\r\n\t\tfunction HttpStatic(path) {\r\n\t\t\treturn HttpPromise('get', path);\r\n\t\t}\r\n\r\n\t\tfunction HttpFake(data, msec) {\r\n\t\t\tmsec = msec || 1000;\r\n\t\t\treturn $promise(function(promise) {\r\n\t\t\t\t$timeout(function() {\r\n\t\t\t\t\tpromise.resolve({\r\n\t\t\t\t\t\tdata: data\r\n\t\t\t\t\t});\r\n\t\t\t\t}, msec);\r\n\t\t\t});\r\n\t\t}\r\n\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Preload', ['$promise', function($promise) {\n\n\t\tfunction Preload(path) {\n\t\t\tvar preload = this;\n\t\t\tpreload.path = path;\n\t\t\tpreload.loaded = 0;\n\t\t\tpreload.total = 0;\n\t\t\tpreload.progress = 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tall: PreloadAll,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tstart: PreloadStart,\n\t\t\timage: PreloadImage,\n\t\t};\n\n\t\tangular.extend(Preload, statics);\n\t\tangular.extend(Preload.prototype, publics);\n\n\t\treturn Preload;\n\n\t\t// statics methods\n\n\t\tfunction PreloadAll(paths, callback) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar preloads = paths.map(function(path) {\n\t\t\t\t\treturn new Preload(path);\n\t\t\t\t});\n\t\t\t\tvar progress = {\n\t\t\t\t\tloaded: 0,\n\t\t\t\t\ttotal: 0,\n\t\t\t\t\tprogress: 0,\n\t\t\t\t\tpreloads: preloads\n\t\t\t\t};\n\t\t\t\tvar i = setInterval(update, 1000 / 10);\n\t\t\t\t$promise.all(\n\t\t\t\t\tpreloads.map(function(preload) {\n\t\t\t\t\t\treturn preload.start();\n\t\t\t\t\t})\n\t\t\t\t).then(function() {\n\t\t\t\t\tclearInterval(i);\n\t\t\t\t\tupdate();\n\t\t\t\t\tpromise.resolve(preloads.slice());\n\t\t\t\t\t// destroy();\n\t\t\t\t}, function(error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t// destroy();\n\t\t\t\t});\n\n\t\t\t\tfunction update() {\n\t\t\t\t\tprogress.loaded = 0;\n\t\t\t\t\tprogress.total = 0;\n\t\t\t\t\tangular.forEach(preloads, function(preload) {\n\t\t\t\t\t\tprogress.loaded += preload.loaded;\n\t\t\t\t\t\tprogress.total += preload.total;\n\t\t\t\t\t});\n\t\t\t\t\tvar percent = progress.total ? progress.loaded / progress.total : 0;\n\t\t\t\t\tif (percent > progress.progress) {\n\t\t\t\t\t\tprogress.progress = percent;\n\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\tcallback(progress);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction destroy() {\n\t\t\t\t\tangular.forEach(preloads, function(preload) {\n\t\t\t\t\t\tpreload.buffer = null;\n\t\t\t\t\t\tpreload.xhr = null;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// instance methods\n\n\t\tfunction PreloadStart() {\n\t\t\tvar preload = this;\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\txhr.open(\"GET\", preload.path, true);\n\t\t\t\txhr.responseType = \"arraybuffer\"; // should be after open for ie11\n\t\t\t\txhr.onloadstart = function(e) {\n\t\t\t\t\t/*\n\t\t\t\t\tpreload.loaded = 0;\n\t\t\t\t\tpreload.total = 1;\n\t\t\t\t\tpreload.progress = 0;\n\t\t\t\t\t*/\n\t\t\t\t};\n\t\t\t\txhr.onprogress = function(e) {\n\t\t\t\t\tpreload.loaded = e.loaded;\n\t\t\t\t\tpreload.total = e.total;\n\t\t\t\t\tpreload.progress = e.total ? e.loaded / e.total : 0;\n\t\t\t\t};\n\t\t\t\txhr.onloadend = function(e) {\n\t\t\t\t\tpreload.loaded = preload.total;\n\t\t\t\t\tpreload.progress = 1;\n\t\t\t\t};\n\t\t\t\txhr.onload = function() {\n\t\t\t\t\tpreload.buffer = xhr.response;\n\t\t\t\t\tpromise.resolve(preload);\n\t\t\t\t};\n\t\t\t\txhr.onerror = function(error) {\n\t\t\t\t\tconsole.log('Preload.xhr.onerror', error);\n\t\t\t\t\tpreload.loaded = preload.total;\n\t\t\t\t\tpreload.progress = 1;\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t};\n\t\t\t\txhr.send();\n\t\t\t\tpreload.xhr = xhr;\n\t\t\t});\n\t\t}\n\n\t\tfunction PreloadImage() {\n\t\t\tvar preload = this;\n\t\t\tvar blob = new Blob([preload.buffer]);\n\t\t\tvar image = new Image();\n\t\t\timage.src = window.URL.createObjectURL(blob);\n\t\t\treturn image;\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('$once', ['$promise', function($promise) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tload: OnceLoad,\n\t\t\tscript: OnceScript,\n\t\t\tlink: OnceLink,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tvar paths = {},\n\t\t\tuid = 0;\n\n\t\tfunction OnceLoad(path, callback) {\n\t\t\tif (path.indexOf('.js')) {\n\t\t\t\treturn OnceScript(path, callback);\n\n\t\t\t} else if (path.indexOf('.css')) {\n\t\t\t\treturn OnceLink(path);\n\n\t\t\t}\n\t\t}\n\n\t\tfunction OnceScript(path, callback) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\ttry {\n\t\t\t\t\tvar id = (paths[path] = paths[path] || ++uid);\n\t\t\t\t\tid = 'OnceScript' + id;\n\t\t\t\t\tif (document.getElementById(id)) {\n\t\t\t\t\t\tpromise.reject();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar scripts = document.getElementsByTagName('script');\n\t\t\t\t\t\tvar script = scripts[scripts.length - 1];\n\t\t\t\t\t\tvar node = document.createElement('script');\n\t\t\t\t\t\tnode.id = id;\n\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\tif (callback === true) {\n\t\t\t\t\t\t\t\tcallback = id;\n\t\t\t\t\t\t\t\tpath = path.split('{{callback}}').join(callback);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\twindow[callback] = function(data) {\n\t\t\t\t\t\t\t\tpromise.resolve(data);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.addEventListener('load', promise.resolve);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode.addEventListener('error', promise.reject);\n\t\t\t\t\t\tnode.src = path;\n\t\t\t\t\t\tscript.parentNode.insertBefore(node, script.nextSibling);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction OnceLink(path) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\ttry {\n\t\t\t\t\tvar id = (paths[path] = paths[path] || ++uid);\n\t\t\t\t\tid = 'OnceStyle' + id;\n\t\t\t\t\tif (document.getElementById(id)) {\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar links = document.getElementsByTagName('link');\n\t\t\t\t\t\tvar link = links[links.length - 1];\n\t\t\t\t\t\tvar node = document.createElement('link');\n\t\t\t\t\t\tnode.id = id;\n\t\t\t\t\t\tnode.rel = 'stylesheet';\n\t\t\t\t\t\tnode.href = path;\n\t\t\t\t\t\tnode.addEventListener('load', promise.resolve);\n\t\t\t\t\t\tnode.addEventListener('error', promise.reject);\n\t\t\t\t\t\tlink.parentNode.insertBefore(node, link.nextSibling);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Router', ['$rootScope', '$location', '$route', '$timeout', function($rootScope, $location, $route, $timeout) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tisController: RouterIsController,\n\t\t\tredirect: RouterRedirect,\n\t\t\tpath: RouterPath,\n\t\t\tapply: RouterApply,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t$rootScope.$on('$routeChangeStart', RouterOnChangeStart);\n\t\t$rootScope.$on('$routeChangeSuccess', RouterOnChangeSuccess);\n\t\t$rootScope.$on('$routeChangeError', RouterOnChangeError);\n\t\t$rootScope.$on('$routeUpdate', RouterOnUpdate);\n\t\t$rootScope.$on('$stateReady', RouterOnStateReady);\n\n\t\tvar $previous, $current, $next;\n\t\tvar $previousController, $currentController, $nextController;\n\n\t\tfunction RouterSetControllers() {\n\t\t\t$previousController = $previous ? $previous.controller : null;\n\t\t\t$currentController = $current ? $current.controller : null;\n\t\t\t$nextController = $next ? $next.controller : null;\n\t\t}\n\n\t\t/*\n\t\t$routeChangeStart\n\t\tBroadcasted before a route change. At this point the route services starts resolving all of the dependencies needed for the route change to occur. Typically this involves fetching the view template as well as any dependencies defined in resolve route property. Once all of the dependencies are resolved $routeChangeSuccess is fired.\n\t\tThe route change (and the $location change that triggered it) can be prevented by calling preventDefault method of the event. See $rootScope.Scope for more details about event object.\n\t\t*/\n\t\tfunction RouterOnChangeStart(event, next, current) {\n\t\t\t$previous = null;\n\t\t\t$current = current ? current.$$route : null;\n\t\t\t$next = next ? next.$$route : null;\n\t\t\tRouterSetControllers();\n\t\t\t// console.log('Router.RouterOnChangeStart', '$previous', $previous, '$current', $current, '$next', $next);\n\t\t\tservice.loading = true;\n\t\t}\n\n\t\t/*\n\t\t$routeChangeSuccess\n\t\tBroadcasted after a route change has happened successfully. The resolve dependencies are now available in the current.locals property.\n\t\t*/\n\t\tfunction RouterOnChangeSuccess(event, current, previous) {\n\t\t\t$previous = previous ? previous.$$route : null;\n\t\t\t$current = current ? current.$$route : null;\n\t\t\t$next = null;\n\t\t\tRouterSetControllers();\n\t\t\t// console.log('Router.RouterOnChangeSuccess', '$previous', $previous, '$current', $current, '$next', $next);\n\t\t}\n\n\t\t/*\n\t\t$routeChangeError\n\t\tBroadcasted if a redirection function fails or any redirection or resolve promises are rejected.\n\t\t*/\n\t\tfunction RouterOnChangeError(event, current, previous, rejection) {\n\t\t\t$previous = null;\n\t\t\t$current = previous.$$route || null;\n\t\t\t$next = null;\n\t\t\tRouterSetControllers();\n\t\t\t// console.log('Router.RouterOnChangeError', '$previous', $previous, '$current', $current, '$next', $next);\n\t\t}\n\n\t\t/*\n\t\t$routeUpdate\n\t\tThe reloadOnSearch property has been set to false, and we are reusing the same instance of the Controller.\n\t\t*/\n\t\tfunction RouterOnUpdate(event, current) {\n\t\t\t$previous = current ? current.$$route : null;\n\t\t\t$current = current ? current.$$route : null;\n\t\t\t$next = null;\n\t\t\tRouterSetControllers();\n\t\t\t// console.log('Router.RouterOnUpdate', '$previous', $previous, '$current', $current, '$next', $next);\n\t\t}\n\n\t\tfunction RouterOnStateReady(scope, state) {\n\t\t\t$timeout(function() {\n\t\t\t\tservice.loading = false;\n\t\t\t}, 1000);\n\t\t}\n\n\t\tfunction RouterIsController(controller) {\n\t\t\treturn $currentController === controller;\n\t\t}\n\n\t\t// navigation\n\n\t\tfunction RouterRedirectTo(path) {\n\t\t\t$location.$$lastRequestedPath = $location.path();\n\t\t\t$location.path(path);\n\t\t}\n\n\t\tfunction RouterRetryLastRequestedPath(path) {\n\t\t\tpath = $location.$$lastRequestedPath || path;\n\t\t\t$location.$$lastRequestedPath = null;\n\t\t\t$location.path(path);\n\t\t}\n\n\t\tfunction RouterRedirect(path, msecs) {\n\t\t\tif (msecs) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tRouterRedirectTo(path);\n\t\t\t\t}, msecs);\n\t\t\t} else {\n\t\t\t\tRouterRedirectTo(path);\n\t\t\t}\n\t\t}\n\n\t\tfunction RouterPath(path, msecs) {\n\t\t\tif (msecs) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tRouterRetryLastRequestedPath(path);\n\t\t\t\t}, msecs);\n\t\t\t} else {\n\t\t\t\tRouterRetryLastRequestedPath(path);\n\t\t\t}\n\t\t}\n\n\t\tfunction RouterApply(path, msecs) {\n\t\t\tif (msecs) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\t$location.path(path);\n\t\t\t\t}, msecs);\n\t\t\t} else {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\t$location.path(path);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Silent', ['$rootScope', '$location', function($rootScope, $location) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tsilent: SilentSilent,\n\t\t\tpath: SilentPath,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t$rootScope.$$listeners.$locationChangeSuccess.unshift(SilentListener);\n\t\t// console.log('$rootScope.$$listeners.$locationChangeSuccess', $rootScope.$$listeners.$locationChangeSuccess);\n\n\t\t// private vars\n\n\t\tvar $path;\n\n\t\t// static methods\n\n\t\tfunction SilentGetDomain() {\n\t\t\tvar currentDomain = window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\n\t\t\treturn currentDomain;\n\t\t}\n\n\t\tfunction SilentUnlink() {\n\t\t\tvar listeners = $rootScope.$$listeners.$locationChangeSuccess;\n\t\t\tangular.forEach(listeners, function(value, name) {\n\t\t\t\tif (value === listener) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction relink() {\n\t\t\t\t\tlisteners[name] = value;\n\t\t\t\t}\n\t\t\t\tlisteners[name] = relink; // temporary unlinking\n\t\t\t});\n\t\t}\n\n\t\tfunction SilentListener(e) {\n\t\t\t// console.log('onLocationChangeSuccess', e);\n\t\t\tif ($path === $location.path()) {\n\t\t\t\tSilentUnlink();\n\t\t\t}\n\t\t\t$path = null;\n\t\t}\n\n\t\tfunction SilentSilent(path, replace) {\n\t\t\t// this.prev = $location.path(); ???\n\t\t\tvar location = $location.url(path);\n\t\t\tif (replace) {\n\t\t\t\tlocation.replace();\n\t\t\t}\n\t\t\t$path = $location.path();\n\t\t}\n\n\t\tfunction SilentPath(path) {\n\t\t\treturn $location.path(path);\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tvar TIMEOUT = 5 * 60 * 1000; // five minutes\n\n\tapp.service('Cookie', ['$promise', function($promise) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\t'delete': CookieDelete,\n\t\t\texist: CookieExists,\n\t\t\tget: CookieGet,\n\t\t\ton: CookieOn,\n\t\t\tset: CookieSet,\n\t\t};\n\n\t\tangular.extend(this, service);\n\n\t\tfunction CookieDelete(name) {\n\t\t\tCookieSetter(name, \"\", -1);\n\t\t}\n\n\t\tfunction CookieExists(name) {\n\t\t\treturn document.cookie.indexOf(';' + name + '=') !== -1 || document.cookie.indexOf(name + '=') === 0;\n\t\t}\n\n\t\tfunction CookieGet(name) {\n\t\t\tvar cookieName = name + \"=\";\n\t\t\tvar ca = document.cookie.split(';');\n\t\t\tfor (var i = 0; i < ca.length; i++) {\n\t\t\t\tvar c = ca[i];\n\t\t\t\twhile (c.charAt(0) == ' ') {\n\t\t\t\t\tc = c.substring(1, c.length);\n\t\t\t\t}\n\t\t\t\tif (c.indexOf(cookieName) === 0) {\n\t\t\t\t\tvar value = c.substring(cookieName.length, c.length);\n\t\t\t\t\tvar model = null;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tmodel = JSON.parse(decodeURIComponent(atob(value)));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log('Cookie.get.error parsing', key, e);\n\t\t\t\t\t}\n\t\t\t\t\treturn model;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction CookieOn(name) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar i, interval = 1000,\n\t\t\t\t\telapsed = 0,\n\t\t\t\t\ttimeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction checkCookie() {\n\t\t\t\t\tif (elapsed > timeout) {\n\t\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar c = CookieGet(name);\n\t\t\t\t\t\tif (c) {\n\t\t\t\t\t\t\tpromise.resolve(c);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telapsed += interval;\n\t\t\t\t\t\t\ti = setTimeout(checkCookie, interval);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcheckCookie();\n\t\t\t});\n\t\t}\n\n\t\tfunction CookieSet(name, value, days) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function(key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\tCookieSetter(name, btoa(encodeURIComponent(json)), days);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('CookieSet.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction CookieSetter(name, value, days) {\n\t\t\tvar expires;\n\t\t\tif (days) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n\t\t\t\texpires = '; expires=' + date.toGMTString();\n\t\t\t} else {\n\t\t\t\texpires = '';\n\t\t\t}\n\t\t\tdocument.cookie = name + '=' + value + expires + '; path=/';\n\t\t}\n\n    }]);\n\n\tapp.service('LocalStorage', ['$promise', 'Cookie', function($promise, Cookie) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\t'delete': LocalDelete,\n\t\t\texist: LocalExists,\n\t\t\tget: LocalGet,\n\t\t\ton: LocalOn,\n\t\t\tset: LocalSet,\n\t\t};\n\n\t\tvar supported = LocalSupported();\n\n\t\tif (supported) {\n\t\t\tangular.extend(this, service);\n\t\t} else {\n\t\t\tangular.extend(this, Cookie);\n\t\t}\n\n\t\tthis.supported = supported;\n\n\t\tfunction LocalSupported() {\n\t\t\tvar supported = false;\n\t\t\ttry {\n\t\t\t\tsupported = 'localStorage' in window && window.localStorage !== null;\n\t\t\t\tif (supported) {\n\t\t\t\t\twindow.localStorage.setItem('test', '1');\n\t\t\t\t\twindow.localStorage.removeItem('test');\n\t\t\t\t} else {\n\t\t\t\t\tsupported = false;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction LocalExists(name) {\n\t\t\treturn window.localStorage[name] !== undefined;\n\t\t}\n\n\t\tfunction LocalGet(name) {\n\t\t\tvar value = null;\n\t\t\tif (window.localStorage[name] !== undefined) {\n\t\t\t\ttry {\n\t\t\t\t\tvalue = JSON.parse(window.localStorage[name]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('LocalStorage.get.error parsing', name, e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction LocalSet(name, value) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function(key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\twindow.localStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorage.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction LocalDelete(name) {\n\t\t\twindow.localStorage.removeItem(name);\n\t\t}\n\n\t\tfunction LocalOn(name) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar i, timeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction storageEvent(e) {\n\t\t\t\t\t// console.log('LocalStorage.on', name, e);\n\t\t\t\t\tif (i) {\n\t\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t}\n\t\t\t\t\tif (e.originalEvent.key == name) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n\t\t\t\t\t\t\tpromise.resolve(value);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log('LocalStorage.on.error parsing', name, error);\n\t\t\t\t\t\t\tpromise.reject('error parsing ' + name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tangular.element(window).on('storage', storageEvent);\n\t\t\t\ti = setTimeout(function() {\n\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t}, timeout);\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.service('SessionStorage', ['$promise', 'Cookie', function($promise, Cookie) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\t'delete': SessionDelete,\n\t\t\texist: SessionExists,\n\t\t\tget: SessionGet,\n\t\t\ton: SessionOn,\n\t\t\tset: SessionSet,\n\t\t};\n\n\t\tvar supported = SessionSupported();\n\n\t\tif (supported) {\n\t\t\tangular.extend(this, service);\n\t\t} else {\n\t\t\tangular.extend(this, Cookie);\n\t\t}\n\n\t\tthis.supported = supported;\n\n\t\tfunction SessionSupported() {\n\t\t\tvar supported = false;\n\t\t\ttry {\n\t\t\t\tsupported = 'sessionStorage' in window && window.sessionStorage !== undefined;\n\t\t\t\tif (supported) {\n\t\t\t\t\twindow.sessionStorage.setItem('test', '1');\n\t\t\t\t\twindow.sessionStorage.removeItem('test');\n\t\t\t\t} else {\n\t\t\t\t\tsupported = false;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction SessionExists(name) {\n\t\t\treturn window.sessionStorage[name] !== undefined;\n\t\t}\n\n\t\tfunction SessionGet(name) {\n\t\t\tvar value = null;\n\t\t\tif (window.sessionStorage[name] !== undefined) {\n\t\t\t\ttry {\n\t\t\t\t\tvalue = JSON.parse(window.sessionStorage[name]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('SessionStorage.get.error parsing', name, e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction SessionSet(name, value) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function(key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\twindow.sessionStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('SessionStorage.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction SessionDelete(name) {\n\t\t\twindow.sessionStorage.removeItem(name);\n\t\t}\n\n\t\tfunction SessionOn(name) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar i, timeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction storageEvent(e) {\n\t\t\t\t\t// console.log('SessionStorage.on', name, e);\n\t\t\t\t\tif (i) {\n\t\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t}\n\t\t\t\t\tif (e.originalEvent.key === name) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n\t\t\t\t\t\t\tpromise.resolve(value);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log('SessionStorage.on.error parsing', name, error);\n\t\t\t\t\t\t\tpromise.reject('error parsing ' + name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tangular.element(window).on('storage', storageEvent);\n\t\t\t\ti = setTimeout(function() {\n\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t}, timeout);\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Trust', ['$sce', function($sce) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\thtml: TrustHtml,\n\t\t\tresource: TrustResource,\n\t\t\turl: TrustUrl,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// private vars\n\n\t\tvar values = [],\n\t\t\ttrustedValues = [];\n\n\t\tfunction TrustGetValue(value) {\n\t\t\tvar index = values.indexOf(value);\n\t\t\tif (index !== -1) {\n\t\t\t\treturn trustedValues[index];\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tfunction TrustSetValue(value, trustedValue) {\n\t\t\tvalues.push(value);\n\t\t\tvalues.push(trustedValue);\n\t\t}\n\n\t\tfunction TrustGetOrSet(value, callback) {\n\t\t\tvar trustedValue = TrustGetValue(value);\n\t\t\tif (!trustedValue) {\n\t\t\t\ttrustedValue = callback();\n\t\t\t\tTrustSetValue(value, trustedValue);\n\t\t\t}\n\t\t\treturn trustedValue;\n\t\t}\n\n\t\tfunction TrustHtml(value) {\n\t\t\treturn TrustGetOrSet(value, function() {\n\t\t\t\treturn $sce.trustAsHtml(value);\n\t\t\t});\n\t\t}\n\n\t\tfunction TrustResource(value) {\n\t\t\treturn TrustGetOrSet(value, function() {\n\t\t\t\treturn $sce.trustAsResourceUrl(value);\n\t\t\t});\n\t\t}\n\n\t\tfunction TrustUrl(value) {\n\t\t\treturn TrustGetOrSet(value, function() {\n\t\t\t\treturn 'url(\\'' + value + '\\')';\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('FacebookService', ['$promise', '$once', 'LocalStorage', 'environment', function($promise, $once, storage, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\trequire: FacebookRequire,\n\t\t\tlogin: FacebookLogin,\n\t\t\tlogout: FacebookLogout,\n\t\t\tstatus: FacebookStatus,\n\t\t\tgetMe: FacebookGetMe,\n\t\t\tgetMyPicture: FacebookGetMyPicture,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// private vars\n\n\t\tif (!environment.plugins.facebook) {\n\t\t\ttrhow('FacebookService.error missing config object in environment.plugins.facebook');\n\t\t}\n\n\t\tvar config = environment.plugins.facebook;\n\n\t\t// statics methods\n\n\t\t/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n\t\t *  calling facebook initializer on page load to avoid popup blockers via asyncronous loading  *\n\t\t * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n\t\tvar authResponse = storage.get('facebook');\n\t\t/*\n\t\tauthResponse = {\n\t\t    accessToken: \"accessTokenXXXXX\",\n\t\t    expiresIn: 4962,\n\t\t    signedRequest: \"signedRequestXXXXX\",\n\t\t    userID: \"10214671620773661\",\n\t\t}\n\t\t*/\n\t\tconsole.log('facebook.storage', authResponse);\n\n\t\tfunction FacebookRequire() {\n\t\t\treturn Facebook();\n\t\t}\n\n\t\tfunction Facebook() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tif (window.FB !== undefined) {\n\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t} else {\n\t\t\t\t\tFacebookOnce().then(function(success) {\n\t\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookOnce() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\t$once.script('//connect.facebook.net/' + environment.language.culture + '/sdk.js', 'fbAsyncInit').then(function() {\n\t\t\t\t\t// console.log('FacebookOnce.fbAsyncInit', window.FB);\n\t\t\t\t\twindow.FB.init({\n\t\t\t\t\t\tappId: config.appId,\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tcookie: true,\n\t\t\t\t\t\txfbml: true,\n\t\t\t\t\t\tversion: config.version,\n\t\t\t\t\t});\n\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t\t// window.fbAsyncInit = null;\n\t\t\t\t}, function(error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookStatus(response, promise, init) {\n\t\t\tservice.authResponse = null;\n\t\t\tif (response.status === 'connected') {\n\t\t\t\tservice.authResponse = response.authResponse;\n\t\t\t\tstorage.set('facebook', response.authResponse);\n\t\t\t\tpromise.resolve(response);\n\t\t\t} else if (response.status === 'not_authorized') {\n\t\t\t\tstorage.delete('facebook');\n\t\t\t\tif (init) {\n\t\t\t\t\tpromise.resolve(response);\n\t\t\t\t} else {\n\t\t\t\t\tpromise.reject(response);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpromise.reject(response);\n\t\t\t}\n\t\t}\n\n\t\tfunction FacebookGetMe(fields) {\n\t\t\tfields = fields || config.fields;\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tFacebookLogin().then(function(response) {\n\t\t\t\t\twindow.FB.api('/me', {\n\t\t\t\t\t\tfields: fields\n\t\t\t\t\t}, function(response) {\n\t\t\t\t\t\tif (!response || response.error) {\n\t\t\t\t\t\t\tvar error = response ? response.error : 'error';\n\t\t\t\t\t\t\tconsole.log('FacebookGetMe.error', error);\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('FacebookGetMe.success', response);\n\t\t\t\t\t\t\tpromise.resolve(response);\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookGetMyPicture(size) {\n\t\t\tsize = size || 300;\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tFacebookLogin().then(function(facebook) {\n\t\t\t\t\twindow.FB.api('/me/picture', {\n\t\t\t\t\t\twidth: size,\n\t\t\t\t\t\theight: size,\n\t\t\t\t\t\ttype: 'square'\n\t\t\t\t\t}, function(response) {\n\t\t\t\t\t\tif (!response || response.error) {\n\t\t\t\t\t\t\tvar error = response ? response.error : 'error';\n\t\t\t\t\t\t\tconsole.log('FacebookGetMyPicture.error', error);\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('FacebookGetMyPicture.success', response);\n\t\t\t\t\t\t\tpromise.resolve(response);\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookLogin() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tFacebook().then(function(facebook) {\n\t\t\t\t\tconsole.log('FacebookLogin', facebook);\n\t\t\t\t\tfacebook.login(function(response) {\n\t\t\t\t\t\tFacebookStatus(response, promise);\n\t\t\t\t\t}, {\n\t\t\t\t\t\tscope: config.scope\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookLogout() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tFacebook().then(function(facebook) {\n\t\t\t\t\tfacebook.logout(function(response) {\n\t\t\t\t\t\tpromise.resolve(response);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t// todo !!!\n\n\tapp.service('GoogleService', ['$timeout', '$promise', '$once', 'LocalStorage', 'environment', function($timeout, $promise, $once, storage, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\trequire: GoogleRequire,\n\t\t\tlogin: GoogleLogin,\n\t\t\tlogout: GoogleLogout,\n\t\t\tgetMe: GoogleGetMe,\n\t\t\t// status: GoogleStatus,\n\t\t\t// getMyPicture: GoogleGetMyPicture,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// private vars\n\n\t\tif (!environment.plugins.google) {\n\t\t\ttrhow('GoogleService.error missing config object in environment.plugins.google');\n\t\t}\n\n\t\tvar config = environment.plugins.google;\n\n\t\tvar auth2 = null;\n\n\t\tvar instance = null;\n\n\t\t// statics methods\n\n\t\t/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n\t\t *  calling google initializer on page load to avoid popup blockers via asyncronous loading  *\n\t\t * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n\t\tvar authResponse = storage.get('google');\n\t\t/*\n\t\tauthResponse = {\n\t\t    access_token: \"accessTokenXXXXX\",\n\t\t    expires_at: 1511992065944,\n\t\t    expires_in: 3600,\n\t\t    first_issued_at: 1511988465944,\n\t\t    id_token: \"idTokenXXXXX\",\n\t\t    idpId: \"google\",\n\t\t    login_hint: \"loginHintXXXXXX\",\n\t\t    scope: \"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/plus.me openid email profile\"\n\t\t    session_state: {\n\t\t        extraQueryParams: {  }\n\t\t    },\n\t\t    token_type: \"Bearer\"\n\t\t}\n\t\t*/\n\t\tconsole.log('google.storage', authResponse);\n\n\t\tfunction GoogleRequire() {\n\t\t\treturn Auth2Init();\n\t\t}\n\n\t\tfunction Google() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tif (window.gapi !== undefined) {\n\t\t\t\t\tpromise.resolve(window.gapi);\n\t\t\t\t} else {\n\t\t\t\t\tGoogleOnce().then(function(response) {\n\t\t\t\t\t\tpromise.resolve(window.gapi);\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleOnce() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\t$once.script('https://apis.google.com/js/api:client.js?onload={{callback}}', true).then(function(data) {\n\t\t\t\t\tpromise.resolve(data);\n\t\t\t\t}, function(error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction Auth2Init() {\n\t\t\treturn $promise(function(promise) {\n\n\t\t\t\tif (auth2) {\n\t\t\t\t\tpromise.resolve(auth2);\n\t\t\t\t} else {\n\t\t\t\t\tGoogle().then(function() {\n\t\t\t\t\t\tfunction onLoaded() {\n\t\t\t\t\t\t\tvar result = window.gapi.auth2.init({\n\t\t\t\t\t\t\t\tclient_id: environment.plugins.google.clientId,\n\t\t\t\t\t\t\t\tcookiepolicy: 'single_host_origin',\n\t\t\t\t\t\t\t\tscope: 'profile email',\n\t\t\t\t\t\t\t\tfetch_basic_profile: true,\n\t\t\t\t\t\t\t\tux_mode: 'popup',\n\n\t\t\t\t\t\t\t}).then(function() {\n\t\t\t\t\t\t\t\tauth2 = window.gapi.auth2;\n\t\t\t\t\t\t\t\tconsole.log('Auth2Init.success', auth2);\n\t\t\t\t\t\t\t\tpromise.resolve(auth2);\n\n\t\t\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\t\t\tconsole.log('Auth2Init.error', error);\n\t\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (window.gapi.auth2) {\n\t\t\t\t\t\t\tonLoaded();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.gapi.load('auth2', function() {\n\t\t\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\t\t\tonLoaded();\n\t\t\t\t\t\t\t\t}, 200);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\tconsole.log('Auth2Init.error', error);\n\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction Auth2Instance() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tif (instance) {\n\t\t\t\t\tpromise.resolve();\n\t\t\t\t} else {\n\t\t\t\t\tAuth2Init().then(function(auth2) {\n\t\t\t\t\t\tinstance = auth2.getAuthInstance();\n\t\t\t\t\t\tconsole.log('GoogleService.Auth2Instance.success', instance);\n\t\t\t\t\t\tpromise.resolve();\n\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\tconsole.log('GoogleService.Auth2Instance.error', error);\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleGetMe() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tGoogleLogin().then(function(response) {\n\t\t\t\t\tvar profile = instance.currentUser.get().getBasicProfile();\n\t\t\t\t\tvar user = {\n\t\t\t\t\t\tid: profile.getId(),\n\t\t\t\t\t\tname: profile.getName(),\n\t\t\t\t\t\tfirstName: profile.getGivenName(),\n\t\t\t\t\t\tlastName: profile.getFamilyName(),\n\t\t\t\t\t\tpicture: profile.getImageUrl(),\n\t\t\t\t\t\temail: profile.getEmail(),\n\t\t\t\t\t};\n\t\t\t\t\tconsole.log('GoogleGetMe.success', user);\n\t\t\t\t\tpromise.resolve(user);\n\n\t\t\t\t}, function(error) {\n\t\t\t\t\tconsole.log('GoogleGetMe.error', error);\n\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleLogin() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tAuth2Instance().then(function() {\n\t\t\t\t\tif (instance.isSignedIn && instance.isSignedIn.get()) {\n\t\t\t\t\t\t// Auth2Instance.isSignedIn.listen(onStatus);\n\t\t\t\t\t\treadAccessToken();\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('GoogleLogin.signIn');\n\t\t\t\t\t\tinstance.signIn({\n\t\t\t\t\t\t\tscope: 'profile email',\n\n\t\t\t\t\t\t}).then(function(signed) {\n\t\t\t\t\t\t\treadAccessToken();\n\n\t\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\t\tconsole.log('GoogleLogin.error', error);\n\t\t\t\t\t\t\tstorage.delete('google');\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction readAccessToken() {\n\t\t\t\t\t\tconsole.log('GoogleLogin.readAccessToken');\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar response = instance.currentUser.get().getAuthResponse(true);\n\t\t\t\t\t\t\tconsole.log('GoogleLogin.readAccessToken.success', response);\n\t\t\t\t\t\t\tstorage.set('google', response);\n\t\t\t\t\t\t\tpromise.resolve({\n\t\t\t\t\t\t\t\tcode: response.access_token,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log('GoogleLogin.readAccessToken.error', error);\n\t\t\t\t\t\t\tstorage.delete('google');\n\t\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction onStatus(signed) {\n\t\t\t\t\t\tconsole.log('GoogleLogin.onStatus', signed);\n\t\t\t\t\t\tif (signed) {\n\t\t\t\t\t\t\treadAccessToken();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, function(error) {\n\t\t\t\t\tconsole.log('GoogleLogin.error', error);\n\t\t\t\t\t// promise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleLogout() {\n\t\t\treturn $promise(function(promise) {\n\n\t\t\t\tAuth2Instance().then(function() {\n\t\t\t\t\tif (instance.isSignedIn && instance.isSignedIn.get()) {\n\t\t\t\t\t\tinstance.signOut().then(function(signed) {\n\t\t\t\t\t\t\tpromise.resolve();\n\n\t\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\t\tconsole.log('GoogleService.signOut.error', error);\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t}\n\n\t\t\t\t}, function(error) {\n\t\t\t\t\tconsole.log('GoogleService.signOut.error', error);\n\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    // todo !!!\n\n    app.directive('googlemaps', ['$timeout', '$compile', '$promise', 'Http', 'GoogleMaps', 'environment', function($timeout, $compile, $promise, Http, GoogleMaps, environment) {\n\n        var directive = {\n            restrict: 'A',\n            scope: {\n                connector: '=googlemaps',\n            },\n            link: GooglemapsLink,\n        };\n\n        if (!environment.plugins.googlemaps) {\n            trhow('googlemaps.error missing config object in environment.plugins.googlemaps');\n        }\n\n        var config = environment.plugins.googlemaps;\n\n        return directive;\n\n        function GooglemapsLink(scope, element, attributes) {\n            console.log('GooglemapsLink', arguments);\n\n            var map, options, info, bounds, clusterer;\n            var filters = {};\n            var markers = [];\n\n            var publics = {\n                // methods available for controllers\n                /*\n                fly: MapboxFly,\n                flyPosition: MapboxFlyPosition,\n                jump: MapboxJump,\n                jumpPosition: MapboxJumpPosition,\n                */\n                setMarkers: GooglemapsMarkersSet,\n                setType: GooglemapsSetType,\n            };\n\n            if (scope.connector) {\n                angular.extend(scope.connector, publics);\n            }\n\n            Googlemaps();\n\n            function Googlemaps() {\n                return $promise(function(promise) {\n                    GoogleMaps.maps().then(function() {\n                        GooglemapsOptions().then(function(options) {\n                            map = new google.maps.Map(element[0], options);\n                            info = GooglemapsInfo();\n                            promise.resolve(map);\n                        });\n                    });\n                });\n            }\n\n            function GooglemapsOptions() {\n                return $promise(function(promise) {\n                    var options = angular.copy(config.options);\n                    if (config.styles) {\n                        Http.get(config.styles).then(function(styles) {\n                            options.styles = styles;\n                            promise.resolve(options);\n\n                        }, function(error) {\n                            console.log('GooglemapsOptions.error', 'unable to load styles', config.styles);\n                            promise.resolve(options);\n\n                        });\n\n                    } else {\n                        promise.resolve(options);\n                    }\n                });\n            }\n\n            function GooglemapsMarkersRemove() {\n                angular.forEach(markers, function(marker) {\n                    marker.setMap(null);\n                });\n            }\n\n            function GooglemapsMarkersSet(items) {\n                Googlemaps().then(function(map) {\n                    GooglemapsMarkersRemove();\n                    bounds = new google.maps.LatLngBounds();\n\n                    markers = items.filter(function(item) {\n                        var has = true;\n                        if (filters.month) {\n                            has = has && filters.month.items.has(item.id);\n                        }\n                        if (filters.category) {\n                            has = has && item.categories.indexOf(filters.category.key) !== -1;\n                        }\n                        return has;\n\n                    }).map(function(item) {\n                        return GooglemapsMarker(item);\n\n                    });\n\n                    if (config.clusterer) {\n                        clusterer = GooglemapsClusterer(markers);\n                    }\n\n                });\n            }\n\n            function GooglemapsBoundsFit() {\n                if (!bounds.isEmpty()) {\n                    map.fitBounds(bounds);\n                }\n            }\n\n            function GooglemapsSetType(typeId) {\n                var types = ['hybrid', 'roadmap', 'satellite', 'terrain'];\n                if (types.indexOf(typeId) !== -1) {\n                    map.setMapTypeId(typeId);\n                }\n            }\n\n            function GooglemapsInfo() {\n\n                var info = new google.maps.InfoWindow({\n                    maxWidth: 350,\n                    pixelOffset: new google.maps.Size(0, 15),\n                });\n\n                google.maps.event.addListener(info, 'domready', function() {\n                    var outer = $('.gm-style-iw');\n                    var background = outer.prev();\n                    background.children(':nth-child(2)').css({\n                        'display': 'none'\n                    });\n                    background.children(':nth-child(4)').css({\n                        'display': 'none'\n                    });\n                    outer.parent().parent().css({\n                        left: '115px'\n                    });\n                    background.children(':nth-child(1)').attr('style', function(i, s) {\n                        return s + 'display: none!important';\n                    });\n                    background.children(':nth-child(3)').attr('style', function(i, s) {\n                        return s + 'display: none!important';\n                    });\n                    background.children(':nth-child(3)').find('div').children().attr('style', function(i, s) {\n                        return s + 'opacity: 0!important;';\n                    });\n                    var close = outer.next();\n                    close.css({\n                        'width': '13px',\n                        'height': '13px',\n                        'overflow': 'hidden',\n                        'position': 'absolute',\n                        'right': '56px',\n                        'top': '17px',\n                        'z-index': '10000',\n                        'cursor': 'pointer',\n                        'opacity': 1,\n                        'transform': 'scale(0.8)'\n                    });\n                    close.mouseout(function() {\n                        $(this).css({\n                            opacity: '1'\n                        });\n                    });\n                });\n\n                return info;\n            }\n\n            function GooglemapsMarker(item) {\n\n                var latLng = new google.maps.LatLng(\n                    item.position.latitude,\n                    item.position.longitude\n                );\n\n                var marker = new google.maps.Marker({\n                    position: latLng,\n                    item: item,\n                    icon: {\n                        url: 'img/maps/marker.png',\n                        scaledSize: new google.maps.Size(25, 25),\n                        origin: new google.maps.Point(0, 0),\n                        anchor: new google.maps.Point(0, 0)\n                    },\n                    map: map,\n                    contentString: '<div id=\"iw-container\">' +\n                        '<div class=\"iw-image\" ng-style=\"{ \\'background-image\\': cssUrl(selectedBlog.image.url) }\"></div>' +\n                        '<div class=\"iw-title\" ng-bind=\"selectedBlog.title\"></div>' +\n                        '<div class=\"iw-cta\"><button type=\"button\" class=\"iw-link\" ng-click=\"openBlog(selectedBlog)\">Details</button></div>' +\n                        '</div>'\n                });\n\n                marker.onClick = function() {\n                    var marker = this;\n                    $timeout(function() {\n                        scope.selectedBlog = marker.item;\n                        var html = $compile(marker.contentString)(scope);\n                        info.setContent(html[0]);\n                        info.open(map, marker);\n                    });\n                };\n\n                marker.addListener('click', marker.onClick);\n\n                bounds.extend(latLng);\n\n                return marker;\n            }\n\n            function GooglemapsClusterer(markers) {\n\n                var clusterer = new MarkerClusterer(map, markers, {\n                    cssClass: 'cluster',\n                    imagePath: '/img/gmap/m'\n                });\n\n                return clusterer;\n\n            }\n\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('GoogleMaps', ['$promise', '$once', 'environment', function($promise, $once, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tmaps: GoogleMaps,\n\t\t\tgeocoder: GoogleMapsGeocoder,\n\t\t\tparse: GoogleMapsParse,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tif (!environment.plugins.googlemaps) {\n\t\t\ttrhow('GoogleMaps.error missing config object in environment.plugins.googlemaps');\n\t\t}\n\n\t\tfunction GoogleMaps() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar apiKey = environment.plugins.googlemaps.apiKey;\n\t\t\t\t$once.script('https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&callback={{callback}}', true).then(function(data) {\n\t\t\t\t\tpromise.resolve(window.google.maps);\n\t\t\t\t}, function(error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleMapsGeocoder() {\n\t\t\tvar service = this;\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tGoogleMaps().then(function(maps) {\n\t\t\t\t\tvar geocoder = new maps.Geocoder();\n\t\t\t\t\tpromise.resolve(geocoder);\n\n\t\t\t\t}, function(error) {\n\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleMapsType(type, item) {\n\t\t\tvar types = {\n\t\t\t\tstreet: 'route',\n\t\t\t\tnumber: 'street_number',\n\t\t\t\tlocality: 'locality',\n\t\t\t\tpostalCode: 'postal_code',\n\t\t\t\tcity: 'administrative_area_level_3',\n\t\t\t\tprovince: 'administrative_area_level_2',\n\t\t\t\tregion: 'administrative_area_level_1',\n\t\t\t\tcountry: 'country',\n\t\t\t};\n\t\t\tvar label = null;\n\t\t\tangular.forEach(item.address_components, function(c) {\n\t\t\t\tangular.forEach(c.types, function(t) {\n\t\t\t\t\tif (t === types[type]) {\n\t\t\t\t\t\tlabel = c.long_name;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t// console.log('GoogleMapsType', type, item, label);\n\t\t\treturn label;\n\t\t}\n\n\t\tfunction GoogleMapsParse(results) {\n\t\t\tvar items = null;\n\t\t\tif (results.length) {\n\t\t\t\titems = results.filter(function(item) {\n\t\t\t\t\treturn true; // item.geometry.location_type === 'ROOFTOP' ||\n\t\t\t\t\t// item.geometry.location_type === 'RANGE_INTERPOLATED' ||\n\t\t\t\t\t// item.geometry.location_type === 'GEOMETRIC_CENTER';\n\t\t\t\t}).map(function(item) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item.formatted_address,\n\t\t\t\t\t\tstreet: GoogleMapsType('street', item),\n\t\t\t\t\t\tnumber: GoogleMapsType('number', item),\n\t\t\t\t\t\tlocality: GoogleMapsType('locality', item),\n\t\t\t\t\t\tpostalCode: GoogleMapsType('postalCode', item),\n\t\t\t\t\t\tcity: GoogleMapsType('city', item),\n\t\t\t\t\t\tprovince: GoogleMapsType('province', item),\n\t\t\t\t\t\tregion: GoogleMapsType('region', item),\n\t\t\t\t\t\tcountry: GoogleMapsType('country', item),\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tlng: item.geometry.location.lng(),\n\t\t\t\t\t\t\tlat: item.geometry.location.lat(),\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\t/*\n\t\t\t\tvar first = response.data.results[0];\n\t\t\t\tscope.model.position = first.geometry.location;\n\t\t\t\tconsole.log(scope.model);\n\t\t\t\tsetLocation();\n\t\t\t\t*/\n\t\t\t}\n\t\t\tconsole.log('GoogleMapsParse', results, items);\n\t\t\treturn items;\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('mapbox', ['$http', '$timeout', '$compile', '$promise', 'MapBox', 'environment', function($http, $timeout, $compile, $promise, MapBox, environment) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\tconnector: '=mapbox',\n\t\t\t},\n\t\t\tlink: MapboxLink,\n\t\t};\n\n\t\tif (!environment.plugins.mapbox) {\n\t\t\ttrhow('mapbox.error missing config object in environment.plugins.mapbox');\n\t\t}\n\n\t\tvar config = environment.plugins.mapbox;\n\n\t\treturn directive;\n\n\t\tfunction MapboxLink(scope, element, attributes, model) {\n\t\t\tvar map, markers, marker, geocoder, bounds, canvas, dragging, overing;\n\n\t\t\tvar publics = {\n\t\t\t\t// methods available for controllers\n\t\t\t\tfly: MapboxFly,\n\t\t\t\tflyPosition: MapboxFlyPosition,\n\t\t\t\tjump: MapboxJump,\n\t\t\t\tjumpPosition: MapboxJumpPosition,\n\t\t\t\tsetMarkers: MapboxMarkersSet,\n\t\t\t\tfitBounds: MapboxBoundsFit,\n\t\t\t};\n\n\t\t\tif (scope.connector) {\n\t\t\t\tangular.extend(scope.connector, publics);\n\t\t\t}\n\n\t\t\tfunction MapboxMap() {\n\t\t\t\treturn $promise(function(promise) {\n\n\t\t\t\t\tMapBox.get().then(function(mapboxgl) {\n\t\t\t\t\t\tmap = new mapboxgl.Map({\n\t\t\t\t\t\t\tcontainer: element[0],\n\t\t\t\t\t\t\tstyle: config.style,\n\t\t\t\t\t\t\tinteractive: true,\n\t\t\t\t\t\t\tlogoPosition: 'bottom-right',\n\t\t\t\t\t\t\t// center: config.options.center,\n\t\t\t\t\t\t\t// zoom: config.options.zoom,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcanvas = map.getCanvasContainer();\n\t\t\t\t\t\t/*\n\t\t\t\t\t\tscope.map.setAddress = function (item) {\n\t\t\t\t\t\t\t// console.log('setAddress', item);\n\t\t\t\t\t\t\tscope.map.results = null;\n\t\t\t\t\t\t\tflyTo(item.position);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.search = function () {\n\t\t\t\t\t\t\t// console.log('address', scope.map.address);\n\t\t\t\t\t\t\tscope.map.results = null;\n\t\t\t\t\t\t\tgeocodeAddress(scope.map.address);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.styles = {\n\t\t\t\t\t\t\tFICO: 1,\n\t\t\t\t\t\t\tSATELLITE: 2,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.style = scope.map.styles.FICO;\n\t\t\t\t\t\tscope.map.styleToggle = function () {\n\t\t\t\t\t\t\tif (scope.map.style === scope.map.styles.FICO) {\n\t\t\t\t\t\t\t\tscope.map.style = scope.map.styles.SATELLITE;\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/satellite-v9');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tscope.map.style = scope.map.styles.FICO;\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/streets-v9');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.setStyle = function (style) {\n\t\t\t\t\t\t\tscope.map.style = style;\n\t\t\t\t\t\t\tif (scope.map.style === scope.map.styles.FICO) {\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/streets-v9');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/satellite-v9');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\t*/\n\t\t\t\t\t\tif (config.options) {\n\t\t\t\t\t\t\tmap.jumpTo(config.options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpromise.resolve(map);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction MapboxFly(options) {\n\t\t\t\tmap.flyTo(options);\n\t\t\t}\n\n\t\t\tfunction MapboxFlyPosition(position) {\n\t\t\t\tvar options = getOptions({\n\t\t\t\t\tcenter: [position.lng, position.lat],\n\t\t\t\t\tzoom: 20,\n\t\t\t\t});\n\t\t\t\tMapboxFly(options);\n\t\t\t}\n\n\t\t\tfunction MapboxJump(options) {\n\t\t\t\tmap.jumpTo(options);\n\t\t\t}\n\n\t\t\tfunction MapboxJumpPosition(position) {\n\t\t\t\tvar options = getOptions({\n\t\t\t\t\tcenter: [position.lng, position.lat],\n\t\t\t\t\tzoom: 20,\n\t\t\t\t});\n\t\t\t\tmap.MapboxJump(options);\n\t\t\t}\n\n\t\t\t/*\n\t\t\tgoogleMaps.geocoder().then(function (response) {\n\t\t\t    geocoder = response;\n\t\t\t    init();\n\t\t\t});\n\t\t\t*/\n\n\t\t\tfunction getOptions(options) {\n\t\t\t\treturn angular.extend(angular.copy(config.options), options);\n\t\t\t}\n\n\t\t\tfunction MapboxMarkersRemove() {\n\t\t\t\tif (markers) {\n\t\t\t\t\tangular.forEach(markers, function(item) {\n\t\t\t\t\t\titem.remove();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction MapboxMarkersSet(items) {\n\t\t\t\tMapboxMap().then(function() {\n\t\t\t\t\tMapboxMarkersRemove();\n\t\t\t\t\tmarkers = [];\n\t\t\t\t\tif (config.clusterer) {\n\t\t\t\t\t\tMapboxClusterer(items);\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (items) {\n\t\t\t\t\t\t\tangular.forEach(items, function(item) {\n\t\t\t\t\t\t\t\tvar marker = MapboxMarkerAdd(item);\n\t\t\t\t\t\t\t\tmarkers.push(marker);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction MapboxMarkerAdd(item) {\n\t\t\t\tvar $scope = scope.$new(true);\n\t\t\t\t$scope.item = item;\n\t\t\t\tvar node = document.createElement('div');\n\t\t\t\tnode.id = 'point';\n\t\t\t\tnode.className = 'marker ' + item.area.code;\n\t\t\t\tnode.className += item.type;\n\t\t\t\tnode.setAttribute('marker', 'item');\n\t\t\t\tvar marker = new mapboxgl.Marker(node, {\n\t\t\t\t\t\toffset: [-10, -10]\n\t\t\t\t\t})\n\t\t\t\t\t.setLngLat([item.position.lng, item.position.lat])\n\t\t\t\t\t.addTo(map);\n\t\t\t\tvar markerElement = angular.element(node);\n\t\t\t\tmarkerElement.on('click', function(e) {\n\t\t\t\t\t// console.log('marker.click', item);\n\t\t\t\t\tscope.$emit('onMarkerClicked', item);\n\t\t\t\t});\n\t\t\t\t$compile(markerElement)($scope); // Compiling marker\n\t\t\t\treturn marker;\n\t\t\t}\n\n\t\t\tfunction MapboxCoordinatesGet(item) {\n\t\t\t\tvar coordinates = null;\n\t\t\t\tif (item.position) {\n\t\t\t\t\tcoordinates = [\n                        item.position.longitude,\n                        item.position.latitude,\n                        item.position.altitude || 0.0,\n                    ];\n\t\t\t\t}\n\t\t\t\t// [0, 1, 2]; longitude, latitude, altitude\n\t\t\t\treturn coordinates;\n\t\t\t}\n\n\t\t\tfunction MapboxFeaturesGet(items) {\n\t\t\t\tvar collection = null;\n\t\t\t\tif (items) {\n\t\t\t\t\tvar features = items.map(function(item) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\t\t\tproperties: angular.extend({}, item),\n\t\t\t\t\t\t\tgeometry: {\n\t\t\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\t\t\tcoordinates: MapboxCoordinatesGet(item),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t\tcollection = {\n\t\t\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\t\t\tcrs: {\n\t\t\t\t\t\t\ttype: 'name',\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tname: 'urn:ogc:def:crs:OGC:1.3:CRS84'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfeatures: features,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn collection;\n\t\t\t}\n\n\t\t\tfunction MapboxClusterer(items) {\n\n\t\t\t\tvar collection = MapboxFeaturesGet(items);\n\n\t\t\t\tmap.on('load', function() {\n\t\t\t\t\t// Add a new source from our GeoJSON data and set the\n\t\t\t\t\t// 'cluster' option to true. GL-JS will add the point_count property to your source data.\n\t\t\t\t\tmap.addSource('earthquakes', {\n\t\t\t\t\t\ttype: 'geojson',\n\t\t\t\t\t\t// Point to GeoJSON data. This example visualizes all M1.0+ earthquakes\n\t\t\t\t\t\t// from 12/22/15 to 1/21/16 as logged by USGS' Earthquake hazards program.\n\t\t\t\t\t\t// data: '/api/mapbox/earthquakes.geo.json',\n\t\t\t\t\t\tdata: collection,\n\t\t\t\t\t\tcluster: true,\n\t\t\t\t\t\tclusterMaxZoom: 14, // Max zoom to cluster points on\n\t\t\t\t\t\tclusterRadius: 50 // Radius of each cluster when clustering points (defaults to 50)\n\t\t\t\t\t});\n\n\t\t\t\t\tmap.addLayer({\n\t\t\t\t\t\tid: 'clusters',\n\t\t\t\t\t\ttype: 'circle',\n\t\t\t\t\t\tsource: 'earthquakes',\n\t\t\t\t\t\tfilter: ['has', 'point_count'],\n\t\t\t\t\t\tpaint: {\n\t\t\t\t\t\t\t'circle-color': {\n\t\t\t\t\t\t\t\tproperty: 'point_count',\n\t\t\t\t\t\t\t\ttype: 'interval',\n\t\t\t\t\t\t\t\tstops: [\n                                    [0, '#51bbd6'],\n                                    [100, '#f1f075'],\n                                    [750, '#f28cb1'],\n                                ]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t'circle-radius': {\n\t\t\t\t\t\t\t\tproperty: 'point_count',\n\t\t\t\t\t\t\t\ttype: 'interval',\n\t\t\t\t\t\t\t\tstops: [\n                                    [0, 20],\n                                    [100, 30],\n                                    [750, 40]\n                                ]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tmap.addLayer({\n\t\t\t\t\t\tid: 'cluster-count',\n\t\t\t\t\t\ttype: 'symbol',\n\t\t\t\t\t\tsource: 'earthquakes',\n\t\t\t\t\t\tfilter: ['has', 'point_count'],\n\t\t\t\t\t\tlayout: {\n\t\t\t\t\t\t\t'text-field': '{point_count_abbreviated}',\n\t\t\t\t\t\t\t'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],\n\t\t\t\t\t\t\t'text-size': 12\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tmap.addLayer({\n\t\t\t\t\t\tid: 'unclustered-point',\n\t\t\t\t\t\ttype: 'circle',\n\t\t\t\t\t\tsource: 'earthquakes',\n\t\t\t\t\t\tfilter: ['!has', 'point_count'],\n\t\t\t\t\t\tpaint: {\n\t\t\t\t\t\t\t'circle-color': '#11b4da',\n\t\t\t\t\t\t\t'circle-radius': 4,\n\t\t\t\t\t\t\t'circle-stroke-width': 1,\n\t\t\t\t\t\t\t'circle-stroke-color': '#fff'\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction MapboxBoundsFit() {\n\t\t\t\tif (bounds) {\n\t\t\t\t\tmap.fitBounds(bounds, {\n\t\t\t\t\t\tspeed: 1.5,\n\t\t\t\t\t\tcurve: 1,\n\t\t\t\t\t\tpadding: 30,\n\t\t\t\t\t\tlinear: false,\n\t\t\t\t\t\tmaxZoom: 8,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction geocodeAddress(address) {\n\t\t\t\tgeocoder.geocode({\n\t\t\t\t\t'address': address\n\t\t\t\t}, function(results, status) {\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tif (status === 'OK') {\n\t\t\t\t\t\t\tconnector.results = googleMaps.parse(results);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\talert('Geocode was not successful for the following reason: ' + status);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction reverseGeocode(position) {\n\t\t\t\t// console.log('reverseGeocode', position);\n\t\t\t\tgeocoder.geocode({\n\t\t\t\t\t'location': position\n\t\t\t\t}, function(results, status) {\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tif (status === 'OK') {\n\t\t\t\t\t\t\tconnector.results = googleMaps.parse(results);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Geocoder failed due to: ' + status);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction geolocalize() {\n\t\t\t\tif (navigator.geolocation) {\n\t\t\t\t\tnavigator.geolocation.getCurrentPosition(function(p) {\n\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\tvar position = {\n\t\t\t\t\t\t\t\tlat: p.coords.latitude,\n\t\t\t\t\t\t\t\tlng: p.coords.longitude\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tflyTo(position);\n\t\t\t\t\t\t\treverseGeocode(position);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, function(e) {\n\t\t\t\t\t\tconsole.log('error', e);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('error', 'Browser doesn\\'t support Geolocation');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/*\n\t\t\tfunction flyTo(position) {\n\t\t\t    map.flyTo({\n\t\t\t        center: [\n\t\t\t            parseFloat(position.lng),\n\t\t\t            parseFloat(position.lat)\n\t\t\t        ],\n\t\t\t        zoom: 15,\n\t\t\t        speed: 1.5,\n\t\t\t        curve: 1,\n\t\t\t    });\n\t\t\t}\n\t\t\t*/\n\n\t\t}\n    }]);\n\n\tapp.directive('marker', ['$http', '$timeout', function($http, $timeout) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\titem: '=marker',\n\t\t\t},\n\t\t\ttemplate: '<div class=\"inner\">' +\n\t\t\t\t'   <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"40\" height=\"40\" viewBox=\"0 0 24 24\">' +\n\t\t\t\t'       <path d=\"M12 0c-5.522 0-10 4.395-10 9.815 0 5.505 4.375 9.268 10 14.185 5.625-4.917 10-8.68 10-14.185 0-5.42-4.478-9.815-10-9.815zm0 18c-4.419 0-8-3.582-8-8s3.581-8 8-8 8 3.582 8 8-3.581 8-8 8z\"/>' +\n\t\t\t\t'   </svg>' +\n\t\t\t\t'   <span ng-bind=\"item.code\"></span>' +\n\t\t\t\t'</div>',\n\t\t\tlink: link,\n\t\t};\n\n\t\tfunction link(scope, element, attributes, model) {\n\t\t\t// console.log('marker', scope.item);\n\t\t}\n\n    }]);\n\n\t/*\n\tapp.service('GoogleMaps', ['$q', '$http', function ($q, $http) {\n\t\tvar _key = 'AIzaSyAYuhIEO-41YT_GdYU6c1N7DyylT_OcMSY';\n\t\tvar _init = false;\n\n\t\tthis.maps = maps;\n\t\tthis.geocoder = geocoder;\n\t\tthis.parse = parse;\n\n\t\tfunction maps() {\n\t\t\tvar deferred = $q.defer();\n\t\t\tif (_init) {\n\t\t\t\tdeferred.resolve(window.google.maps);\n\t\t\t} else {\n\t\t\t\twindow.googleMapsInit = function () {\n\t\t\t\t\tdeferred.resolve(window.google.maps);\n\t\t\t\t\twindow.googleMapsInit = null;\n\t\t\t\t\t_init = true;\n\t\t\t\t};\n\t\t\t\tvar script = document.createElement('script');\n\t\t\t\tscript.setAttribute('async', null);\n\t\t\t\tscript.setAttribute('defer', null);\n\t\t\t\tscript.setAttribute('src', 'https://maps.googleapis.com/maps/api/js?key=' + _key + '&callback=googleMapsInit');\n\t\t\t\tdocument.body.appendChild(script);\n\t\t\t}\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tfunction geocoder() {\n\t\t\tvar service = this;\n\t\t\tvar deferred = $q.defer();\n\t\t\tmaps().then(function (maps) {\n\t\t\t\tvar _geocoder = new maps.Geocoder();\n\t\t\t\tdeferred.resolve(_geocoder);\n\t\t\t}, function (error) {\n\t\t\t\tdeferred.reject(error);\n\t\t\t});\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tfunction getType(type, item) {\n\t\t\tvar types = {\n\t\t\t\tstreet: 'route',\n\t\t\t\tnumber: 'street_number',\n\t\t\t\tlocality: 'locality',\n\t\t\t\tpostalCode: 'postal_code',\n\t\t\t\tcity: 'administrative_area_level_3',\n\t\t\t\tprovince: 'administrative_area_level_2',\n\t\t\t\tregion: 'administrative_area_level_1',\n\t\t\t\tcountry: 'country',\n\t\t\t};\n\t\t\tvar label = null;\n\t\t\tangular.forEach(item.address_components, function (c) {\n\t\t\t\tangular.forEach(c.types, function (t) {\n\t\t\t\t\tif (t === types[type]) {\n\t\t\t\t\t\tlabel = c.long_name;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t// console.log('googleMaps.getType', type, item, label);\n\t\t\treturn label;\n\t\t}\n\n\t\tfunction parse(results) {\n\t\t\tvar items = null;\n\t\t\tif (results.length) {\n\t\t\t\titems = results.filter(function (item) {\n\t\t\t\t\treturn true; // item.geometry.location_type === 'ROOFTOP' ||\n\t\t\t\t\t// item.geometry.location_type === 'RANGE_INTERPOLATED' ||\n\t\t\t\t\t// item.geometry.location_type === 'GEOMETRIC_CENTER';\n\t\t\t\t}).map(function (item) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item.formatted_address,\n\t\t\t\t\t\tstreet: getType('street', item),\n\t\t\t\t\t\tnumber: getType('number', item),\n\t\t\t\t\t\tlocality: getType('locality', item),\n\t\t\t\t\t\tpostalCode: getType('postalCode', item),\n\t\t\t\t\t\tcity: getType('city', item),\n\t\t\t\t\t\tprovince: getType('province', item),\n\t\t\t\t\t\tregion: getType('region', item),\n\t\t\t\t\t\tcountry: getType('country', item),\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tlng: item.geometry.location.lng(),\n\t\t\t\t\t\t\tlat: item.geometry.location.lat(),\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t\tconsole.log('googleMaps.parse', results, items);\n\t\t\treturn items;\n\t\t}\n\n    }]);\n    */\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('MapBox', ['$q', '$http', '$promise', '$once', 'environment', function($q, $http, $promise, $once, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tget: MapBoxGet,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tif (!environment.plugins.mapbox) {\n\t\t\ttrhow('MapBox.error missing config object in environment.plugins.mapbox');\n\t\t}\n\n\t\tvar config = environment.plugins.mapbox;\n\n\t\tfunction MapBoxGet() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tif (window.mapboxgl) {\n\t\t\t\t\tpromise.resolve(window.mapboxgl);\n\t\t\t\t} else {\n\t\t\t\t\t$promise.all([\n                        $once.script('//api.tiles.mapbox.com/mapbox-gl-js/' + config.version + '/mapbox-gl.js'),\n                        $once.link('//api.tiles.mapbox.com/mapbox-gl-js/' + config.version + '/mapbox-gl.css'),\n                    ]).then(function() {\n\t\t\t\t\t\twindow.mapboxgl.accessToken = config.accessToken;\n\t\t\t\t\t\tpromise.resolve(window.mapboxgl);\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n"]}