!function(){"use strict";angular.module("app",["ngSanitize","artisan","jsonFormatter"])}(),function(){"use strict";angular.module("app").service("Api",["Http","Bearer",function(n,e){var t={store:{getById:function(e){return n.get("/store/store.json")}},reserve:{data:function(e){return n.get("/reserve/data.json")},days:function(e,t,o){return n.get("/reserve/days.json",{from:t,to:o})}},navs:{main:function(){return n.get("/navs/main.json")}},docs:{id:function(e){return n.get("/docs/"+e+".json")},path:function(e){return e=e.split("/").join("-"),n.get("/docs/"+e+".json")}},maps:{markers:function(){return n.get("/maps/markers.json")}}};Object.assign(this,t)}])}(),function(){"use strict";angular.module("app").config(["$locationProvider","$routeProvider","$modalProvider",function(e,t,o){t.when("/reserve",{templateUrl:function(){return"views/reserve.html"},controller:"ReserveController",resolve:{store:function(){return null}}}).when("/reserve/:storeId",{templateUrl:function(){return"views/reserve/reserve.html"},controller:"ReserveController",resolve:{store:["$route","Api",function(e,t){return t.store.getById(e.current.params.storeId)}]}}).when("/reserve/:storeId/planner",{templateUrl:function(){return"views/reserve/planner.html"},controller:"PlannerController",resolve:{store:["$route","Api",function(e,t){return t.store.getById(e.current.params.storeId)}],booking:["BookingService",function(e){return e.currentOrGoTo("/")}]}}).when("/reserve/:storeId/confirm",{templateUrl:function(){return"views/reserve/confirm.html"},controller:"ConfirmController",resolve:{store:["$route","Api",function(e,t){return t.store.getById(e.current.params.storeId)}],booking:["BookingService",function(e){return e.currentOrGoTo("/")}]}}).when("/contact-us",{templateUrl:function(){return"views/contact-us.html"},controller:"ContactUsCtrl"}),t.otherwise("/reserve/1"),o.when("categoriesModal",{title:"Categories modal",templateUrl:"views/reserve/modals/categories.html",controller:"CategoriesModal",customClass:""}).when("productsModal",{title:"Products modal",templateUrl:"views/reserve/modals/products.html",controller:"ProductsModal",customClass:""}).when("timesModal",{title:"Times modal",templateUrl:"views/reserve/modals/times.html",controller:"TimesModal",customClass:""})}])}(),function(){"use strict";angular.module("app").run(["$rootScope","$modal","Router","Trust","Bearer",function(e,t,o,n,r){e.modals=t.modals,e.addModal=t.addModal,e.router=o,e.trust=n,e.accessToken=r.get(),console.log("app.run accessToken",e.accessToken)}])}(),function(){"use strict";var e=angular.module("app"),l={store:null,categories:[],products:[],daytimes:[],model:{store:null,category:null,products:null,date:null,daytime:null,time:null}};e.factory("BookingService",["$promise","$location","DateTime","Api","LocalStorage","environment",function(a,n,i,r,s,e){function c(e){Object.assign(this,l),e&&(Object.assign(this,e),this.model.store=e.store,this.model.category=e.categories[0],this.model.category.active=!0,this.emptyDaytimes=this.getEmptyDaytimes())}var t={new:function(){return a(function(o){r.reserve.data().then(function(e){var t=new c(e);c.booking=t,o.resolve(t)},function(e){o.reject(e)})})},current:function(){return a(function(o){if(c.booking)o.resolve(c.booking);else if(s.exist("reserve")){var n=s.get("reserve");r.reserve.data().then(function(e){var t=new c(e);t.model=n,console.log("getting",n),c.booking=t,o.resolve(t)},function(e){o.reject(e)})}else o.resolve(null)})},currentOrGoTo:function(o){return a(function(t){c.current().then(function(e){e?t.resolve(e):(n.$$lastRequestedPath=n.path(),n.path(o))},function(e){t.reject(e)})})},update:function(t){return a(function(e){t?(console.log("setting",t),s.set("reserve",t),e.resolve(t)):e.reject(error)})}},o={getProductsByCategory:function(t){return this.products.filter(function(e){return e.category===t.id}).sort(function(e,t){var o=e.name.toUpperCase(),n=t.name.toUpperCase();return o<n?-1:n<o?1:0})},getTimesByDaytime:function(t){return this.model.daytime=t,this.times.filter(function(e){return e.daytime===t.id}).map(function(e,t){var o=Object.assign({},e);return o.active=0===t,o})},getDaysByRange:function(e,o){var n=this;return a(function(t){r.reserve.days(n.model.store.id,e,o).then(function(e){t.resolve(e)},function(e){t.reject(e)})})},getDaysPoolByRange:function(n,e){var r=this;return a(function(t){r.getDaysByRange(r.model.store.id,n,e).then(function(e){e.forEach(function(e,t){var o=new Date(n);o.setDate(o.getDate()+t),e.date=o});var o={};e.forEach(function(e){e.date=new Date(e.date);var t=i.dateToKey(e.date);e.daytimes={},r.daytimes.forEach(function(t){e.daytimes[t.id]={times:e.times.filter(function(e){return e.daytime===t.id})}}),o[t]=e}),t.resolve(o)},function(e){t.reject(e)})})},getEmptyDaytimes:function(){var t={};return this.daytimes.forEach(function(e){t[e.id]={times:[]}}),t},getProductNames:function(){return this.model.products?this.model.products.map(function(e){return e.name}).join(", "):null}};return Object.assign(c,t),Object.assign(c.prototype,o),c}])}(),function(){"use strict";angular.module("app").controller("CategoriesModal",["$scope","State","View","Range",function(e,t,o,n){var r=new t,a=e.modal,i=e.params?e.params:[],s={state:r,items:i,onSelect:function(e){i.forEach(function(e){e.active=!1}),e.active=!0},onSubmit:function(){console.log("CategoriesModal.onSubmit"),a.resolve(i.find(function(e){return e.active}))}};Object.assign(e,s),r.ready()}])}(),function(){"use strict";angular.module("app").controller("ConfirmController",["$scope","$location","State","BookingService","View","Range","store","booking",function(t,o,e,n,r,a,i,s){var c=new e,l={state:c,store:i,booking:s,onSelectCategory:function(){console.log("ReserveController.onSelectCategory"),t.$root.addModal("categoriesModal",s.categories).then(function(e){console.log("categoriesModal.resolve",e),s.model.category=e,s.model.products=null},function(e){console.log("categoriesModal.reject",e)})},onSelectProduct:function(){console.log("ReserveController.onSelectProduct");var e=s.getProductsByCategory(s.model.category);t.$root.addModal("productsModal",e).then(function(e){console.log("productsModal.resolve",e),s.model.products=e},function(e){console.log("productsModal.reject",e)})},onSubmit:function(){console.log("ConfirmController.onSubmit",s.model.user.name),c.busy()&&n.update(s.model).then(function(e){o.path("/reserve/"+i.id+"/planner"),c.success()})}};Object.assign(t,l),c.ready()}])}(),function(){"use strict";angular.module("app").controller("PlannerController",["$scope","$location","State","BookingService","View","Range","store","booking",function(r,t,e,o,n,a,i,s){var c=new e,l={onWeekDidChange:function(e,t,n){s.model.date=null,s.model.daytime=null,s.model.time=null,s.getDaysPoolByRange(t.from,t.to).then(function(o){n.days.each(function(e){var t=o[e.key];t?(e.times=t.times,e.daytimes=t.daytimes,e.closingDay=t.closingDay):(e.times=[],e.daytimes=s.emptyDaytimes)})})},onDayDidSelect:function(t,o,e,n){r.$root.addModal("timesModal",{day:t,daytime:o,times:o.times}).then(function(e){n.days.each(function(t){Object.keys(t.daytimes).forEach(function(e){t.daytimes[e].active=!1,t.daytimes[e].times.forEach(function(e){e.active=!1})})}),e.active=!0,o.active=!0,o.time=e,s.model.date=t.date,s.model.daytime=o,s.model.time=e},function(e){console.log("timesModal.reject",e)})},onWeekDidSelect:function(e,t,o){console.log("onWeekDidSelect.week",e)}},u={state:c,store:i,booking:s,plannerOptions:l,onBack:function(){t.path("/reserve/"+i.id)},onSubmit:function(){console.log("PlannerController.onSubmit",s.model.time.name),c.busy()&&o.update(s.model).then(function(e){t.path("/reserve/"+i.id+"/confirm"),c.success()})}};Object.assign(r,u),c.ready()}])}(),function(){"use strict";var e=angular.module("artisan");e.directive("planner",["$templateCache","$parse","$q","$timeout","$filter","Hash","DateTime","Range","PlannerFactory","State","Api",function(n,e,t,o,r,a,i,f,g,s,c){return{priority:1002,restrict:"A",templateUrl:function(e,t){var o=t.template;o||(o="partials/planner",n.get(o)||n.put(o,'<div><json-formatter json="options"></json-formatter></div>'));return o},scope:{options:"=planner",daytimes:"=daytimes"},link:function(e,t,o,n,r){var a=new g,i=e.options||{onWeekDidChange:function(){},onWeekDidSelect:function(){},onDayDidSelect:function(){}},s=f.Month(),c=f.Week(),l=f.Day(),u={month:s,week:c,day:l,view:null},d={sources:u,doNavWeek:function(e){m(c.getDate(e))},onWeekSelect:function(e){if(!e)return;i.onWeekDidSelect(e,s,u.view)},onDaySelect:function(e,t){if(!e)return;!0===i.onDayDidSelect(e,t,s,u.view)&&(u.day.setDate(e.date),u.view.days.each(function(e){e.selected=u.day.isCurrent(e.date)}))},getDayClasses:function(e){var t={day:e};e&&angular.extend(t,{today:e.$today,selected:e.selected,workable:e.workable,holiday:e.holiday,vacation:e.vacation,working:e.working,available:e.available,full:e.full,"status-green":e.green,"status-orange":e.orange});return t},hasWeeksBefore:function(){return!c.isCurrent(l.date)}};function m(e){var t,o;e&&!c.isOutside(e)||(e&&c.setDate(e),t=e,(o=a.getWeekByDate(c.getDate())).days.each(function(e){var t=e.date.getDay();e.dirty=!0,e.selected=u.day.isCurrent(e.date),e.past=e.key<f.today.key,e.weekend=0===t||6===t,e.working=!e.weekend,e.holiday=!1,e.vacation=!1,e.wasVacation=!1,e.wasWorkable=!1,e.workable=!1}),u.view=o,i.onWeekDidChange(t,c,o))}angular.extend(e,d),m()}}}]),e.filter("capitalize",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}})}(),function(){"use strict";angular.module("app").factory("PlannerFactory",["$filter","DateTime","Hash",function(f,g,p){function e(){this.days=new p("key"),this.weeks=new p("wKey")}var t={clearMonth:function(e){e.days.each(function(e){e&&(e.hours=0,e.tasks=new p("id"))})},getDate:n,getDay:function(e){var t=new Date(g.today.date);return t.setDate(t.getDate()+e),t},getKey:function(e){return g.dateToKey(e)}},o={getWeeks:function(e){var t=this;t.days.removeAll(),t.weeks.removeAll(),t.months.removeAll();var o=0;for(;o<e;){var n=new Date;n.setFullYear(g.today.date.getFullYear()),n.setMonth(g.today.date.getMonth()+o),n.setDate(1),n.setHours(0),n.setMinutes(0),n.setSeconds(0);t.getWeekByDate(n);o++}return t.weeks},getWeek:function(e){var t=n(e);return this.getWeekByDate(t)},getWeekByDate:function(e){e=e||new Date;var a=this,t=e.getFullYear(),o=e.getMonth(),n=e.getDay(),r=e.getDate()-n+(0===n?-6:1),i=new Date(e.setDate(r)),s=f("isoWeek")(e,1),c=g.dateToKey(i),l=60*t+s,u=12*t+o,d=a.weeks.get(l);if(!d){var m=new p("key");new Array(7).fill().map(function(e,t){var o=new Date(i);o.setDate(i.getDate()+t);var n=g.dateToKey(o),r={$today:n===g.today.key,c:t,d:o.getDate(),date:o,key:n};return a.days.add(r),m.add(r),r}),d={isoWeek:s,key:c,wKey:l,mKey:u,date:i,days:m},d=a.weeks.add(d)}return d}};return angular.extend(e,t),angular.extend(e.prototype,o),e;function n(e){return"function"==typeof e.date.getMonth?e.date:new Date(e.date)}}])}(),function(){"use strict";angular.module("app").controller("ProductsModal",["$scope","State","View","Range",function(e,t,o,n){var r=new t,a=e.modal,i=e.params?e.params:[],s={state:r,items:i,onSubmit:function(){console.log("ProductsModal.onSubmit"),a.resolve(i.filter(function(e){return e.active}))}};Object.assign(e,s),r.ready()}])}(),function(){"use strict";angular.module("app").controller("ReserveController",["$scope","$location","State","BookingService","View","Range","store",function(t,o,e,n,r,a,i){var s=new e,c=null,l={state:s,store:i,booking:c,onSelectCategory:function(){console.log("ReserveController.onSelectCategory"),t.$root.addModal("categoriesModal",c.categories).then(function(e){console.log("categoriesModal.resolve",e),c.model.category=e,c.model.products=null},function(e){console.log("categoriesModal.reject",e)})},onSelectProduct:function(){console.log("ReserveController.onSelectProduct");var e=c.getProductsByCategory(c.model.category);t.$root.addModal("productsModal",e).then(function(e){console.log("productsModal.resolve",e),c.model.products=e},function(e){console.log("productsModal.reject",e)})},onSubmit:function(){console.log("ReserveController.onSubmit",c.model.products.map(function(e){return e.name}).join(", ")),s.busy()&&n.update(c.model).then(function(e){o.path("/reserve/"+i.id+"/planner"),s.success()})}};Object.assign(t,l),n.new().then(function(e){c=e,t.booking=c,s.ready()},function(e){s.error(e)})}])}(),function(){"use strict";angular.module("app").controller("TimesModal",["$scope","State","View","Range",function(e,t,o,n){var r=new t,a=e.modal,i=(e.params?e.params:{}).times||[],s={state:r,items:i,onSelect:function(e){i.forEach(function(e){e.active=!1}),e.active=!0},onSubmit:function(){console.log("TimeModal.onSubmit"),a.resolve(i.find(function(e){return e.active}))}};Object.assign(e,s),r.ready()}])}(),function(){"use strict";angular.module("app").controller("ContactUsCtrl",["$scope","State","View","Api",function(t,e,o,n){var r=new e,a=new e,i={},s={},c={state:r,state2:a,googlemaps:i,mapbox:s};Object.assign(t,c),o.current().then(function(e){t.view=e,r.ready()},function(e){r.error(e)}),n.maps.markers().then(function(e){i.setMarkers(e),s.setMarkers(e)})}])}(),function(){"use strict";angular.module("app").controller("RootCtrl",["$scope","$timeout","$promise","Nav","Api","Range","Scrollable","AuthService",function(e,t,o,n,r,a,i,s){var c=new n({onPath:function(e){return e.path},onNav:function(e){return n.path(e.$nav.path),!1}});r.navs.main().then(function(e){c.setItems(e)},function(e){console.log("RootCtrl.error",e)}),e.nav=c;var l=new i;e.scrollable=l}])}(),function(){"use strict";angular.module("app").config(["environmentProvider",function(e){e.add("environment",{http:{interceptors:[],withCredentials:!1},language:{code:"it",culture:"it_IT",iso:"ITA",name:"Italiano"},location:{hash:"!",html5:!1},plugins:{facebook:{appId:340008479796111,fields:"id,name,first_name,last_name,email,gender,picture,cover,link",scope:"public_profile, email",version:"v2.10"},google:{apiKey:"AIzaSyCn6O-j_8pipy-ErGxg4bM1juGesiyM28U",clientId:"1063539520533-7308vqmt92em6dv1v5q52fq2or36jk95.apps.googleusercontent.com"},googlemaps:{apiKey:"AIzaSyCn6O-j_8pipy-ErGxg4bM1juGesiyM28U",styles:"/googlemaps/applemapesque.json",options:{center:{lat:43.9023386,lng:12.8505094},zoom:4}},mapbox:{accessToken:"pk.eyJ1IjoiYWN0YXJpYW4iLCJhIjoiY2lqNWU3MnBzMDAyZndnbTM1cjMyd2N2MiJ9.CbuEGSvOAfIYggQv854pRQ",options:{center:[12.8505094,43.9023386],zoom:4},style:"mapbox://styles/actarian/cja82nadj07sn2rmty6n1n5pk",version:"v0.42.0"}}})}])}(),function(){"use strict";angular.module("app").config(["environmentProvider",function(e){e.add("local",{paths:{api:"http://localhost:6001/api",app:"http://localhost:6001"},plugins:{facebook:{appId:340008479796111}}})}])}(),function(){"use strict";angular.module("app").config(["environmentProvider",function(e){e.add("production",{paths:{api:"https://actarian.github.io/scavolini-reserve/api",app:"https://actarian.github.io/scavolini-reserve"},plugins:{facebook:{appId:0x8e099954c588}}})}])}(),function(){"use strict";angular.module("app").config(["environmentProvider",function(e){e.add("stage",{})}])}();
//# sourceMappingURL=app.min.js.map
