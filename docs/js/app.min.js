!function(){"use strict";angular.module("app",["ngSanitize","artisan","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$locationProvider","$routeProvider",function(e,t){t.when("/reserve",{templateUrl:function(){return"views/reserve/reserve.html"},controller:"ReserveController",resolve:{store:function(){return null}}}).when("/reserve/:storeId",{templateUrl:function(){return"views/reserve/reserve.html"},controller:"ReserveController",resolve:{store:["$route","Api",function(e,t){return t.store.getById(e.current.params.storeId)}]}}).when("/reserve/:storeId/planner",{templateUrl:function(){return"views/reserve/planner.html"},controller:"PlannerController",resolve:{store:["$route","Api",function(e,t){return t.store.getById(e.current.params.storeId)}],booking:["BookingService",function(e){return e.currentOrGoTo("/")}]}}).when("/reserve/:storeId/confirm",{templateUrl:function(){return"views/reserve/confirm.html"},controller:"ConfirmController",resolve:{store:["$route","Api",function(e,t){return t.store.getById(e.current.params.storeId)}],booking:["BookingService",function(e){return e.currentOrGoTo("/")}]}}).when("/reserve/:storeId/confirmed",{templateUrl:function(){return"views/reserve/confirmed.html"},controller:"ConfirmedController",resolve:{store:["$route","Api",function(e,t){return t.store.getById(e.current.params.storeId)}],booking:["BookingService",function(e){return e.currentOrGoTo("/")}]}}).when("/reserve/:storeId/canceled",{templateUrl:function(){return"views/reserve/canceled.html"},controller:"CanceledController",resolve:{store:["$route","Api",function(e,t){return t.store.getById(e.current.params.storeId)}],booking:["BookingService",function(e){return e.currentOrGoTo("/")}]}}).when("/store/reserve-options",{templateUrl:function(){return"views/store/reserve-options.html"},controller:"ReserveOptionsController",resolve:{store:["StoreService",function(e){return e.currentOrGoTo("/")}]}}).when("/store/extra-closures",{templateUrl:function(){return"views/store/extra-closures.html"},controller:"ExtraClosuresController",resolve:{store:["StoreService",function(e){return e.currentOrGoTo("/")}]}}),t.otherwise("/reserve/1")}])}(),function(){"use strict";angular.module("app").config(["$modalProvider",function(e){e.when("categoriesModal",{title:"Categories modal",templateUrl:"views/reserve/modals/categories.html",controller:"CategoriesModal",customClass:""}).when("productsModal",{title:"Products modal",templateUrl:"views/reserve/modals/products.html",controller:"ProductsModal",customClass:""}).when("timesModal",{title:"Times modal",templateUrl:"views/reserve/modals/times.html",controller:"TimesModal",customClass:""}).when("editModal",{title:"Edit modal",templateUrl:"views/reserve/modals/edit.html",controller:"EditModal",customClass:""}).when("cancelModal",{title:"Cancel modal",templateUrl:"views/reserve/modals/cancel.html",controller:"CancelModal",customClass:""}).when("noticeModal",{title:"Notice modal",templateUrl:"views/store/modals/notice.html",controller:"NoticeModal",customClass:""}).when("anticipationModal",{title:"Anticipation modal",templateUrl:"views/store/modals/anticipation.html",controller:"AnticipationModal",customClass:""})}])}(),function(){"use strict";angular.module("app").service("Api",["Http",function(n){var e={store:{data:function(e){return n.get("/store/store.data.json")},getById:function(e){return n.get("/store/store.json")},getDetailById:function(e){return n.get("/store/store.detail.json")}},reserve:{data:function(e){return n.get("/reserve/reserve.data.json")},days:function(e,t,o){return n.get("/reserve/days.json",{from:t,to:o})}}};Object.assign(this,e)}])}(),function(){"use strict";angular.module("app").run(["$rootScope","$modal","Router","Trust",function(e,t,o,n){e.modals=t.modals,e.addModal=t.addModal,e.router=o,e.trust=n}])}(),function(){"use strict";angular.module("app").controller("RootCtrl",["$scope","$timeout","$promise",function(e,t,o){e.store={name:"Scavolini Store Urbino"}}])}(),function(){"use strict";var e=angular.module("app"),l={store:null,categories:[],products:[],daytimes:[],model:{store:null,category:null,products:null,date:null,daytime:null,time:null}};e.factory("BookingService",["$promise","$location","DateTime","Api","SessionStorage","environment",function(i,n,a,r,s,e){function c(e){Object.assign(this,l),e&&(Object.assign(this,e),this.model.store=e.store,this.model.category=e.categories[0],this.model.category.active=!0,this.emptyDaytimes=this.getEmptyDaytimes())}var t={new:function(){return i(function(o){r.reserve.data().then(function(e){var t=new c(e);c.booking=t,o.resolve(t)},function(e){o.reject(e)})})},current:function(){return i(function(o){if(c.booking)o.resolve(c.booking);else if(s.exist("reserve")){var n=s.get("reserve");r.reserve.data().then(function(e){var t=new c(e);t.model=n,console.log("getting",n),c.booking=t,o.resolve(t)},function(e){o.reject(e)})}else o.resolve(null)})},currentOrGoTo:function(o){return i(function(t){c.current().then(function(e){e?t.resolve(e):(n.$$lastRequestedPath=n.path(),n.path(o))},function(e){t.reject(e)})})},update:function(t){return i(function(e){t?(console.log("setting",t),s.set("reserve",t),e.resolve(t)):e.reject(error)})}},o={getProductsByCategory:function(t){return this.products.filter(function(e){return e.category===t.id}).sort(function(e,t){var o=e.name.toUpperCase(),n=t.name.toUpperCase();return o<n?-1:n<o?1:0})},getTimesByDaytime:function(t){return this.model.daytime=t,this.times.filter(function(e){return e.daytime===t.id}).map(function(e,t){var o=Object.assign({},e);return o.active=0===t,o})},getDaysByRange:function(e,o){var n=this;return i(function(t){r.reserve.days(n.model.store.id,e,o).then(function(e){t.resolve(e)},function(e){t.reject(e)})})},getDaysPoolByRange:function(n,e){var r=this;return i(function(t){r.getDaysByRange(r.model.store.id,n,e).then(function(e){e.forEach(function(e,t){var o=new Date(n);o.setDate(o.getDate()+t),e.date=o});var o={};e.forEach(function(e){e.date=new Date(e.date);var t=a.dateToKey(e.date);e.daytimes={},r.daytimes.forEach(function(t){e.daytimes[t.id]={times:e.times.filter(function(e){return e.daytime===t.id})}}),o[t]=e}),t.resolve(o)},function(e){t.reject(e)})})},getEmptyDaytimes:function(){var t={};return this.daytimes.forEach(function(e){t[e.id]={times:[]}}),t},getProductNames:function(){return this.model.products?this.model.products.map(function(e){return e.name}).join(", "):null}};return Object.assign(c,t),Object.assign(c.prototype,o),c}])}(),function(){"use strict";angular.module("app").controller("CancelModal",["$scope","State",function(e,t){var o=new t,n=e.modal,r={state:o,onSubmit:function(){o.busy()&&setTimeout(function(){o.success(),n.resolve()},500)},onCancel:function(){n.reject()}};Object.assign(e,r),o.ready()}])}(),function(){"use strict";angular.module("app").controller("CanceledController",["$scope","$location","State","BookingService","View","Range","store","booking",function(e,t,o,n,r,i,a,s){var c=new o,l={state:c,store:a,booking:s,onStoreChange:function(){console.log("CanceledController.onStoreChange")},onStoreReserve:function(){console.log("CanceledController.onStoreReserve"),t.path("/reserve/"+a.id)}};Object.assign(e,l),c.ready()}])}(),function(){"use strict";angular.module("app").controller("CategoriesModal",["$scope","State","View","Range",function(e,t,o,n){var r=new t,i=e.modal,a=e.params?e.params:[],s={state:r,items:a,onSelect:function(e){a.forEach(function(e){e.active=!1}),e.active=!0},onSubmit:function(){console.log("CategoriesModal.onSubmit"),i.resolve(a.find(function(e){return e.active}))}};Object.assign(e,s),r.ready()}])}(),function(){"use strict";angular.module("app").controller("ConfirmController",["$scope","$location","$timeout","State","BookingService","View","Range","store","booking",function(e,t,o,n,r,i,a,s,c){var l=new n,u={state:l,store:s,booking:c,onBack:function(){t.path("/reserve/"+s.id+"/planner")},onSubmit:function(){console.log("ConfirmController.onSubmit",c.model.user.name),l.busy()&&r.update(c.model).then(function(e){t.path("/reserve/"+s.id+"/confirmed"),l.success(),o(function(){l.ready()},600)})}};Object.assign(e,u),l.ready()}])}(),function(){"use strict";angular.module("app").controller("ConfirmedController",["$scope","$location","State","BookingService","View","Range","store","booking",function(e,t,o,n,r,i,a,s){var c=new o,l={state:c,store:a,booking:s,onCancelReservation:function(){console.log("ConfirmedController.onCancelReservation"),e.$root.addModal("cancelModal").then(function(){t.path("/reserve/"+a.id+"/canceled")},function(e){console.log("cancelModal.reject",e)})},onEditUserData:function(){console.log("ConfirmedController.onEditUserData"),e.$root.addModal("editModal",s.model).then(function(e){n.update(e).then(function(e){s.model=e})},function(e){console.log("editModal.reject",e)})},onBack:function(){t.path("/reserve/"+a.id+"/confirm")}};Object.assign(e,l),c.ready()}])}(),function(){"use strict";angular.module("app").controller("EditModal",["$scope","State",function(e,t){var o=new t,n=e.modal,r=e.params?e.params:{},i={state:o,model:r,onSubmit:function(){console.log("EditModal.onSubmit"),o.busy()&&setTimeout(function(){o.success(),n.resolve(r)},500)},onCancel:function(){console.log("EditModal.onCancel"),n.reject()}};Object.assign(e,i),o.ready()}])}(),function(){"use strict";var e=angular.module("artisan");e.directive("planner",["$templateCache","$parse","$q","$timeout","$filter","Hash","DateTime","Range","PlannerFactory","State","Api",function(n,e,t,o,r,i,a,m,p,s,c){return{priority:1002,restrict:"A",templateUrl:function(e,t){var o=t.template;o||(o="partials/planner",n.get(o)||n.put(o,'<div><json-formatter json="options"></json-formatter></div>'));return o},scope:{options:"=planner",daytimes:"=daytimes"},link:function(e,t,o,n,r){var i=new p,a=e.options||{onWeekDidChange:function(){},onWeekDidSelect:function(){},onDayDidSelect:function(){}},s=m.Month(),c=m.Week(),l=m.Day(),u={month:s,week:c,day:l,view:null},d={sources:u,doNavWeek:function(e){f(c.getDate(e))},onWeekSelect:function(e){if(!e)return;a.onWeekDidSelect(e,s,u.view)},onDaySelect:function(e,t){if(!e)return;!0===a.onDayDidSelect(e,t,s,u.view)&&(u.day.setDate(e.date),u.view.days.each(function(e){e.selected=u.day.isCurrent(e.date)}))},getDayClasses:function(e){var t={day:e};e&&angular.extend(t,{today:e.$today,selected:e.selected,workable:e.workable,holiday:e.holiday,vacation:e.vacation,working:e.working,available:e.available,full:e.full,"status-green":e.green,"status-orange":e.orange});return t},hasWeeksBefore:function(){return!c.isCurrent(l.date)}};function f(e){var t,o;e&&!c.isOutside(e)||(e&&c.setDate(e),t=e,(o=i.getWeekByDate(c.getDate())).days.each(function(e){var t=e.date.getDay();e.dirty=!0,e.selected=u.day.isCurrent(e.date),e.past=e.key<m.today.key,e.weekend=0===t||6===t,e.working=!e.weekend,e.holiday=!1,e.vacation=!1,e.wasVacation=!1,e.wasWorkable=!1,e.workable=!1}),u.view=o,a.onWeekDidChange(t,c,o))}angular.extend(e,d),f()}}}]),e.filter("capitalize",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}})}(),function(){"use strict";angular.module("app").controller("ProductsModal",["$scope","State",function(e,t){var o=new t,n=e.modal,r=e.params?e.params:[],i={state:o,items:r,onSubmit:function(){console.log("ProductsModal.onSubmit"),n.resolve(r.filter(function(e){return e.active}))}};Object.assign(e,i),o.ready()}])}(),function(){"use strict";angular.module("app").controller("ReserveController",["$scope","$location","$timeout","State","BookingService","View","Range","store",function(t,o,n,e,r,i,a,s){var c=new e,l=null,u={state:c,store:s,booking:l,onSelectCategory:function(){console.log("ReserveController.onSelectCategory"),t.$root.addModal("categoriesModal",l.categories).then(function(e){console.log("categoriesModal.resolve",e),l.model.category=e,l.model.products=null},function(e){console.log("categoriesModal.reject",e)})},onSelectProduct:function(){console.log("ReserveController.onSelectProduct");var e=l.getProductsByCategory(l.model.category);t.$root.addModal("productsModal",e).then(function(e){console.log("productsModal.resolve",e),l.model.products=e},function(e){console.log("productsModal.reject",e)})},onSubmit:function(){console.log("ReserveController.onSubmit",l.model.products.map(function(e){return e.name}).join(", ")),c.busy()&&r.update(l.model).then(function(e){o.path("/reserve/"+s.id+"/planner"),c.success(),n(function(){c.ready()},600)})}};Object.assign(t,u),r.new().then(function(e){l=e,t.booking=l,c.ready()},function(e){c.error(e)})}])}(),function(){"use strict";angular.module("app").controller("TimesModal",["$scope","State",function(e,t){var o=new t,n=e.modal,r=(e.params?e.params:{}).times||[],i={state:o,items:r,onSelect:function(e){r.forEach(function(e){e.active=!1}),e.active=!0},onSubmit:function(){console.log("TimeModal.onSubmit"),n.resolve(r.find(function(e){return e.active}))}};Object.assign(e,i),o.ready()}])}(),function(){"use strict";angular.module("app").controller("PlannerController",["$scope","$location","$timeout","State","BookingService","View","Range","store","booking",function(r,t,o,e,n,i,a,s,c){var l=new e,u={onWeekDidChange:function(e,t,n){c.model.date=null,c.model.daytime=null,c.model.time=null,c.getDaysPoolByRange(t.from,t.to).then(function(o){n.days.each(function(e){var t=o[e.key];t?(e.times=t.times,e.daytimes=t.daytimes,e.closingDay=t.closingDay):(e.times=[],e.daytimes=c.emptyDaytimes)})})},onDayDidSelect:function(t,o,e,n){r.$root.addModal("timesModal",{day:t,daytime:o,times:o.times}).then(function(e){n.days.each(function(t){Object.keys(t.daytimes).forEach(function(e){t.daytimes[e].active=!1,t.daytimes[e].times.forEach(function(e){e.active=!1})})}),e.active=!0,o.active=!0,o.time=e,c.model.date=t.date,c.model.daytime=o,c.model.time=e},function(e){console.log("timesModal.reject",e)})},onWeekDidSelect:function(e,t,o){console.log("onWeekDidSelect.week",e)}},d={state:l,store:s,booking:c,plannerOptions:u,onBack:function(){t.path("/reserve/"+s.id)},onSubmit:function(){console.log("PlannerController.onSubmit",c.model.time.name),l.busy()&&n.update(c.model).then(function(e){t.path("/reserve/"+s.id+"/confirm"),l.success(),o(function(){l.ready()},600)})}};Object.assign(r,d),l.ready()}])}(),function(){"use strict";angular.module("app").factory("PlannerFactory",["$filter","DateTime","Hash",function(m,p,g){function e(){this.days=new g("key"),this.weeks=new g("wKey")}var t={clearMonth:function(e){e.days.each(function(e){e&&(e.hours=0,e.tasks=new g("id"))})},getDate:n,getDay:function(e){var t=new Date(p.today.date);return t.setDate(t.getDate()+e),t},getKey:function(e){return p.dateToKey(e)}},o={getWeeks:function(e){var t=this;t.days.removeAll(),t.weeks.removeAll(),t.months.removeAll();var o=0;for(;o<e;){var n=new Date;n.setFullYear(p.today.date.getFullYear()),n.setMonth(p.today.date.getMonth()+o),n.setDate(1),n.setHours(0),n.setMinutes(0),n.setSeconds(0);t.getWeekByDate(n);o++}return t.weeks},getWeek:function(e){var t=n(e);return this.getWeekByDate(t)},getWeekByDate:function(e){e=e||new Date;var i=this,t=e.getFullYear(),o=e.getMonth(),n=e.getDay(),r=e.getDate()-n+(0===n?-6:1),a=new Date(e.setDate(r)),s=m("isoWeek")(e,1),c=p.dateToKey(a),l=60*t+s,u=12*t+o,d=i.weeks.get(l);if(!d){var f=new g("key");new Array(7).fill().map(function(e,t){var o=new Date(a);o.setDate(a.getDate()+t);var n=p.dateToKey(o),r={$today:n===p.today.key,c:t,d:o.getDate(),date:o,key:n};return i.days.add(r),f.add(r),r}),d={isoWeek:s,key:c,wKey:l,mKey:u,date:a,days:f},d=i.weeks.add(d)}return d}};return angular.extend(e,t),angular.extend(e.prototype,o),e;function n(e){return"function"==typeof e.date.getMonth?e.date:new Date(e.date)}}])}(),function(){"use strict";angular.module("app").controller("AnticipationModal",["$scope","State",function(e,t){var o=new t,n=e.modal,r=(e.params?e.params:{}).anticipations||[],i={state:o,items:r,onSelect:function(e){r.forEach(function(e){e.active=!1}),e.active=!0},onSubmit:function(){console.log("AnticipationModal.onSubmit"),n.resolve(r.find(function(e){return e.active}))}};Object.assign(e,i),o.ready()}])}(),function(){"use strict";angular.module("app").controller("ExtraClosuresController",["$scope","$location","State","StoreService","View","Range","store",function(e,t,o,n,r,i,a){var s=new o,c={state:s,store:a,onSubmit:function(){console.log("ExtraClosuresController.onSubmit"),s.busy()}};Object.assign(e,c),s.ready()}])}(),function(){"use strict";angular.module("app").controller("NoticeModal",["$scope","State",function(e,t){var o=new t,n=e.modal,r=(e.params?e.params:{}).notices||[],i={state:o,items:r,onSelect:function(e){r.forEach(function(e){e.active=!1}),e.active=!0},onSubmit:function(){console.log("NoticeModal.onSubmit"),n.resolve(r.find(function(e){return e.active}))}};Object.assign(e,i),o.ready()}])}(),function(){"use strict";angular.module("app").controller("ReserveOptionsController",["$scope","$location","$timeout","State","StoreService","View","Range","store",function(e,t,o,n,r,i,a,s){var c=new n,l=new r(s),u={state:c,store:s,model:l,onSelectAll:function(){l.days.forEach(function(e){e.times=[].concat.apply([],l.daytimes.map(function(e){return e.times.map(function(e){return e.id})}))}),c.dirty=!0},onDeselectAll:function(){l.days.forEach(function(e){e.times=[]}),c.dirty=!0},onSelectNotice:function(){console.log("ReserveOptionsController.onSelectNotice"),e.$root.addModal("noticeModal",l).then(function(e){console.log("ReserveOptionsController.resolve",e),l.notice=e,c.dirty=!0},function(e){console.log("ReserveOptionsController.reject",e)})},onSelectAnticipation:function(){console.log("ReserveOptionsController.onSelectAnticipation"),e.$root.addModal("anticipationModal",l).then(function(e){console.log("ReserveOptionsController.resolve",e),l.anticipation=e,c.dirty=!0},function(e){console.log("ReserveOptionsController.reject",e)})},dayHasTime:function(e,t){return-1!==e.times.indexOf(t.id)},onDayTimeDidChange:function(e,t){var o=e.times.indexOf(t.id);-1!==o?e.times.splice(o,1):e.times.push(t.id);c.dirty=!0},onSubmit:function(){console.log("ReserveOptionsController.onSubmit"),c.busy()&&r.update(l).then(function(e){c.success(),o(function(){c.ready()},600)},function(e){console.log(e)})}};Object.assign(e,u),c.ready()}])}(),function(){"use strict";angular.module("app").factory("StoreService",["$promise","$location","DateTime","Api","SessionStorage","environment",function(e,n,t,r,i,o){function a(e){var t=new Array(15).fill(null).map(function(e,t){return{id:t+1,name:(t+1).toString()+" gg"}}),o=new Array(12).fill(null).map(function(e,t){return{id:t+1,name:(30+30*t).toString()+" gg"}});if(e&&(e=angular.copy(e),Object.assign(this,e),this.days.forEach(function(e){var t=new Date,o=t.getDay(),n=t.getDate()-o+e.day;t=new Date(t.setDate(n)),e.date=t})),this.notice){var n=this.notice.id,r=t.find(function(e){return e.id===n});r&&(r.active=!0,this.notice=r)}if(this.anticipation){var i=this.anticipation.id,a=o.find(function(e){return e.id===i});a&&(a.active=!0,this.anticipation=a)}this.notices=t,this.anticipations=o}var s={current:function(){return e(function(o){if(a.store)o.resolve(a.store);else if(i.exist("store")){var e=i.get("store");e=new a(e),a.store=e,o.resolve(e)}else r.store.data().then(function(e){var t=new a(e);a.store=t,o.resolve(t)},function(e){o.reject(e)})})},currentOrGoTo:function(o){return e(function(t){a.current().then(function(e){e?t.resolve(e):(n.$$lastRequestedPath=n.path(),n.path(o))},function(e){t.reject(e)})})},update:function(t){return e(function(e){t?(i.set("store",t),e.resolve(t)):e.reject(error)})}},c={deepCopy:function(){return new a(angular.copy(this))}};return Object.assign(a,s),Object.assign(a.prototype,c),a}])}(),function(){"use strict";angular.module("app").config(["environmentProvider",function(e){e.add("environment",{http:{interceptors:[],withCredentials:!1},language:{code:"it",culture:"it_IT",iso:"ITA",name:"Italiano"},location:{hash:"!",html5:!1},plugins:{facebook:{appId:340008479796111,fields:"id,name,first_name,last_name,email,gender,picture,cover,link",scope:"public_profile, email",version:"v2.10"},google:{apiKey:"AIzaSyCn6O-j_8pipy-ErGxg4bM1juGesiyM28U",clientId:"1063539520533-7308vqmt92em6dv1v5q52fq2or36jk95.apps.googleusercontent.com"},googlemaps:{apiKey:"AIzaSyCn6O-j_8pipy-ErGxg4bM1juGesiyM28U",styles:"/googlemaps/applemapesque.json",options:{center:{lat:43.9023386,lng:12.8505094},zoom:4}},mapbox:{accessToken:"pk.eyJ1IjoiYWN0YXJpYW4iLCJhIjoiY2lqNWU3MnBzMDAyZndnbTM1cjMyd2N2MiJ9.CbuEGSvOAfIYggQv854pRQ",options:{center:[12.8505094,43.9023386],zoom:4},style:"mapbox://styles/actarian/cja82nadj07sn2rmty6n1n5pk",version:"v0.42.0"}}})}])}(),function(){"use strict";angular.module("app").config(["environmentProvider",function(e){e.add("local",{paths:{api:"http://localhost:6001/api",app:"http://localhost:6001"},plugins:{facebook:{appId:340008479796111}}})}])}(),function(){"use strict";angular.module("app").config(["environmentProvider",function(e){e.add("production",{paths:{api:"https://actarian.github.io/scavolini-reserve/api",app:"https://actarian.github.io/scavolini-reserve"},plugins:{facebook:{appId:0x8e099954c588}}})}])}(),function(){"use strict";angular.module("app").config(["environmentProvider",function(e){e.add("stage",{})}])}();
//# sourceMappingURL=app.min.js.map
